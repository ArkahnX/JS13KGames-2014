function o(o,r,e){null!==o.img&&context.drawImage(o.img,o.x||r,o.y||e,o.w,o.h)}function r(o,r,e,t){yr[r][e]||(o[e]=t,yr[r][e]=t),yr[r][e]!==t&&(o[e]=t,yr[r][e]=t)}function e(){for(var o=(oe[0].width,oe[0].height,10*oe[0].size),r=0;o>r;r++)for(var e=0;o>e;e++)0!==oe[0].map[C(e,r,o)]&&n(e,r,oe[0].map,o,1,1);for(var r=0;o>r;r++)for(var e=0;o>e;e++)0!==oe[0].map[C(e,r,o)]&&drawTile(e,r,oe[0].map,o,1,1)}function t(){Mr.fillStyle="#FF9900",r(Rr,"border","strokeStyle","#ff0000"),r(Rr,"border","lineWidth",2);var o=window.performance.now(),e=R(Or)-1,t=R(Ur)-1,l=R(Or)+R(gr.width)+2,c=R(Ur)+R(gr.height)+2;0>e&&(e=0),0>t&&(t=0),l>Gr&&(l=Gr),c>Gr&&(c=Gr);for(var s=t;c>s;s++)for(var m,p=0,u=16*-Gr*2,d=0,h=e;l>h;h++)0!==te[C(h,s,Gr)]&&(p+=16,u===16*-Gr*2&&(u=16*h-Or),m=0>s-1?-1:te[C(h,s-1,Gr)],0===m&&(d=1)),(0===te[C(h,s,Gr)]||h===l-1)&&n(h,s,te,Gr,u,p,d),(0===te[C(h,s,Gr)]||h===l-1)&&(p=0,u=16*-Gr*2,d=0);a(e,t,l,c,1),a(e,t,l,c,4),i(e,t,l,c,2),i(e,t,l,c,8);var y=window.performance.now()-o;y>fr&&(fr=y)}function n(o,r,e,t,n,a,i){var l=n,c=16*r-Ur;1===i?Mr.fillRect(l,c-5,a,21):Mr.fillRect(l,c,a,16)}function a(o,r,e,t,n){for(var a=o;e>a;a++)for(var i=0,c=16*-Gr*2,s=0,m=0,p=r;t>p;p++){var u=te[C(a+1,p-1,Gr)],d=te[C(a,p-1,Gr)],h=te[C(a-1,p-1,Gr)];if(1===n?(m=te[C(a-1,p,Gr)],0>a-1&&(m=-1)):4===n&&(m=te[C(a+1,p,Gr)],a+1>Gr-1&&(m=-1)),0!==te[C(a,p,Gr)]&&1>m&&(i+=16,c===16*-Gr*2&&(0===d&&(s=1),c=16*p-Ur)),0===te[C(a,p,Gr)]||p===t-1||m>0){Rr.beginPath();var y=c,f=16*a-Or,g=y+i,w=16*(a+1)-Or,v=f;4===n&&(v=w),s&&(y-=5),(4===n&&0===u||1===n&&0===h)&&m>0?l(v,y,v,g+3):l(v,y,v,g),Rr.closePath(),Rr.stroke()}(0===te[C(a,p,Gr)]||p===t-1||m>0)&&(i=0,c=16*-Gr*2,s=0)}}function i(o,r,e,t,n){for(var a=r;t>a;a++)for(var i=0,c=16*-Gr*2,s=0,m=0,p=o;e>p;p++){if(2===n?0>a-1?m=-1:(m=te[C(p,a-1,Gr)],s=1):8===n&&(m=te[C(p,a+1,Gr)],a+1>Gr-1&&(m=-1)),0!==te[C(p,a,Gr)]&&1>m&&(i+=16,c===16*-Gr*2&&(c=16*p-Or)),0===te[C(p,a,Gr)]||p===e-1||m>0){Rr.beginPath();var u=c,d=16*a-Ur,h=u+i,y=16*(a+1)-Ur;2===n?1===s?(l(u,d-5,h,d-5),l(u,d+3,h,d+3)):l(u,d,h,d):8===n&&l(u,y,h,y),Rr.closePath(),Rr.stroke()}(0===te[C(p,a,Gr)]||p===e-1||m>0)&&(i=0,c=16*-Gr*2,s=0)}}function l(o,r,e,t){Rr.moveTo(o,r),Rr.lineTo(e,t)}function c(){var o=null;gr.width=10*ge.width,gr.height=10*ge.height,xr.clearRect(0,0,gr.width,gr.height);for(var r=0;r<ge.rooms.length;r++)o=ge.rooms[r],xr.fillStyle=o.mapColor,xr.fillRect(10*o.mapX,10*o.mapY,10*o.mapW,10*o.mapH),s(o),m(o)}function s(o){var r="#555";xr.lineWidth=1,xr.strokeStyle=r,p(10*o.mapX,10*o.mapY,10*o.mapX+10*o.mapW,10*o.mapY,r),p(10*o.mapX,10*o.mapY,10*o.mapX,10*o.mapY+10*o.mapH,r),p(10*o.mapX+10*o.mapW,10*o.mapY,10*o.mapX+10*o.mapW,10*o.mapY+10*o.mapH,r),p(10*o.mapX,10*o.mapY+10*o.mapH,10*o.mapX+10*o.mapW+1,10*o.mapY+10*o.mapH,r)}function m(o){var r=null,e=o.mapColor;xr.lineWidth=1,xr.strokeStyle=e;for(var t=2,n=0;n<o.doors.length;n++)switch(r=o.doors[n],r.dir){case"N":p(10*r.mapX+t,10*r.mapY,10*r.mapX+10-t,10*r.mapY,e);continue;case"S":p(10*r.mapX+t,10*(r.mapY+1),10*r.mapX+10-t,10*(r.mapY+1),e);continue;case"W":p(10*r.mapX,10*r.mapY+t,10*r.mapX,10*r.mapY+10-t,e);continue;case"E":p(10*(r.mapX+1),10*r.mapY+t,10*(r.mapX+1),10*r.mapY+10-t,e);continue;default:continue}}function p(o,r,e,t){xr.beginPath(),xr.moveTo(o,r),xr.lineTo(e,t),xr.stroke(),xr.closePath()}function u(){var o=null,r=0;xr.fillStyle="rgba(255,255,255,0.3)";for(var e=V();r<e.length;)o=e[r],xr.fillRect(10*o.x,10*o.y,10,10),s(F(o.x,o.y,1,1,null)),r++}function d(o,r){Wr[o]||(Wr[o]=[]),Wr[o].push(r)}function h(o,r,e,t,n,a){var i={x:o,y:r,w:e,h:t,angle:0,img:n};return a&&(i.xDirection=0,i.yDirection=0,i.xAccel=0,i.yAccel=1,i.maxAccel=5),a&&(i.jumpForce=7,i.jumpHeight=50,i.jumpStart=0,i.jumping=0,i.jumpsUsed=0,i.maxJumps=3),i}function y(o){var r=o.type;if(Wr[r]&&Wr[r].length>0)for(var e=0;e<Wr[r].length;e++)Wr[r][e](o)}function f(o,r){return document[Ar[o]](r)}function g(){gr=f(Lr,"player"),vr=f(Lr,"border"),wr=f(Lr,"tile"),xr=gr.getContext("2d"),Rr=vr.getContext("2d"),Mr=wr.getContext("2d"),w(),x()}function w(){vr.width=gr.width=wr.width=window.innerWidth>300?300:window.innerWidth,vr.height=gr.height=wr.height=window.innerHeight>300?300:window.innerHeight}function v(){xr.clearRect(0,0,gr.width,gr.height),Rr.clearRect(0,0,vr.width,vr.height),Mr.clearRect(0,0,wr.width,wr.height);for(var o=0;o<Fr.length;o++){var e=Fr[o];P(e),e.x=~~(.5+e.x),e.y=~~(.5+e.y),S(e),j(e),W(e),H(e)}O(),t(),xr.fillStyle="#000000";for(var o=0;o<Fr.length;o++){var e=Fr[o];r(xr,"player","fillStyle","#000000"),xr.fillRect(e.x-Or,e.y-Ur,e.w,e.h)}}function x(){br=window.performance.now(),Sr=br-Pr,Pr=br,document.dispatchEvent(Dr),Yr&&requestAnimationFrame(x)}function M(o,r){return Math.floor(Math.random()*(r-o+1)+o)}function R(o,r){var e=o%(r||16);return(o-e)/(r||16)}function C(o,r,e){return r*e+o}function T(o,r){if("object"==typeof r){for(var e=0;e<o.length;e++){var t=!0;if("object"==typeof o[e]){for(var n in r)if(o[e][n]!==r[n]){t=!1;break}if(t===!0)return e}}return-1}return o.indexOf(r)}function A(o){for(var r in Ir)Ir[r]===o.keyCode&&o.preventDefault();Hr[o.keyCode]!==o.type&&o.keyCode===Ir.space&&(jr.jumping=1),Hr[o.keyCode]=o.type,o.keyCode===Ir.d?jr.xDirection=1:o.keyCode===Ir.a&&(jr.xDirection=-1)}function L(o){for(var r in Ir)Ir[r]===o.keyCode&&o.preventDefault();Hr[o.keyCode]!==o.type&&o.keyCode===Ir.space&&(jr.jumping=0),Hr[o.keyCode]=o.type,(o.keyCode===Ir.d||o.keyCode===Ir.a)&&(Hr[Ir.d]&&Hr[Ir.a]?Hr[Ir.d]===o.type&&Hr[Ir.a]===o.type&&(jr.xDirection=0):jr.xDirection=0)}function k(o){zr.length=o.length}function X(o,r,e,t){zr.length=0;for(var n=0,a=0;r>a;a++)for(var i=0;e>i;i++)0===t&&(n=C(a,i,10)),1===t&&(n=C(i,r-a-1,10)),2===t&&(n=C(r-a-1,e-i-1,10)),3===t&&(n=C(e-i-1,a,10)),zr[C(a,i,10)]=o[n];return zr.slice(0)}function Y(){}function D(){for(var o,r=0;Er>r;r++)for(var e=0;Er>e;e++){var t=Math.floor(e/10)+"-"+Math.floor(r/10);if(e%10===0||r%10===0){var n=null;Jr[t]||(n=M(0,3),o=I(_r[M(0,9)]),1===Math.floor(e/10)&&1===Math.floor(r/10)&&(o=I(_r[9])),0===Math.floor(e/10)&&0===Math.floor(r/10)&&(o=I(_r[9])),1===Math.floor(e/10)&&0===Math.floor(r/10)&&(o=I(_r[7])),1===Math.floor(e/10)&&1===Math.floor(r/10)&&(o=I(_r[5])),2===Math.floor(e/10)&&1===Math.floor(r/10)&&(o=I(_r[7])),2===Math.floor(e/10)&&2===Math.floor(r/10)&&(o=I(_r[3])),Jr[t]=4&o.options?X(o,10,10,n):o),o=Jr[t]}Br[C(e,r,Er)]=o.map[C(e%10,r%10,10)]}}function b(o,r,e){return(r*e||$r)+o}function P(o){o.xAccel=o.xAccel+o.xDirection/60*Sr,o.xAccel>o.maxAccel&&(o.xAccel=o.maxAccel),o.xAccel<-o.maxAccel&&(o.xAccel=-o.maxAccel),0===o.xDirection&&(o.xAccel>0?o.xAccel=o.xAccel+-2/60*Sr:o.xAccel<0&&(o.xAccel=o.xAccel+2/60*Sr),(o.xAccel<1/60*Sr&&o.xAccel>-1/60*Sr||1===o.yDirection||-1===o.yDirection)&&(o.xAccel=0)),o.x=o.x+o.xAccel}function W(o){o.jumping&&-1!==o.yDirection&&o.jumpsUsed<o.maxJumps&&(o.maxJumps>1&&0===o.jumpsUsed&&1===o.yDirection&&o.jumpsUsed++,(0===o.jumpsUsed&&0===o.yDirection||o.jumpsUsed>0||o.maxJumps>1)&&(o.yDirection=-1,o.yAccel=-o.jumpForce,o.jumpStart=o.y,o.jumpsUsed++)),(0===o.yDirection||!o.jumping||o.jumpStart-o.y>o.jumpHeight)&&(o.yDirection=1),1===o.yDirection&&(o.jumping=0,o.yAccel=o.yAccel+o.jumpForce/2/60*Sr),0===o.yDirection&&(o.yAccel>0?o.yAccel=o.yAccel+-1/60*Sr:o.yAccel<0&&(o.yAccel=o.yAccel+1/60*Sr),o.yAccel<1/60*Sr&&o.yAccel>-1/60*Sr&&(o.yAccel=0)),o.yAccel>o.maxAccel&&(o.yAccel=10),o.y=o.y+o.yAccel}function H(o){var r=o.x%16,e=C(R(o.x),R(o.y+o.h),Gr),t=C(R(o.x+o.w),R(o.y+o.h),Gr),n=!1;n=0===r?te[e]:0!==te[t]||0!==te[e],(n||o.y+o.h>16*Qr)&&1===o.yDirection&&(o.y=16*R(o.y),o.yAccel=0,o.yDirection=0,o.jumpsUsed=0,o.jumping=0)}function j(o){var r=o.x%16,e=C(R(o.x),R(o.y-o.h/2),Gr),t=C(R(o.x+o.w),R(o.y-o.h/2),Gr),n=!1;n=0===r?0!==te[e]:0!==te[e]||0!==te[t],n&&1===o.jumping&&(o.y=16*R(o.y),o.yAccel=-1,o.yDirection=1,o.jumping=0)}function S(o){var r=o.y%16,e=o.x%16,t=C(R(o.x),R(o.y-o.h/2),Gr),n=C(R(o.x+o.w),R(o.y-o.h/2),Gr),a=C(R(o.x),R(o.y),Gr),i=C(R(o.x+o.w),R(o.y),Gr),l=C(R(o.x),R(o.y+o.h/2),Gr),c=C(R(o.x+o.w),R(o.y+o.h/2),Gr),s=C(R(o.x),R(o.y+o.h),Gr),m=C(R(o.x+o.w),R(o.y+o.h),Gr),p=!1,u=!1;0===r?(p=0!==te[l]||0!==te[a],u=0!==te[c]||0!==te[i]):16*R(o.y+o.h)>o.y+o.h?(p=0!==te[l]||0!==te[a]||0!==te[t],u=0!==te[c]||0!==te[i]||0!==te[n]):(p=0!==te[l]||0!==te[a]||0!==te[s],u=0!==te[c]||0!==te[i]||0!==te[m]),0===e?(u||o.x+o.w>16*Kr||o.x<0)&&o.xAccel>0&&(o.x=16*R(o.x),o.xAccel=0):(u||o.x+o.w>16*Kr||o.x<0)&&o.xAccel>0?(o.x=16*R(o.x),o.xAccel=0):(p||o.x+o.w>16*Kr||o.x<0)&&o.xAccel<0&&(o.x=16*R(o.x+o.w),o.xAccel=0)}function F(o,r,e,t,n,a,i){return{map:i,doors:n,paths:a,options:1*o|2*r|4*e,type:t}}function I(o){return{map:o.map.slice(0),doors:o.doors,paths:o.paths,options:o.options,type:o.type}}function B(o,r,e,t,n,a,i,l,c){for(var s=[],m=[],p=Math.max(o,r),u=0;p*p>u;u++)s[u]=0;s=c(s,o,r,p);for(var d,h=[],y=0;10*p>y;y++)for(var f=0;10*p>f;f++){var g=C(Math.floor(f/10),Math.floor(y/10),p),w=Math.floor(f/10)+"-"+Math.floor(y/10);if(f%10===0||y%10===0){var v=null;h[w]||(v=M(0,3),d=I(_r[s[g]]),h[w]=4&d.options?n(d,10,10,v):d),d=h[w]}m[C(f,y,10*p)]=d.map[C(f%10,y%10,10)]}return Gr=10*p,te=m,Qr=10*p,Kr=10*p,{map:m,doors:i,paths:l,width:o,height:r,size:p,options:1*e|2*t|4*n,type:a}}function E(o,r,e,t,n,a,i,l,c,s){l.length=0;for(var m=0;m<_r.length;m++)i[m]=m;var p=a[C(e,t-1,n)],u=a[C(e-1,t,n)],d=a[C(e+1,t,n)],h=a[C(e,t+1,n)];if(0>t-1&&(p=-1),0>e-1&&(u=-1),t+1>s-1&&(h=-1),e+1>c-1&&(d=-1),4===p||2===p||6===p||7===p||9===p||13===p){console.warn("Room for Above");for(var y=0;y<i.length;y++)i[y]=-1;i[2]=2,i[3]=3,i[5]=5,i[8]=8,i[9]=9,-1!==u&&(1===u||3===u||4===u||5===u||6===u||9===u||10===u)&&(console.warn("Room for Above and Left"),i[2]=-1,i[5]=-1,i[3]=3,i[8]=8,i[9]=9,-1!==d&&(1===d||3===d||4===d||7===d||8===d||9===d||11===d)&&(i[8]=-1)),-1!==d&&(1===d||3===d||4===d||7===d||8===d||9===d||11===d)&&(console.warn("Room for Above and Left"),i[2]=-1,i[8]=-1,i[3]=3,i[5]=5,i[9]=9,-1!==u&&(1===u||3===u||4===u||5===u||6===u||9===u||10===u)&&(i[5]=-1))}if(0===e&&(console.warn("Left of Map"),i[7]=-1,i[8]=-1,i[1]=-1),e===c-1&&(console.warn("Right of Map"),i[5]=-1,i[6]=-1,i[1]=-1),0===t&&(console.warn("Top of Map"),i[3]=-1,i[5]=-1,i[8]=-1,i[2]=-1),t===s-1&&(console.warn("Bottom of Map"),i[4]=-1,i[6]=-1,i[7]=-1,i[2]=-1),e===o&&t===r){console.warn("Room for Start");for(var y=0;y<i.length;y++)i[y]=-1;i[10]=10,i[11]=11,i[12]=12,i[13]=13,-1===u&&(i[11]=-1),-1===p&&(i[12]=-1),-1===d&&(i[10]=-1),-1===h&&(i[13]=-1)}else i[10]=-1,i[11]=-1,i[12]=-1,i[13]=-1;i[9]=9;for(var y=0;y<i.length;y++)-1!==i[y]&&l.push(i[y]);var f=l[M(0,l.length-1)];11===f&&-1===[1,3,4,5,6,9].indexOf(u)&&E(o,r,e-1,t,n,a,i,l,c,s),12===f&&-1===[2,4,6,7,9].indexOf(p)&&E(o,r,e,t-1,n,a,i,l,c,s),a[C(e,t,n)]=f}function O(){var o=Mr.canvas,r=o.width/2,e=o.height/2;jr.x-Or+r>o.width?Or=jr.x-(o.width-r):jr.x-r<Or&&(Or=jr.x-r),jr.y-Ur+e>o.height?Ur=jr.y-(o.height-e):jr.y-e<Ur&&(Ur=jr.y-e),Ur=~~(.5+Ur),Ur=~~(.5+Ur)}function U(o,r,e){ge.frontiers.length=0,ge.frontiers.push({x:o,y:r}),ge.currentRegion=e,ge.regions.push(e)}function z(o){var r=J(V());U(r.x,r.y,o)}function J(o){var r=M(0,o.length-1);return o[r]}function V(){for(var o=[],r=0;r<ge.rooms.length;r++)o=q(o,ge.rooms[r]);return o}function q(o,r){for(var e=r.mapX;e<r.mapX+r.mapW;)N(e,r.mapY-1,1,1)&&o.push({x:e,y:r.mapY-1}),N(e,r.mapY+r.mapH,1,1)&&o.push({x:e,y:r.mapY+r.mapH}),e++;for(var t=r.mapX;t<r.mapY+r.mapH;)N(t,r.mapX-1,1,1)&&o.push({x:t,y:r.mapX-1}),N(t,r.mapX+r.mapW,1,1)&&o.push({x:t,y:r.mapX+r.mapW}),t++;return o}function N(o,r,e,t){return G(o,r,e,t)&&!K(o,r,e,t)}function G(o,r,e,t){return o>0&&r>0&&o+e<ge.width&&r+t<ge.height}function K(o,r,e,t){for(var n=null,a=0;a<ge.rooms.length;){n=ge.rooms[a];{if(!(n.mapX>o+e-1||n.mapX+n.mapW-1<o||n.mapY>r+t-1||n.mapY+n.mapH-1<r))return!0;a++}}return!1}function Q(o){for(var r=0,e=null,t=!1,n=100;ge.rooms.length>1&&!t;){r=0,r+=Z(o),r+=$(o),r+=_(o),r+=or(o),1===o.region.rooms.length&&r>0&&(t=!0);for(var a=0;a<o.doors.length;a++)e=o.doors[a],mr(e,o).region===o.region&&(t=!0);n--,0===n&&(t=!0)}}function Z(o){for(var r=null,e=null,t=null,n=[],a=o.mapX;a<o.mapX+o.mapW;)e=rr(a,o.mapY-1),null!==e&&n.push({x:a,y:o.mapY,other:e}),a++;for(var i=0,l=0;l<n.length;l++)r=n[l],Math.random()>we||T(o.doors,r)>=0||(t=lr(r.x,r.y,"N",o,r.other),o.doors.push(t),r.other.doors.push(t),i++);return i}function $(o){for(var r=null,e=null,t=null,n=[],a=o.mapX;a<o.mapX+o.mapW;)e=rr(a,o.mapY+o.mapH),null!==e&&n.push({x:a,y:o.mapY+o.mapH-1,other:e}),a++;for(var i=0,l=0;l<n.length;l++)r=n[l],Math.random()>we||T(o.doors,r)>=0||(t=lr(r.x,r.y,"S",o,r.other),o.doors.push(t),r.other.doors.push(t),i++);return i}function _(o){for(var r=null,e=null,t=null,n=[],a=o.mapY;a<o.mapY+o.mapH;)e=rr(o.mapX-1,a),null!==e&&n.push({x:o.mapX,y:a,other:e}),a++;for(var i=0,l=0;l<n.length;l++)r=n[l],Math.random()>we||T(o.doors,r)>=0||(t=lr(r.x,r.y,"W",o,r.other),o.doors.push(t),r.other.doors.push(t),i++);return i}function or(o){for(var r=null,e=null,t=null,n=[],a=o.mapY;a<o.mapY+o.mapH;)e=rr(o.mapX+o.mapW,a),null!==e&&n.push({x:o.mapX+o.mapW-1,y:a,other:e}),a++;for(var i=0,l=0;l<n.length;l++)r=n[l],Math.random()>we||T(o.doors,r)>=0||(t=lr(r.x,r.y,"E",o,r.other),o.doors.push(t),r.other.doors.push(t),i++);return i}function rr(o,r){for(var e=null,t=0;t<ge.rooms.length;){e=ge.rooms[t];{if(!(e.mapX>o||e.mapX+e.mapW-1<o||e.mapY>r||e.mapY+e.mapH-1<r))return e;t++}}return null}function er(o){for(var r=0,e=ge.rooms.length;r++<10*o&&ge.rooms.length<e+o;)tr()}function tr(){var o=J(ge.frontiers);nr(ir(o.x,o.y))}function nr(o){if(null===o||!N(o.mapX,o.mapY,o.mapW,o.mapH))return!1;var r=[];r=ar(r,o),ge.frontiers=q(r,o),o.mapColor=ge.currentRegion.color,ge.rooms.push(o),ge.currentRegion.rooms.push(o),Q(o)}function q(o,r){for(var e=r.mapX;e<r.mapX+r.mapW;)N(e,r.mapY-1,1,1)&&o.push({x:e,y:r.mapY-1}),N(e,r.mapY+r.mapH,1,1)&&o.push({x:e,y:r.mapY+r.mapH}),e++;for(var t=r.mapY;t<r.mapY+r.mapH;)N(r.mapX-1,t,1,1)&&o.push({x:r.mapX-1,y:t}),N(r.mapX+r.mapW,t,1,1)&&o.push({x:r.mapX+r.mapW,y:t}),t++;return o}function ar(o,r){for(var e=0;e<ge.frontiers.length;e++)ge.frontiers[e].x>=r.mapX-1&&ge.frontiers[e].x<=r.mapX+r.mapW&&ge.frontiers[e].y>=r.mapY&&ge.frontiers[e].y<=r.mapY+r.mapH-1||ge.frontiers[e].x>=r.mapX&&ge.frontiers[e].x<=r.mapX+r.mapW-1&&ge.frontiers[e].y>=r.mapY-1&&ge.frontiers[e].y<=r.mapY+r.mapH||o.push(ge.frontiers[e]);return o}function ir(o,r){for(var e=0,t=1,n=1;e++<25&&(t<ge.currentRegion.maxW||n<ge.currentRegion.maxH)&&Math.random()<.9;)switch(parseInt(4*Math.random())){case 0:n<ge.currentRegion.maxH&&N(o,r-1,t,n+1)&&(r--,n++);continue;case 1:n<ge.currentRegion.maxH&&N(o,r,t,n+1)&&n++;continue;case 2:t<ge.currentRegion.maxW&&N(o-1,r,t+1,n)&&(o--,t++);continue;case 3:t<ge.currentRegion.maxW&&N(o,r,t+1,n)&&t++;continue;default:continue}return F(o,r,t,n,ge.currentRegion)}function F(o,r,e,t,n){return{mapX:o,mapY:r,mapW:e,mapH:t,mapColor:4281545727,region:n,specialType:0,doors:[]}}function lr(o,r,e,t,n){return{mapX:o,mapY:r,doorType:0,dir:e,room1:t,room2:n}}function cr(){for(var o=null,r=null,e=0;e<ge.rooms.length;e++){o=ge.rooms[e],o.specialType=0;for(var t=0;t<o.doors.length;t++)r=o.doors[t],r.doorType=0}}function sr(){var o=null,r=[],e=null,t=null,n=null,a=null,i=[],l=[],c=[];c.push(ge.regions[0]);for(var s=0;c.length>0;){s++,r.length=0,e=c.shift(),l.push(e),n=J(e.rooms),n.specialType=s;for(var m=0;m<e.rooms.length;m++){a=e.rooms[m];for(var p=0;p<a.doors.length;p++)o=a.doors[p],t=mr(o,a).region,t!==e&&o.doorType<=0&&(r.indexOf(t)>=0?i.push(o):(o.doorType=s,push(t),-1===l.indexOf(t)&&-1===c.indexOf(t)&&c.push(t)))}}for(var u=0;u<i.length;u++)o=i[u],o.doorType<=0&&(o.doorType=parseInt(Math.random()*s)+1)}function mr(o,r){return o.room1===r?o.room2:o.room1}function pr(){ge={width:0,height:0,rooms:[],frontiers:[],regions:[],currentRegion:0},currentRegionColorIndex=0,xe.length=0;for(var o=0;10>o;o++)xe.push(hr((36*o+164)%360,.9,.5));ge.width=80,ge.height=48,U(40,24,ur()),er(2)}function ur(){var o=dr(xe[currentRegionColorIndex],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1);return currentRegionColorIndex=(currentRegionColorIndex+1)%xe.length,o}function dr(o,r,e){return{color:o,maxW:r,maxH:e,rooms:[]}}function hr(o,r,e){var t,n,a,i,l,c,s,m;switch(o&&void 0===r&&void 0===e&&(r=o.s,e=o.v,o=o.h),i=Math.floor(6*o),l=6*o-i,c=e*(1-r),s=e*(1-l*r),m=e*(1-(1-l)*r),i%6){case 0:t=e,n=m,a=c;break;case 1:t=s,n=e,a=c;break;case 2:t=c,n=e,a=m;break;case 3:t=c,n=s,a=e;break;case 4:t=m,n=c,a=e;break;case 5:t=e,n=c,a=s}return"#"+("0"+Math.floor(255*t).toString(16)).slice(-2)+("0"+Math.floor(255*n).toString(16)).slice(-2)+("0"+Math.floor(255*a).toString(16)).slice(-2)}var yr={player:{},border:{},tile:{}},fr=0,gr,wr,vr,xr,Mr,Rr,Cr,Tr,Ar=["getElementById","querySelector","querySelectorAll"],Lr=0,kr=1,Xr=2,Yr=!1,Dr=new CustomEvent("frame"),br=window.performance.now(),Pr=window.performance.now(),Wr={},Hr={},jr={x:151,y:48,w:16,h:32,img:null,xDirection:0,yDirection:1,xAccel:0,yAccel:0,maxAccel:5,jumpForce:7,jumpHeight:50,jumpStart:0,jumping:0,jumpsUsed:0,maxJumps:1,angle:0},Sr=br-Pr,Fr=[jr],Ir={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};d("keydown",A),d("keyup",L),d("resize",w),d("DOMContentLoaded",g),d("frame",v),window.addEventListener("resize",y),document.addEventListener("DOMContentLoaded",y),document.addEventListener("mousedown",y),document.addEventListener("mouseup",y),document.addEventListener("keydown",y),document.addEventListener("keyup",y),document.addEventListener("frame",y);for(var Br=[],Er=30,Or=0,Ur=0,zr=[],Jr={},Vr=[0,1],qr=[],Nr={w:16,h:16,img:null,angle:0},Gr=0,Kr=0,Qr=0,Zr=Gr,$r=Gr,_r=[],oe=[],re=[],ee=0;100>ee;ee++)re[ee]=0;var te=null,ne=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ae=[1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1],ie=[1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],le=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],ce=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],se=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],me=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,1,0,1,1,0,0,0,0,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1],pe=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ue=[1,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],de=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],he=[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ye=[1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1],fe=[1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1];_r.push(F(0,0,0,0,0,15,re)),_r.push(F(0,0,0,1,0,5,ne)),_r.push(F(0,0,0,2,0,10,ae)),_r.push(F(0,0,0,3,0,11,ie)),_r.push(F(0,0,0,4,0,13,le)),_r.push(F(0,0,0,5,0,6,ce)),_r.push(F(0,0,0,6,0,12,se)),_r.push(F(0,0,0,7,0,9,me)),_r.push(F(0,0,0,8,0,3,pe)),_r.push(F(0,0,0,9,0,15,ue)),_r.push(F(0,0,0,10,1,14,de)),_r.push(F(0,0,0,11,4,11,he)),_r.push(F(0,0,0,12,8,7,ye)),_r.push(F(0,0,0,13,2,13,fe)),oe.push(B(4,4,0,0,0,0,0,15,function(o,r,e,t){for(var n=M(0,r-1),a=M(0,e-1),i=(M(0,3),0),l=0,c=[],s=[],m=0;t*t>m;m++)E(n,a,i,l,t,o,c,s,r,e),i++,i>r-1&&(i=0,l++),l>e-1&&(m=t*t);return o}));var ge,we=.2,ve=0,xe=[];