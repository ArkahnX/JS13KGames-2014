!function(n,t){function r(){var n,t,r,i,a,h,d,u,f,y,x,g,p,w,v,b,k,M,F;for(tt(),s(Rt,Wr.c.bd,Wr.c.bd,2),Rt.fillRect(0,0,Nt.width,Nt.height),Rt.fillStyle=Wr.c.bg,Rt.clearRect(0-Mr,0-Fr,ir,or),n=E(Mr)-1,t=E(Fr)-1,r=E(Mr)+E(It.width)+2,i=E(Fr)+E(It.height)+2,0>n&&(n=0),0>t&&(t=0),r>er&&(r=er),i>er&&(i=er),a={},h=t;i>h;h++)for(d=0,u=16*-er*2,f=0,s(Rt,Wr.c.bg,!1,!1),x=n;r>x;x++)g=W(x,h,er),1===yr[g]&&(d+=16,u===16*-er*2&&(u=16*x-Mr),y=0>h-1?-1:yr[W(x,h-1,er)],0===y&&(f=1)),(1!==yr[g]||x===r-1)&&(p=u,w=16*h-Fr,f?c(Rt,!0,!1,p,w-5,d,21):c(Rt,!0,!1,p,w,d,16)),(1!==yr[g]||x===r-1)&&(d=0,u=16*-er*2,f=0);for(h=t;i>h;h++)for(x=n;r>x;x++)g=W(x,h,er),v=yr[g],v>1&&(9===v&&Wr.s>-1?(s(Rt,Lr[Wr.s].l,Lr[Wr.s].bd,2),l(Rt,16*x+8-Mr-8,16*h+8-Fr,8,!0)):9!==v&&10!==v&&(s(Rt,Lr[v-2].l,!1,!1),c(Rt,!0,!1,16*x-Mr,16*h-Fr-5,16,21)));for(x=0;xr/10>x;x++)for(h=0;mr/10>h;h++)b=gt(Wr,x,h,"N"),k=gt(Wr,x,h,"E"),M=gt(Wr,x,h,"S"),F=gt(Wr,x,h,"W"),b&&m(b,x,h),k&&m(k,x,h),M&&m(M,x,h),F&&m(F,x,h);e(n,t,r,i,1),e(n,t,r,i,4),o(n,t,r,i,2),o(n,t,r,i,8)}function e(n,t,r,e,o){var i,a,h,l,d,u,f,y,x,m,s,c,p,w;for(i=n;r>i;i++)for(a=0,h=16*-er*2,l=0,d=0,u=t;e>u;u++)f=yr[W(i+1,u-1,er)],y=yr[W(i,u-1,er)],x=yr[W(i-1,u-1,er)],1===o?(d=yr[W(i-1,u,er)],0>i-1&&(d=-1)):4===o&&(d=yr[W(i+1,u,er)],i+1>er-1&&(d=-1)),0!==yr[W(i,u,er)]&&9!==yr[W(i,u,er)]&&1>d&&(a+=16,h===16*-er*2&&(0===y&&(l=1),h=16*u-Fr)),(0===yr[W(i,u,er)]||9===yr[W(i,u,er)]||u===e-1||d>0)&&(m=h,s=16*i-Mr,c=m+a,p=16*(i+1)-Mr,w=s,4===o&&(w=p),l&&(m-=5),(4===o&&0===f||1===o&&0===x)&&d>0?g(Pt,!1,!0,w,m,w,c+3):g(Pt,!1,!0,w,m,w,c)),(0===yr[W(i,u,er)]||9===yr[W(i,u,er)]||u===e-1||d>0)&&(a=0,h=16*-er*2,l=0)}function o(n,t,r,e,o){var i,a,h,l,d,u,f,y,x,m;for(i=t;e>i;i++)for(a=0,h=16*-er*2,l=0,d=0,u=n;r>u;u++)2===o?0>i-1?d=-1:(d=yr[W(u,i-1,er)],l=1):8===o&&(d=yr[W(u,i+1,er)],i+1>er-1&&(d=-1)),0!==yr[W(u,i,er)]&&9!==yr[W(u,i,er)]&&1>d&&(a+=16,h===16*-er*2&&(h=16*u-Mr)),(0===yr[W(u,i,er)]||9===yr[W(u,i,er)]||u===r-1||d>0)&&(f=h,y=16*i-Fr,x=f+a,m=16*(i+1)-Fr,2===o?1===l?(g(Pt,!1,!0,f,y-5,x,y-5),g(Pt,!1,!0,f,y+3,x,y+3)):g(Pt,!1,!0,f,m,x,m):8===o&&g(Pt,!1,!0,f,m,x,m)),(0===yr[W(u,i,er)]||9===yr[W(u,i,er)]||u===r-1||d>0)&&(a=0,h=16*-er*2,l=0)}function i(){var n,t,r,e,o;for(Tt.width=Or,Tt.height=Or,rt(),Ir=16*Wr.x+16*E(E(E(Jr.x),10),1),Nr=16*Wr.y+16*E(E(E(Jr.y),10),1),Dt.clearRect(0,0,Tt.width,Tt.height),Br.length=0,s(Dt,"#000",!1,2),n=0;n<Er.r.length;n++)for(t=0;t<Er.r[n].rooms.length;t++)r=Er.r[n].rooms[t],e=16*r.x-jr,o=16*r.y-Cr,e+16*r.mw>0&&o+16*r.mh>0&&e<Tt.width&&o<Tt.height&&c(Dt,!0,!1,e,o,16*r.mw,16*r.mh);a("bg","bd",function(n,t,r){n.v&&c(Dt,!0,!0,t,r,16*n.mw,16*n.mh)},Dt),a("bd",0,function(n,t,r){n.r.u&&!n.v&&c(Dt,!0,!1,t,r,16*n.mw,16*n.mh)},Dt),a(0,"bg",d,Dt),a(0,0,h,Dt),f()}function a(n,t,r,e){var o,i,a,h,l,d=e||Dt;for(o=0;o<Er.r.length;o++)for(s(d,Er.r[o].color[n]||"rgba(0,0,0,0)",Er.r[o].color[t]||"rgba(0,0,0,0)",!1),i=0;i<Er.r[o].rooms.length;i++)a=Er.r[o].rooms[i],h=16*a.x-jr,l=16*a.y-Cr,h+16*a.mw>0&&l+16*a.mh>0&&h<Tt.width&&l<Tt.height&&r(a,h,l,d)}function h(n){var t,r,e,o,i,a;if(n.v){for(t=null,r=null,e=null,o=0;o<n.d.length;o++)t=n.d[o],t.dt>-1&&(i=0,a=0,"N"===t.dir&&(i=5),"S"===t.dir&&(i=5,a=16),"W"===t.dir&&(i=-3,a=8),"E"===t.dir&&(i=13,a=8),s(Dt,Lr[t.dt].l,Lr[t.dt].bd,2),l(Dt,16*t.x+i-jr,16*t.y+a-Cr,3,!0));n.s>-1&&(s(Dt,Lr[n.s].bd,Lr[n.s].l,2),l(Dt,16*(n.x+n.mw/2)-3-jr,16*(n.y+n.mh/2)-Cr,3,!0))}}function l(n,t,r,e,o){n.beginPath(),n.arc(t+e,r,e,0,2*Math.PI,!1),n.fill(),o&&n.stroke(),n.closePath()}function d(n){var t,r,e,o,i,a;if(n.v)for(t=null,r=0;r<n.d.length;r++)t=n.d[r],e=n.x+"-"+n.y+"-"+t.r2.x+"-"+t.r2.y,o=t.r2.x+"-"+t.r2.y+"-"+n.x+"-"+n.y,-1===Br.indexOf(o)&&-1===Br.indexOf(e)&&(i=16*t.x-jr,a=16*t.y-Cr,"N"===t.dir&&g(Dt,!0,!0,i+4,a,i+16-4,a),"S"===t.dir&&g(Dt,!0,!0,i+4,16*(t.y+1)-Cr,i+16-4,16*(t.y+1)-Cr),"W"===t.dir&&g(Dt,!0,!0,i,a+4,i,a+16-4),"E"===t.dir&&g(Dt,!0,!0,16*(t.x+1)-jr,a+4,16*(t.x+1)-jr,a+16-4),Br.push(e))}function u(){for(var n=0;n<Jr.keys.length;n++)s(Ht,Lr[Jr.keys[n]].l,!1,!1),c(Ht,!0,!1,Jr.x-Mr+1,Jr.y-Fr+(4-n)*Jr.h/5,Jr.w-2,Jr.h/5-1)}function f(){var n,t,r,e;for(n=0;n<Qr.length;n++)t=Qr[n],r=(15-15*(Jr.ῼ/Jr.mῼ)).toString(16),s(Ht,"rgba(0,0,0,0.1)","#"+r+r+"0000",1),c(Ht,!0,!0,t.x-Mr,t.y-Fr,t.w,t.h),u();Hr+=2*(Kr/1e3),Hr%=2,e=1,Hr>1&&(e=0),Pr!==e&&s(zt,"rgba(255,255,0,"+.6*e+")","rgba(255,255,0,"+.8*e+")",!1),Xt.width!==Tt.width&&(Xt.width=Tt.width,Xt.height=Tt.height,s(zt,"rgba(255,255,0,"+.6*e+")","rgba(255,255,0,"+.8*e+")",!1)),Rr||(s(zt,!1,!1,1),Rr=!0),zt.clearRect(0,0,Xt.width,Xt.height),c(zt,!0,!0,Ir-jr,Nr-Cr,16,16),Pr=e}function y(){Jr.keys.length>0&&(s(Ht,Lr[Jr.keys[rr]].l,"#000000",!1),p(Ht,Jr.x-Mr+Jr.w/2,Jr.y-Fr+Jr.h/2,Kt,function(){g(Ht,!0,!0,10+Jr.w,0,0+Jr.w,-10,0+Jr.w,10,10+Jr.w,0)}))}function x(){var n,t;for(n=0;n<Qt.length;n++)t=Qt[n],s(Ht,Lr[t.key].l,Lr[t.key].bd,1),p(Ht,t.x-Mr,t.y-Fr,t.a,function(){c(Ht,!0,!0,0,0,10,2)})}function m(n,t,r){var e,o,i="#FFFFFF",a="#000000";n.dt>-1&&(a=Lr[n.dt].l),s(Rt,a,i,!1),e=160,o=80,"N"===n.dir&&(e=o,o=0),"W"===n.dir&&(e=0),"S"===n.dir&&(e=o,o=160),p(Rt,16*t*10-Mr+e,16*r*10-Fr+o,!1,function(){"N"===n.dir&&g(Rt,!0,!0,0,-20,10,-10,-10,-10,0,-20),"W"===n.dir&&g(Rt,!0,!0,-20,0,-10,-10,-10,10,-20,0),"S"===n.dir&&g(Rt,!0,!0,0,20,10,10,-10,10,0,20),"E"===n.dir&&g(Rt,!0,!0,20,0,10,-10,10,10,20,0)})}function s(n,t,r,e){t!==!1&&(n.fillStyle=t),r!==!1&&(n.strokeStyle=r),e!==!1&&(n.lineWidth=e)}function c(n,t,r,e,o,i,a){n.beginPath(),n.rect(e,o,i,a),t&&n.fill(),r&&n.stroke(),n.closePath()}function g(n,t,r,e,o){n.beginPath(),n.moveTo(e,o);for(var i=3;i<arguments.length;i+=2)n.lineTo(arguments[i],arguments[i+1]);t&&n.fill(),r&&n.stroke(),n.closePath()}function p(n,t,r,e,o){n.save(),n.translate(t,r),e!==!1&&n.rotate(e),o(),n.restore()}function w(n,t){qr[n]||(qr[n]=[]),qr[n].push(t)}function v(n){var t,r=n.type;if(qr[r]&&qr[r].length>0)for(t=0;t<qr[r].length;t++)qr[r][t](n)}function b(n){return t.getElementById(n)}function k(){var n,t,r,e,o,i,a,h;for(Yt=b("clr"),It=b("p"),Bt=b("b"),Nt=b("t"),Tt=b("m"),qt=b("v"),Xt=b("i"),Ht=It.getContext("2d"),Pt=Bt.getContext("2d"),Rt=Nt.getContext("2d"),Dt=Tt.getContext("2d"),zt=Xt.getContext("2d"),M(),At(),n=null,t=0;t<Lr.length;t++){for(r=C(5,10),e=0;r>e;e++)wt();t+1<Lr.length&&(n=Er.r[Er.r.length-1],ot(Lt(),n))}for(ot(Lt(),Er.r[0]),r=C(5,10),e=0;r>e;e++)wt();o=Er.r[0].rooms[0],i=o.d[0],a=i.dir,h=i.x,o.sr=!0,o.sx=h-o.x,o.sy=i.y-o.y,("E"===i.dir||"W"===i.dir)&&(h=i.y),jt(),Ct(),nt(o,a,h),j()}function M(){Bt.width=It.width=Nt.width=n.innerWidth>300?300:n.innerWidth,Bt.height=It.height=Nt.height=n.innerHeight>300?300:n.innerHeight}function F(){var n,t;if(Dr){for(n=0;n<Qr.length;n++)t=Qr[n],T(t),t.x=A(t.x),t.y=A(t.y),q(t),Y(t),z(t),$(),X(t);for(Wr!==Er.rooms[Er.rooms.length-1]||Vr||(Yt.innerHTML="there is no exit...",setTimeout(function(){Yt.innerHTML="Simulation complete."},3e3),Vr=!0),H(),P(),n=0;n<Qt.length;n++)J(Qt[n]);Ht.clearRect(0,0,It.width,It.height),Pt.clearRect(0,0,Bt.width,Bt.height),r(),i(),y(),x(),qt.innerHTML=_t[Jr.keys[rr]]}}function j(){Xr=n.performance.now(),Kr=Xr-Yr,Yr=Xr,t.dispatchEvent(zr),Tr&&requestAnimationFrame(j)}function C(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function E(n,t){var r=n%(t||16);return(n-r)/(t||16)}function W(n,t,r){return t*r+n}function S(n,t){var r,e,o;if("object"==typeof t){for(r=0;r<n.length;r++)if(e=!0,"object"==typeof n[r]){for(o in t)if(n[r][o]!==t[o]){e=!1;break}if(e===!0)return r}return-1}return n.indexOf(t)}function A(n){return~~(.5+n)}function L(t){for(var r in Ur)Ur[r]===t.keyCode&&t.preventDefault();Gr[t.keyCode]!==t.type&&(t.keyCode===Ur.space&&(Jr.j=1),t.keyCode===Ur.tab&&(Or=Math.min(16*E(n.innerHeight),16*E(n.innerWidth)))),Gr[t.keyCode]=t.type,t.keyCode===Ur.d?Jr.xd=1:t.keyCode===Ur.a&&(Jr.xd=-1)}function O(n){for(var t in Ur)Ur[t]===n.keyCode&&n.preventDefault();Gr[n.keyCode]!==n.type&&n.keyCode===Ur.space&&(Jr.j=0),Gr[n.keyCode]=n.type,n.keyCode===Ur.tab&&(Or=150),(n.keyCode===Ur.d||n.keyCode===Ur.a)&&(Gr[Ur.d]&&Gr[Ur.a]?Gr[Ur.d]===n.type&&Gr[Ur.a]===n.type&&(Jr.xd=0):Jr.xd=0)}function I(n){var t=It.getBoundingClientRect();nr=n.clientX-t.left,tr=n.clientY-t.top,Gt=n.clientX,Jt=n.clientY,Kt=Math.atan2(Jr.y+Jr.h/2-Fr-tr,Jr.x+Jr.w/2-Mr-nr)+Math.PI}function N(n){n.preventDefault(),1===n.which&&(Vt=!0),2===n.which&&(rr++,rr>Jr.keys.length-1&&(rr=0)),3===n.which&&(Zt=!0)}function B(n){n.preventDefault(),1===n.which&&(Vt=!1),3===n.which&&(Zt=!1)}function H(){Vt&&n.performance.now()-Ut>$t&&Jr.keys.length>0&&(Ut=n.performance.now(),Qt.push(D(Jr.x+Jr.w/2+10*Math.cos(Kt),Jr.y+Jr.h/2+10*Math.sin(Kt),Kt,Jr.keys[rr])))}function R(n){n.preventDefault()}function P(){var n,t,r;Zt&&(n=nr+Mr,t=tr+Fr,n>=0&&16*xr>n&&t>=0&&16*mr>t&&(r=W(E(n),E(t),er),0===yr[r]&&_t[Jr.keys[rr]]>0&&(yr[r]=Jr.keys[rr]+2,_t[Jr.keys[rr]]--)))}function D(n,t,r,e){return{x:n,y:t,a:r,key:e}}function T(n){n.xa=n.xa+n.xd/60*Kr,n.xa>n.maxa&&(n.xa=n.maxa),n.xa<-n.maxa&&(n.xa=-n.maxa),0===n.xd&&(n.xa>0?n.xa=n.xa+-2/60*Kr:n.xa<0&&(n.xa=n.xa+2/60*Kr),(n.xa<1/60*Kr&&n.xa>-1/60*Kr||1===n.yd||-1===n.yd)&&(n.xa=0)),n.x=n.x+n.xa}function z(n){n.j&&-1!==n.yd&&n.ju<n.mj&&(n.mj>1&&0===n.ju&&1===n.yd&&n.ju++,(0===n.ju&&0===n.yd||n.ju>0||n.mj>1)&&(n.yd=-1,n.ya=-n.jf,n.js=n.y,n.ju++),n.ht=0),(0===n.yd||!n.j||n.ht>n.jh)&&(n.yd=1),1===n.yd&&(n.j=0,n.ya=n.ya+n.jf/2/60*Kr),0===n.yd&&(n.ya>0?n.ya=n.ya+-1/60*Kr:n.ya<0&&(n.ya=n.ya+1/60*Kr),n.ya<1/60*Kr&&n.ya>-1/60*Kr&&(n.ya=0)),n.ya>n.maxa&&(n.ya=10),n.ht-=n.ya,n.ht=A(n.ht),n.y=n.y+n.ya}function X(n){var t=n.x%16,r=W(E(n.x),E(n.y+n.h),er),e=W(E(n.x+n.w),E(n.y+n.h),er),o=!1;o=0===t?G(yr[r]):G(yr[e])||G(yr[r]),(o||n.y+n.h>16*mr)&&1===n.yd&&(n.y=16*E(n.y),n.ya=0,n.yd=0,n.ju=0,n.j=0,n.ht=0)}function Y(n){var t=n.x%16,r=W(E(n.x),E(n.y-n.h/2),er),e=W(E(n.x+n.w),E(n.y-n.h/2),er),o=!1;o=0===t?G(yr[r]):G(yr[r])||G(yr[e]),o&&1===n.j&&(n.y=16*E(n.y),n.ya=-1,n.yd=1,n.j=0,n.ht=0)}function q(n){var t=n.y%16,r=n.x%16,e=W(E(n.x),E(n.y-n.h/2),er),o=W(E(n.x+n.w),E(n.y-n.h/2),er),i=W(E(n.x),E(n.y),er),a=W(E(n.x+n.w),E(n.y),er),h=W(E(n.x),E(n.y+n.h/2),er),l=W(E(n.x+n.w),E(n.y+n.h/2),er),d=W(E(n.x),E(n.y+n.h),er),u=W(E(n.x+n.w),E(n.y+n.h),er),f=!1,y=!1;0===t?(f=G(yr[h])||G(yr[i]),y=G(yr[l])||G(yr[a])):16*E(n.y+n.h)>n.y+n.h?(f=G(yr[h])||G(yr[i])||G(yr[e]),y=G(yr[l])||G(yr[a])||G(yr[o])):(f=G(yr[h])||G(yr[i])||G(yr[d]),y=G(yr[l])||G(yr[a])||G(yr[u])),0===r?(y||n.x+n.w>16*xr||n.x<0)&&n.xa>0&&(n.x=16*E(n.x),n.xa=0):(y||n.x+n.w>16*xr||n.x<0)&&n.xa>0?(n.x=16*E(n.x),n.xa=0):(f||n.x+n.w>16*xr||n.x<0)&&n.xa<0&&(n.x=16*E(n.x+n.w),n.xa=0)}function G(n){return 9===n&&Et(Wr),0!==n}function J(n){var t,r,e,o,i=!1;n.x+=Math.cos(n.a)*(10/60)*Kr,n.y+=Math.sin(n.a)*(10/60)*Kr,t=E(n.x),r=E(n.y),e=W(t,r,er),0!==yr[e]&&(yr[e]>1&&Jr.keys[rr]===yr[e]-2&&(_t[yr[e]-2]++,yr[e]=0),i=!0),(n.x>16*xr||n.x<0||n.y>16*mr||n.y<0)&&(i=!0),i&&(o=Qt.indexOf(n),o>-1&&Qt.splice(o,1))}function K(n,t){t=t.split("");for(var r=0;r<t.length;r++)t[r]=parseInt(t[r]);return{map:t,type:n}}function Q(n){return{map:n.map.slice(0),type:n.type}}function U(n,t,r,e){var o,i,a,h,l,d,u,f,y,x,m,s,c,g,p,w,v,b,k,M,F=[],j=[],E=Math.max(n,t);for(o=0;E*E>o;o++)F[o]=0;for(F=e(F,n,t,E),a={},f=0;10*E>f;f++)for(y=0;10*E>y;y++)x=Math.floor(y/10),m=Math.floor(f/10),h=gt(r,x,m,"N"),l=gt(r,x,m,"E"),d=gt(r,x,m,"S"),u=gt(r,x,m,"W"),s=W(x,m,E),c=x+"-"+m,(y%10===0||f%10===0)&&(a[c]||(i=Q(lr[F[s]]),a[c]=i),i=a[c]),g=W(y,f,10*E),p=W(y%10,f%10,10),w=10*n>y&&10*t>f&&10*n>y&&10*t>f,j[g]=r.r.u&&0===r.r.id&&0!==i.map[p]&&w?1===C(0,5)?C(0,Lr.length-1)+2:0:i.map[p],r.r.u&&0===j[g]&&9!==i.type&&w&&((1===r.r.id||2===r.r.id||3===r.r.id)&&(j[g]=r.r.id+2),C(0,6)<2&&2===r.r.id&&(j[g]=0),C(0,6)<4&&3===r.r.id&&(j[g]=0),1===C(0,3)&&4===r.r.id&&(j[g]=r.r.id+2),1===C(0,3)&&0===r.r.id&&(j[g]=r.r.id+2)),r.r.u&&2!==r.r.id&&1!==r.r.id&&1===j[g]&&9!==i.type&&w&&(1===C(0,3)?j[g]=r.r.id+2:2===C(0,3)&&(j[g]=0)),v=10*t,b=10*n,k=y%10,M=f%10,0===f&&null===h&&b>y&&w&&(j[g]=1),0===y&&null===u&&v>f&&w&&(j[g]=1),f===v-1&&null===d&&b>y&&w&&(j[g]=1),y===b-1&&null===l&&v>f&&w&&(j[g]=1),x=y%10,m=f%10,x>-1&&2>x&&m>-1&&2>m&&w&&(j[g]=1),x>7&&10>x&&m>-1&&2>m&&w&&(j[g]=1),x>-1&&2>x&&m>7&&10>m&&w&&(j[g]=1),x>7&&10>x&&m>7&&10>m&&w&&(j[g]=1),0===j[g]&&w&&(0===f&&null!==h&&b>y&&h.dt>-1&&(j[g]=h.dt+2),0===y&&null!==u&&v>f&&u.dt>-1&&(j[g]=u.dt+2),f===v-1&&null!==d&&b>y&&d.dt>-1&&(j[g]=d.dt+2),y===b-1&&null!==l&&v>f&&l.dt>-1&&(j[g]=l.dt+2));return{map:j,width:n,height:t,size:E,tiles:10*E}}function V(n){var t,r,e,o,i,a,h,l;if(n.map=U(1*n.mw,1*n.mh,n,function(t,r,e,o){var i,a,h,l,d,u,f,y=0,x=0,m=0;for(i=0;o*o>i;i++)a=gt(n,y,x,"N"),h=gt(n,y,x,"E"),l=gt(n,y,x,"S"),d=gt(n,y,x,"W"),u=[1,3,4,9],f=[2,9,10,11],(0===y||0===x||y===r-1||x===e-1)&&(m=C(0,11)),(0===y||y===r-1)&&(m=f[C(0,3)]),(0===x||x===e-1)&&(m=u[C(0,3)]),(0===y&&0===x||y===r-1&&0===x||y===r-1&&x===e-1||0===y&&x===e-1)&&(m=9),1===n.mw&&(m=f[C(0,3)]),1===n.mh&&(m=u[C(0,3)]),0===y&&0===x&&(m=6),y===r-1&&0===x&&(m=7),0===y&&x===e-1&&(m=5),y===r-1&&x===e-1&&(m=8),(a||l||h||d)&&(m=9),t[W(y,x,o)]=m,y++,y>r-1&&(y=0,x++),x>e-1&&(i=o*o);return t}),n.s>-1&&-1===Jr.keys.indexOf(n.s))for(t=0,r=!1;r===!1&&5>t;)n.sr?(e=1*n.sx,o=1*n.sy):(e=C(1,1*n.mw)-1,o=C(1,1*n.mh)-1),i=C(1,9),a=C(1,9),h=W(10*e+a,10*o+i,n.map.tiles),l=0===n.map.map[h]||n.map.map[h]===n.r.id+2,l&&(r=!0,n.map.map[W(10*e+a,10*o+i,n.map.tiles)]=9),t++}function Z(n,t,r){var e,o,i,a,h;for(e=0;e<n.d.length;e++)o=!1,i=n.d[e],i.dir===t&&(("N"===i.dir||"S"===i.dir)&&(o=r===i.x),("E"===i.dir||"W"===i.dir)&&(o=r===i.y),o&&(a=1*(i.x-n.x),h=1*(i.y-n.y),-1===Jr.y&&(Jr.y=10*h*16+80),-1===Jr.x&&(Jr.x=10*a*16+80),"N"===i.dir&&(a+=Math.floor(.5),Jr.y=0,i.dt>-1&&(Jr.y=16),Jr.x=Jr.x%160+10*a*16),"E"===i.dir&&(h+=Math.floor(.5),a+=1,Jr.x=10*n.mw*16*1-Jr.w,i.dt>-1&&(Jr.x-=16),Jr.y=Jr.y%160+10*h*16),"S"===i.dir&&(a+=Math.floor(.5),h+=1,Jr.y=10*n.mh*16*1-Jr.h,i.dt>-1&&(Jr.y-=16),Jr.x=Jr.x%160+10*a*16),"W"===i.dir&&(h+=Math.floor(.5),Jr.x=0,i.dt>-1&&(Jr.x=16),Jr.y=Jr.y%160+10*h*16)))}function $(){var t,r,e,o,i,a,h,l,d,u;for(t=0;t<Wr.d.length;t++)r=Wr.d[t],e=1*(r.x-Wr.x),o=1*(r.y-Wr.y),i=E(E(Jr.x),10),a=E(E(Jr.x+Jr.w),10),h=E(E(Jr.y),10),l=E(E(Jr.y+Jr.h),10),d=10*Wr.mw*16*1,u=10*Wr.mh*16*1,"N"===r.dir&&(e+=Math.floor(.5)),"E"===r.dir&&(o+=Math.floor(.5),e+=1),"S"===r.dir&&(e+=Math.floor(.5),o+=1),"W"===r.dir&&(o+=Math.floor(.5)),n.performance.now()-Jr.dc>400&&(Jr.x<=0&&-1===Jr.xd&&"W"===r.dir&&e===i&&o===h&&nt(r.r2,"E",r.y),Jr.y<=0&&-1===Jr.yd&&"N"===r.dir&&e===i&&o===h&&nt(r.r2,"S",r.x),Jr.x+Jr.w>=d&&1===Jr.xd&&"E"===r.dir&&e===a&&o===h&&nt(r.r2,"W",r.y),Jr.y+Jr.h>=u&&0!==Jr.yd&&Math.abs(Jr.ya)>5&&"S"===r.dir&&e===i&&(o===l||o===h)&&nt(r.r2,"N",r.x))}function _(){var e,o,a,h,l,d;pr&&(null===Wr&&(br=kr),e=It.width,o=It.height,a=e,h=o,kr>br&&(a=e*br/kr,a=e-a,h=o*br/kr,h=o-h),br>=kr&&(Wr!==gr&&(Pt.clearRect(0,0,e,o),Rt.clearRect(0,0,e,o),Wr=gr,Wr.v=!0,er=gr.map.tiles,yr=gr.map.map,mr=10*gr.map.height,xr=10*gr.map.width,or=10*gr.map.height*16,ir=10*gr.map.width*16,Z(gr,sr,cr),t.title=Wr.c.name,history.pushState(null,null,"#"+t.title),Qt.length=0),a=e*(br-kr)/kr,h=o*(br-kr)/kr),wr.width=e,wr.height=o,vr.clearRect(0,0,e,o),i(),r(),vr.drawImage(Nt,0,0),vr.drawImage(Bt,0,0),vr.drawImage(It,0,0),Ht.clearRect(0,0,e,o),Bt.style.display="none",Nt.style.display="none",vr.globalCompositeOperation="destination-in",l=Jr.x+Jr.w/2-Mr-a/2,d=Jr.y+Jr.h/2-Fr-h/2,vr.beginPath(),vr.rect(l,d,a,h),vr.fillStyle="black",vr.fill(),Ht.drawImage(wr,0,0),br+=2*kr*(Kr/1e3),br>2*kr&&(br=0,Dr=!0,gr=null,pr=!1,Bt.style.display="initial",Nt.style.display="initial",Jr.dc=n.performance.now()))}function nt(n,t,r){sr=t,cr=r,pr=!0,gr=n,Dr=!1,null===n.map&&V(n)}function tt(){var n=Rt.canvas,t=n.width/2,r=n.height/2;Jr.x-Mr+t>n.width?Mr=Jr.x-(n.width-t):Jr.x-t<Mr&&(Mr=Jr.x-t),Jr.y-Fr+r>n.height?Fr=Jr.y-(n.height-r):Jr.y-r<Fr&&(Fr=Jr.y-r),Fr=~~(.5+Fr),Fr=~~(.5+Fr)}function rt(){var n=Dt.canvas,t=n.width/2,r=n.height/2,e=16*(Wr.x+E(E(E(Jr.x),10),1)),o=16*(Wr.y+E(E(E(Jr.y),10),1));e-jr+t>n.width?jr=e-(n.width-t):jr>e-t&&(jr=e-t),o-Cr+r>n.height?Cr=o-(n.height-r):Cr>o-r&&(Cr=o-r),Cr=~~(.5+Cr),Cr=~~(.5+Cr)}function et(n,t,r){Er.f.length=0,Er.f.push({x:n,y:t}),Er.cr=r,Er.r.push(r)}function ot(n,t){for(var r,e,o=!0,i=at(t),a=[],h=null,l=[];o;){if(r=0,h=it(i,l),a.length=0,h)for(a.push(ct(h.x-1,h.y),ct(h.x+1,h.y),ct(h.x,h.y-1),ct(h.x,h.y+1)),e=0;4>e;e++)null===a[e]&&r++;else o=!1;r>2&&(o=!1)}h&&et(h.x,h.y,n)}function it(n,t){if(t.length===n.length)return!1;for(var r=C(0,n.length-1);t.indexOf(r)>-1;)r=C(0,n.length-1);return t.push(r),n[r]}function at(n){var t,r=[],e=Er.rooms;for(n&&(e=n.rooms),t=0;t<e.length;t++)r=ht(r,e[t]);return r}function ht(n,t){for(var r,e=t.x;e<t.x+t.mw;)lt(e,t.y-1,1,1)&&n.push({x:e,y:t.y-1}),lt(e,t.y+t.mh,1,1)&&n.push({x:e,y:t.y+t.mh}),e++;for(r=t.x;r<t.y+t.mh;)lt(r,t.x-1,1,1)&&n.push({x:r,y:t.x-1}),lt(r,t.x+t.mw,1,1)&&n.push({x:r,y:t.x+t.mw}),r++;return n}function lt(n,t,r,e){return dt(n,t,r,e)&&!ut(n,t,r,e)}function dt(n,t,r,e){return n>0&&t>0&&n+r<Er.width&&t+e<Er.height}function ut(n,t,r,e){for(var o=null,i=0;i<Er.rooms.length;){o=Er.rooms[i];{if(!(o.x>n+r-1||o.x+o.mw-1<n||o.y>t+e-1||o.y+o.mh-1<t))return!0;i++}}return!1}function ft(n){for(var t,r,e,o=0,i=null,a=!1,h=100;Er.rooms.length>1&&!a;){for(o=0,o+=yt(n),o+=xt(n),o+=mt(n),o+=st(n),1===n.r.rooms.length&&o>0&&(a=!0),t=0;t<n.d.length;t++)i=n.d[t],St(i,n).r===n.r&&(a=!0);h--,0===h&&(a=!0)}for(t=0;t<n.d.length;t++)r=n.r,e=St(i,n).r,r!==e&&(-1===r.bds.indexOf(e)&&r.bds.push(e),-1===e.bds.indexOf(r)&&e.bds.push(r))}function yt(n){for(var t,r,e,o,i=null,a=null,h=null,l=null,d=[],u=n.x;u<n.x+n.mw;)a=ct(u,n.y-1),null!==a&&d.push({x:u,y:n.y,o:a}),u++;for(t=0,r=0;r<d.length;r++){for(i=d[r],e=!1,o=0;o<n.d.length;o++)n.d[o].r2===i.o&&(e=!0);Math.random()>Sr||S(n.d,i)>=0||e||(h=Ft(i.x,i.y,"N",n,i.o),l=Ft(i.x,i.y-1,"S",i.o,n),n.d.push(h),h.o=l,l.o=h,i.o.d.push(l),t++)}return t}function xt(n){for(var t,r,e,o,i=null,a=null,h=null,l=null,d=[],u=n.x;u<n.x+n.mw;)a=ct(u,n.y+n.mh),null!==a&&d.push({x:u,y:n.y+n.mh-1,o:a}),u++;for(t=0,r=0;r<d.length;r++){for(i=d[r],e=!1,o=0;o<n.d.length;o++)n.d[o].r2===i.o&&(e=!0);Math.random()>Sr||S(n.d,i)>=0||e||(h=Ft(i.x,i.y,"S",n,i.o),l=Ft(i.x,i.y+1,"N",i.o,n),n.d.push(h),h.o=l,l.o=h,i.o.d.push(l),t++)}return t}function mt(n){for(var t,r,e,o,i=null,a=null,h=null,l=null,d=[],u=n.y;u<n.y+n.mh;)a=ct(n.x-1,u),null!==a&&d.push({x:n.x,y:u,o:a}),u++;for(t=0,r=0;r<d.length;r++){for(i=d[r],e=!1,o=0;o<n.d.length;o++)n.d[o].r2===i.o&&(e=!0);Math.random()>Sr||S(n.d,i)>=0||e||(h=Ft(i.x,i.y,"W",n,i.o),l=Ft(i.x-1,i.y,"E",i.o,n),n.d.push(h),h.o=l,l.o=h,i.o.d.push(l),t++)}return t}function st(n){for(var t,r,e,o,i=null,a=null,h=null,l=null,d=[],u=n.y;u<n.y+n.mh;)a=ct(n.x+n.mw,u),null!==a&&d.push({x:n.x+n.mw-1,y:u,o:a}),u++;for(t=0,r=0;r<d.length;r++){for(i=d[r],e=!1,o=0;o<n.d.length;o++)n.d[o].r2===i.o&&(e=!0);Math.random()>Sr||S(n.d,i)>=0||e||(h=Ft(i.x,i.y,"E",n,i.o),l=Ft(i.x+1,i.y,"W",i.o,n),h.o=l,l.o=h,n.d.push(h),i.o.d.push(l),t++)}return t}function ct(n,t){for(var r=null,e=0;e<Er.rooms.length;){r=Er.rooms[e];{if(!(r.x>n||r.x+r.mw-1<n||r.y>t||r.y+r.mh-1<t))return r;e++}}return null}function gt(n,t,r,e){var o,i=null;for(o=0;o<n.d.length;o++)if(i=n.d[o],i.dir===e&&i.x===n.x+t&&i.y===n.y+r)return i;return null}function pt(n){for(var t=0,r=Er.rooms.length;t++<10*n&&Er.rooms.length<r+n;)wt()}function wt(){var n=[],t=it(Er.f,n);t&&vt(kt(t.x,t.y))}function vt(n){if(null===n||!lt(n.x,n.y,n.mw,n.mh))return!1;var t=[];t=bt(t,n),Er.f=ht(t,n),n.c=Er.cr.color,Er.rooms.push(n),Er.cr.rooms.push(n),ft(n)}function ht(n,t){for(var r,e=t.x;e<t.x+t.mw;)lt(e,t.y-1,1,1)&&n.push({x:e,y:t.y-1}),lt(e,t.y+t.mh,1,1)&&n.push({x:e,y:t.y+t.mh}),e++;for(r=t.y;r<t.y+t.mh;)lt(t.x-1,r,1,1)&&n.push({x:t.x-1,y:r}),lt(t.x+t.mw,r,1,1)&&n.push({x:t.x+t.mw,y:r}),r++;return n}function bt(n,t){for(var r=0;r<Er.f.length;r++)Er.f[r].x>=t.x-1&&Er.f[r].x<=t.x+t.mw&&Er.f[r].y>=t.y&&Er.f[r].y<=t.y+t.mh-1||Er.f[r].x>=t.x&&Er.f[r].x<=t.x+t.mw-1&&Er.f[r].y>=t.y-1&&Er.f[r].y<=t.y+t.mh||n.push(Er.f[r]);return n}function kt(n,t){for(var r,e=0,o=1,i=1;e++<25&&(o<Er.cr.maxW||i<Er.cr.maxH)&&Math.random()<.9;)r=parseInt(4*Math.random()),0===r&&i<Er.cr.maxH&&lt(n,t-1,o,i+1)&&(t--,i++),1===r&&i<Er.cr.maxH&&lt(n,t,o,i+1)&&i++,2===r&&o<Er.cr.maxW&&lt(n-1,t,o+1,i)&&(n--,o++),3===r&&o<Er.cr.maxW&&lt(n,t,o+1,i)&&o++;return Mt(n,t,o,i,Er.cr)}function Mt(n,t,r,e,o){return{x:n,y:t,mw:r,mh:e,c:null,r:o,s:-1,sx:0,sy:0,sr:!1,v:!1,d:[],map:null}}function Ft(n,t,r,e,o){return{x:n,y:t,dt:-1,dir:r,r1:e,r2:o,o:null}}function jt(){var n,t,r=null,e=null;for(n=0;n<Er.rooms.length;n++)for(r=Er.rooms[n],r.s=-1,t=0;t<r.d.length;t++)e=r.d[t],e.dt=-1}function Ct(){var n,t,r,e,o=null,i=null,a=null,h=null;for(n=0;n<Er.r.length;n++)for(t=[],i=Er.r[n],0!==n&&(h=it(i.rooms,t),h.s=(n+1)%Lr.length),r=0;r<i.rooms.length;r++)for(h=i.rooms[r],0===n&&h.sr&&(h.s=(n+1)%Lr.length),e=0;e<h.d.length;e++)o=h.d[e],a=St(o,h).r,a!==i&&-1===o.o.dt&&(o.o.dt=n%Lr.length)}function Et(n){-1===Jr.keys.indexOf(n.s)&&n.s>-1&&(Jr.keys.push(n.s),Wt())}function Wt(){var n,t,r,e,o;for(Yt.innerHTML="find "+(5-Jr.keys.length)+" color circles",5-Jr.keys.length===0&&(Yt.innerHTML="find the exit"),n=0;n<Er.r.length;n++)Jr.keys.indexOf(Er.r[n].id)>-1&&(Er.r[n].u=!0);for(t=0;t<Er.rooms.length;t++)for(r=Er.rooms[t],Jr.keys.indexOf(r.s)>-1&&(r.s=-1,null!==r.map&&(e=r.map.map.indexOf(9),e>-1&&(r.map.map[e]=0))),n=0;n<r.d.length;n++)o=r.d[n],Jr.keys.indexOf(o.dt)>-1&&(o.dt=-1)}function St(n,t){return n.r1===t?n.r2:n.r1}function At(){Er={width:0,height:0,rooms:[],f:[],r:[],cr:0},Ar=0,Er.width=80,Er.height=48,et(40,24,Lt()),pt(1)}function Lt(){var n=Ot(Lr[Ar],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1,Ar);return Ar=(Ar+1)%Lr.length,n}function Ot(n,t,r,e){return{color:n,maxW:t,maxH:r,id:e,u:!1,bds:[],rooms:[]}}var It,Nt,Bt,Ht,Rt,Pt,Dt,Tt,zt,Xt,Yt,qt,Gt,Jt,Kt,Qt,Ut,Vt,Zt,$t,_t,nr,tr,rr,er,or,ir,ar,hr,lr,dr,ur,fr,yr,xr,mr,sr,cr,gr,pr,wr,vr,br,kr,Mr,Fr,jr,Cr,Er,Wr,Sr,Ar,Lr,Or=150,Ir=0,Nr=0,Br=[],Hr=0,Rr=!1,Pr=0,Dr=!0,Tr=!0,zr=new CustomEvent("frame"),Xr=n.performance.now(),Yr=n.performance.now(),qr={},Gr={},Jr={x:-1,y:-1,w:16,h:32,img:null,xd:0,yd:1,xa:0,ya:0,maxa:5,jf:7,jh:50,js:0,j:0,ju:0,ht:0,mj:1,a:0,"ῼ":5,dc:n.performance.now(),"mῼ":5,keys:[]},Kr=Xr-Yr,Qr=[Jr],Ur={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192},Vr=!1;for(setInterval(function(){V(Wr),er=Wr.map.tiles,yr=Wr.map.map,mr=10*Wr.map.height,xr=10*Wr.map.width,or=10*Wr.map.height*16,ir=10*Wr.map.width*16},15e3),w("keydown",L),w("keyup",O),w("resize",M),w("DOMContentLoaded",k),w("frame",F),w("frame",_),w("mousemove",I),w("mousedown",N),w("mouseup",B),w("contextmenu",R),n.addEventListener("resize",v),t.addEventListener("DOMContentLoaded",v),t.addEventListener("mousedown",v),t.addEventListener("mouseup",v),t.addEventListener("keydown",v),t.addEventListener("keyup",v),t.addEventListener("frame",v),t.addEventListener("mousemove",v),t.addEventListener("contextmenu",v),Gt=0,Jt=0,Kt=0,Qt=[],Ut=n.performance.now(),Vt=!1,Zt=!1,$t=150,_t=[0,0,0,0,0],nr=-1,tr=-1,rr=0,er=0,or=0,ir=0,ar=er,hr=er,lr=[],dr=[],ur=0;100>ur;ur++)dr[ur]=0;for(fr="1111111111111111111100000000000000000000000000000000000000000000000000000000000011111111111111111111,1100000011111000001111110000111100000011110000001111000000111100000111110000111111000000111100000011,1000000001110000001111100001110001001000000000000000000000000000000000000111100011111111111111111111,1111111111111000011100000000000000000000000011000000011110000000000000000000000011000000111100000111,1111000011110000001111000000111100000011110001111111000000001100000000110000000011111111111111111111,1111111111100000000010000000001000000000100000000010000000001000000000100000000010000011111000000011,1111111111000000000100000000010000000001000000000100000000010000000001000000000110000000011100000001,1111000011110000001111000000111100000011110001111100000111110000111111000011111111111111111111111111,1110000011110000000100000000000000000000000011000000001100000000000000000000000011000000111100000111,1100000011111000001100110000110000000011000000001100000000110000000111000000111111000000111100000011,1100000011111000001111110000001100000000110000000011000000001100000111110000111111000000111100000011".split(","),lr.push({map:dr,type:0}),ur=0;ur<fr.length;ur++)lr.push(K(ur+1,fr[ur]));yr=null,xr=0,mr=0,sr=0,cr=0,gr=null,pr=!1,wr=t.createElement("canvas"),vr=wr.getContext("2d"),br=0,kr=1,Mr=0,Fr=0,jr=0,Cr=0,Er=null,Wr=null,Sr=.2,Ar=0,Lr=[{bg:"#BBBBBB",bd:"#A0A0A0",o:"#CFCFCF",l:"#FFFFFF",name:"Dungeon"},{bg:"#FF3333",bd:"#990000",o:"#FF0000",l:"#FFAAAA",name:"Fire"},{bg:"#00BB00",bd:"#006600",o:"#00BB00",l:"#AAFFAA",name:"Air"},{bg:"#3333FF",bd:"#000066",o:"#0000FF",l:"#AAAAFF",name:"Water"},{bg:"#9F9F9F",bd:"#555555",o:"#555555",l:"#000000",name:"Earth"}]}(window,document);