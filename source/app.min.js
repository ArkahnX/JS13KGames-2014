function e(e,o,r){null!==e.img&&context.drawImage(e.img,e.x||o,e.y||r,e.w,e.h)}function o(e,o,r,t){j[o][r]||(e[r]=t,j[o][r]=t),j[o][r]!==t&&(e[r]=t,j[o][r]=t)}function r(){for(var e=(Fo[0].width,Fo[0].height,Fo[0].size*ko),o=0;e>o;o++)for(var r=0;e>r;r++)0!==Fo[0].map[w(r,o,e)]&&i(r,o,Fo[0].map,e,1,1);for(var o=0;e>o;o++)for(var r=0;e>r;r++)0!==Fo[0].map[w(r,o,e)]&&n(r,o,Fo[0].map,e,1,1)}function t(){var e=window.performance.now(),o=v(yo)-1,r=v(ho)-1,t=v(yo)+v(G.width)+2,n=v(ho)+v(G.height)+2;0>o&&(o=0),0>r&&(r=0),t>bo&&(t=bo),n>bo&&(n=bo);for(var a=r;n>a;a++)for(var l,c=0,m=-bo*uo*2,s=0,u=o;t>u;u++)0!==No[w(u,a,bo)]&&(c+=1*uo,m===-bo*uo*2&&(m=u*uo-yo),l=0>a-1?-1:No[w(u,a-1,bo)],0===l&&(s=1)),(0===No[w(u,a,bo)]||u===t-1)&&i(u,a,No,bo,m,c,s),(0===No[w(u,a,bo)]||u===t-1)&&(c=0,m=-bo*uo*2,s=0);var d=window.performance.now()-e;d>F&&(F=d)}function i(e,r,t,i,n,a,l){var c=n,m=r*uo-ho;o(B,"tile","fillStyle","#FF9900"),1===l?B.fillRect(c,m-5,a,21):B.fillRect(c,m,a,uo)}function n(e,r,t,i){var n=e*uo-yo,l=r*uo-ho,c=(e+1)*uo-yo,m=(r+1)*uo-ho,s=t[w(e-1,r,i)],u=t[w(e,r-1,i)],d=t[w(e+1,r,i)],p=t[w(e,r+1,i)],y=t[w(e-1,r-1,i)],h=t[w(e+1,r-1,i)],v=t[w(e-1,r+1,i)],f=t[w(e+1,r+1,i)];0>e-1&&(s=-1,v=-1,y=-1),0>r-1&&(u=-1,y=-1,h=-1),e+1>i-1&&(d=-1,h=-1,f=-1),r+1>i-1&&(p=-1,v=-1,f=-1),o(J,"border","strokeStyle","#ff0000"),o(J,"border","lineWidth",2),J.beginPath(),0===u&&(a(n,l-5,c,l-5),a(n,l+3,c,l+3)),-1===u&&a(n,l,c,l),1>d&&(0===u?a(c,l-5,c,m):a(c,l,c,m)),1>p&&a(c,m,n,m),1>s&&(0===u?a(n,m,n,l-5):a(n,m,n,l)),s>0&&u>0&&1>y&&a(n,l-5,n,l+3),d>0&&u>0&&1>h&&a(c,l-5,c,l+3),J.closePath(),J.stroke()}function a(e,o,r,t){J.moveTo(e,o),J.lineTo(r,t)}function l(e,o){_[e]||(_[e]=[]),_[e].push(o)}function c(e,o,r,t,i,n){var a={x:e,y:o,w:r,h:t,angle:0,img:i};return n&&(a.xDirection=0,a.yDirection=0,a.xAccel=0,a.yAccel=1,a.maxAccel=5),n&&(a.jumpForce=7,a.jumpHeight=50,a.jumpStart=0,a.jumping=0,a.jumpsUsed=0,a.maxJumps=3),a}function m(e){var o=e.type;if(_[o]&&_[o].length>0)for(var r=0;r<_[o].length;r++)_[o][r](e)}function s(e,o){return document[W[e]](o)}function u(){G=s(O,"player"),N=s(O,"border"),Y=s(O,"tile"),X=G.getContext("2d"),J=N.getContext("2d"),B=Y.getContext("2d"),d(),y()}function d(){N.width=G.width=Y.width=window.innerWidth>300?300:window.innerWidth,N.height=G.height=Y.height=window.innerHeight>300?300:window.innerHeight}function p(){X.clearRect(0,0,G.width,G.height),J.clearRect(0,0,N.width,N.height),B.clearRect(0,0,Y.width,Y.height);for(var e=0;e<co.length;e++){var r=co[e];C(r),r.x=~~(.5+r.x),r.y=~~(.5+r.y),k(r),T(r),z(r),R(r)}E(),t();for(var e=0;e<co.length;e++){var r=co[e];o(X,"player","fillStyle","#000000"),X.fillRect(r.x-yo,r.y-ho,r.w,r.h)}}function y(){Z=window.performance.now(),lo=Z-$,$=Z,document.dispatchEvent(Q),V&&requestAnimationFrame(y)}function h(e,o){return Math.floor(Math.random()*(o-e+1)+e)}function v(e,o){var r=e%(o||16);return(e-r)/(o||16)}function w(e,o,r){return o*r+e}function f(e){for(var o in mo)mo[o]===e.keyCode&&e.preventDefault();eo[e.keyCode]!==e.type&&e.keyCode===mo.space&&(ao.jumping=ro),eo[e.keyCode]=e.type,e.keyCode===mo.d?ao.xDirection=io:e.keyCode===mo.a&&(ao.xDirection=no)}function x(e){for(var o in mo)mo[o]===e.keyCode&&e.preventDefault();eo[e.keyCode]!==e.type&&e.keyCode===mo.space&&(ao.jumping=to),eo[e.keyCode]=e.type,(e.keyCode===mo.d||e.keyCode===mo.a)&&(eo[mo.d]&&eo[mo.a]?eo[mo.d]===e.type&&eo[mo.a]===e.type&&(ao.xDirection=to):ao.xDirection=to)}function g(e){vo.length=e.length}function M(e,o,r,t){vo.length=0;for(var i=0,n=0;o>n;n++)for(var a=0;r>a;a++)0===t&&(i=w(n,a,ko)),1===t&&(i=w(a,o-n-1,ko)),2===t&&(i=w(o-n-1,r-a-1,ko)),3===t&&(i=w(r-a-1,n,ko)),vo[w(n,a,ko)]=e[i];return vo.slice(0)}function L(){}function S(){for(var e,o=0;po>o;o++)for(var r=0;po>r;r++){var t=Math.floor(r/ko)+"-"+Math.floor(o/ko);if(r%ko===0||o%ko===0){var i=null;wo[t]||(i=h(0,3),e=P(jo[h(0,To)]),1===Math.floor(r/ko)&&1===Math.floor(o/ko)&&(e=P(jo[9])),0===Math.floor(r/ko)&&0===Math.floor(o/ko)&&(e=P(jo[9])),1===Math.floor(r/ko)&&0===Math.floor(o/ko)&&(e=P(jo[7])),1===Math.floor(r/ko)&&1===Math.floor(o/ko)&&(e=P(jo[5])),2===Math.floor(r/ko)&&1===Math.floor(o/ko)&&(e=P(jo[7])),2===Math.floor(r/ko)&&2===Math.floor(o/ko)&&(e=P(jo[3])),wo[t]=e.options&Ro?M(e,ko,ko,i):e),e=wo[t]}so[w(r,o,po)]=e.map[w(r%ko,o%ko,ko)]}}function A(e,o,r){return(o*r||Eo)+e}function C(e){e.xAccel=e.xAccel+e.xDirection/60*lo,e.xAccel>e.maxAccel&&(e.xAccel=e.maxAccel),e.xAccel<-e.maxAccel&&(e.xAccel=-e.maxAccel),0===e.xDirection&&(e.xAccel>0?e.xAccel=e.xAccel+2*no/60*lo:e.xAccel<0&&(e.xAccel=e.xAccel+2*io/60*lo),(e.xAccel<io/60*lo&&e.xAccel>no/60*lo||e.yDirection===ro||e.yDirection===oo)&&(e.xAccel=0)),e.x=e.x+e.xAccel}function z(e){e.jumping&&e.yDirection!==oo&&e.jumpsUsed<e.maxJumps&&(e.yDirection=oo,e.yAccel=-e.jumpForce,e.jumpStart=e.y,e.jumpsUsed++),(e.yDirection===to||!e.jumping||e.jumpStart-e.y>e.jumpHeight)&&(e.yDirection=ro),e.yDirection===ro&&(e.jumping=to,e.yAccel=e.yAccel+e.jumpForce/2/60*lo),e.yDirection===to&&(e.yAccel>0?e.yAccel=e.yAccel+oo/60*lo:e.yAccel<0&&(e.yAccel=e.yAccel+ro/60*lo),e.yAccel<ro/60*lo&&e.yAccel>oo/60*lo&&(e.yAccel=0)),e.yAccel>e.maxAccel&&(e.yAccel=10),e.y=e.y+e.yAccel}function R(e){var o=e.x%16,r=w(v(e.x),v(e.y+e.h),bo),t=w(v(e.x+e.w),v(e.y+e.h),bo),i=!1;i=0===o?No[r]:0!==No[t]||0!==No[r],(i||e.y+e.h>16*Do)&&e.yDirection===ro&&(e.y=16*v(e.y),e.yAccel=0,e.yDirection=0,e.jumpsUsed=0,e.jumping=0)}function T(e){var o=e.x%16,r=w(v(e.x),v(e.y-e.h/2),bo),t=w(v(e.x+e.w),v(e.y-e.h/2),bo),i=!1;i=0===o?0!==No[r]:0!==No[r]||0!==No[t],i&&1===e.jumping&&(e.y=16*v(e.y),e.yAccel=-1,e.yDirection=ro,e.jumping=0)}function k(e){var o=e.y%16,r=e.x%16,t=w(v(e.x),v(e.y-e.h/2),bo),i=w(v(e.x+e.w),v(e.y-e.h/2),bo),n=w(v(e.x),v(e.y),bo),a=w(v(e.x+e.w),v(e.y),bo),l=w(v(e.x),v(e.y+e.h/2),bo),c=w(v(e.x+e.w),v(e.y+e.h/2),bo),m=w(v(e.x),v(e.y+e.h),bo),s=w(v(e.x+e.w),v(e.y+e.h),bo),u=!1,d=!1;0===o?(u=0!==No[l]||0!==No[n],d=0!==No[c]||0!==No[a]):16*v(e.y+e.h)>e.y+e.h?(u=0!==No[l]||0!==No[n]||0!==No[t],d=0!==No[c]||0!==No[a]||0!==No[i]):(u=0!==No[l]||0!==No[n]||0!==No[m],d=0!==No[c]||0!==No[a]||0!==No[s]),0===r?(d||e.x+e.w>16*Po||e.x<0)&&e.xAccel>0&&(e.x=16*v(e.x),e.xAccel=0):(d||e.x+e.w>16*Po||e.x<0)&&e.xAccel>0?(e.x=16*v(e.x),e.xAccel=0):(u||e.x+e.w>16*Po||e.x<0)&&e.xAccel<0&&(e.x=16*v(e.x+e.w),e.xAccel=0)}function b(e,o,r,t,i,n,a){return{map:a,doors:i,paths:n,options:1*e|2*o|4*r,type:t}}function P(e){return{map:e.map.slice(0),doors:e.doors,paths:e.paths,options:e.options,type:e.type}}function D(e,o,r,t,i,n,a,l,c){for(var m=[],s=[],u=Math.max(e,o),d=0;u*u>d;d++)m[d]=0;m=c(m,e,o,u);for(var p,y=[],v=0;u*ko>v;v++)for(var f=0;u*ko>f;f++){var x=w(Math.floor(f/ko),Math.floor(v/ko),u),g=Math.floor(f/ko)+"-"+Math.floor(v/ko);if(f%ko===0||v%ko===0){var M=null;y[g]||(M=h(0,3),p=P(jo[m[x]]),y[g]=p.options&Ro?i(p,ko,ko,M):p),p=y[g]}s[w(f,v,u*ko)]=p.map[w(f%ko,v%ko,ko)]}return bo=u*ko,No=s,Do=u*ko,Po=u*ko,{map:s,doors:a,paths:l,width:e,height:o,size:u,options:1*r|2*t|4*i,type:n}}function I(e,o,r,t,i,n,a,l,c,m){l.length=0;for(var s=0;s<jo.length;s++)a[s]=s;var u=n[w(r,t-1,i)],d=n[w(r-1,t,i)],p=n[w(r+1,t,i)],y=n[w(r,t+1,i)];if(0>t-1&&(u=-1),0>r-1&&(d=-1),t+1>m-1&&(y=-1),r+1>c-1&&(p=-1),4===u||2===u||6===u||7===u||9===u||13===u){console.warn("Room for Above");for(var v=0;v<a.length;v++)a[v]=-1;a[2]=2,a[3]=3,a[5]=5,a[8]=8,a[9]=9,-1!==d&&(1===d||3===d||4===d||5===d||6===d||9===d||10===d)&&(console.warn("Room for Above and Left"),a[2]=-1,a[5]=-1,a[3]=3,a[8]=8,a[9]=9,-1!==p&&(1===p||3===p||4===p||7===p||8===p||9===p||11===p)&&(a[8]=-1)),-1!==p&&(1===p||3===p||4===p||7===p||8===p||9===p||11===p)&&(console.warn("Room for Above and Left"),a[2]=-1,a[8]=-1,a[3]=3,a[5]=5,a[9]=9,-1!==d&&(1===d||3===d||4===d||5===d||6===d||9===d||10===d)&&(a[5]=-1))}if(0===r&&(console.warn("Left of Map"),a[7]=-1,a[8]=-1,a[1]=-1),r===c-1&&(console.warn("Right of Map"),a[5]=-1,a[6]=-1,a[1]=-1),0===t&&(console.warn("Top of Map"),a[3]=-1,a[5]=-1,a[8]=-1,a[2]=-1),t===m-1&&(console.warn("Bottom of Map"),a[4]=-1,a[6]=-1,a[7]=-1,a[2]=-1),r===e&&t===o){console.warn("Room for Start");for(var v=0;v<a.length;v++)a[v]=-1;a[10]=10,a[11]=11,a[12]=12,a[13]=13,-1===d&&(a[11]=-1),-1===u&&(a[12]=-1),-1===p&&(a[10]=-1),-1===y&&(a[13]=-1)}else a[10]=-1,a[11]=-1,a[12]=-1,a[13]=-1;a[9]=9;for(var v=0;v<a.length;v++)-1!==a[v]&&l.push(a[v]);var f=l[h(0,l.length-1)];11===f&&-1===[1,3,4,5,6,9].indexOf(d)&&I(e,o,r-1,t,i,n,a,l,c,m),12===f&&-1===[2,4,6,7,9].indexOf(u)&&I(e,o,r,t-1,i,n,a,l,c,m),n[w(r,t,i)]=f}function E(){var e=B.canvas,o=e.width/2,r=e.height/2;ao.x-yo+o>e.width?yo=ao.x-(e.width-o):ao.x-o<yo&&(yo=ao.x-o),ao.y-ho+r>e.height?ho=ao.y-(e.height-r):ao.y-r<ho&&(ho=ao.y-r),ho=~~(.5+ho),ho=~~(.5+ho)}var j={player:{},border:{},tile:{}},F=0,G,Y,N,X,B,J,U,H,W=["getElementById","querySelector","querySelectorAll"],O=0,q=1,K=2,V=!0,Q=new CustomEvent("frame"),Z=window.performance.now(),$=window.performance.now(),_={},eo={},oo=-1,ro=1,to=0,io=1,no=-1,ao={x:151,y:48,w:16,h:32,img:null,xDirection:0,yDirection:1,xAccel:0,yAccel:0,maxAccel:5,jumpForce:7,jumpHeight:50,jumpStart:0,jumping:0,jumpsUsed:0,maxJumps:1,angle:0},lo=Z-$,co=[ao],mo={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};l("keydown",f),l("keyup",x),l("resize",d),l("DOMContentLoaded",u),l("frame",p),window.addEventListener("resize",m),document.addEventListener("DOMContentLoaded",m),document.addEventListener("mousedown",m),document.addEventListener("mouseup",m),document.addEventListener("keydown",m),document.addEventListener("keyup",m),document.addEventListener("frame",m);for(var so=[],uo=16,po=3*ko,yo=0,ho=0,vo=[],wo={},fo=[0,1],xo=[],go={w:16,h:16,img:null,angle:0},Mo=1,Lo=2,So=4,Ao=8,Co=1,zo=2,Ro=4,To=9,ko=10,bo=0,Po=0,Do=0,Io=bo,Eo=bo,jo=[],Fo=[],Go=[],Yo=0;ko*ko>Yo;Yo++)Go[Yo]=0;var No=null,Xo=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Bo=[1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1],Jo=[1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Uo=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],Ho=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Wo=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],Oo=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,1,0,1,1,0,0,0,0,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1],qo=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Ko=[1,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],Vo=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],Qo=[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Zo=[1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1],$o=[1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1];jo.push(b(0,0,0,0,0,15,Go)),jo.push(b(0,0,0,1,0,5,Xo)),jo.push(b(0,0,0,2,0,10,Bo)),jo.push(b(0,0,0,3,0,11,Jo)),jo.push(b(0,0,0,4,0,13,Uo)),jo.push(b(0,0,0,5,0,6,Ho)),jo.push(b(0,0,0,6,0,12,Wo)),jo.push(b(0,0,0,7,0,9,Oo)),jo.push(b(0,0,0,8,0,3,qo)),jo.push(b(0,0,0,9,0,15,Ko)),jo.push(b(0,0,0,10,1,14,Vo)),jo.push(b(0,0,0,11,4,11,Qo)),jo.push(b(0,0,0,12,8,7,Zo)),jo.push(b(0,0,0,13,2,13,$o)),Fo.push(D(4,4,0,0,0,0,0,15,function(e,o,r,t){for(var i=h(0,o-1),n=h(0,r-1),a=(h(0,3),0),l=0,c=[],m=[],s=0;t*t>s;s++)I(i,n,a,l,t,e,c,m,o,r),a++,a>o-1&&(a=0,l++),l>r-1&&(s=t*t);return e}));