! function(n, t) {
	function e(n) {
		return Math.sin(6.283184 * n)
	}

	function r(n) {
		return e(n) < 0 ? -1 : 1
	}

	function o(n) {
		return n % 1 - .5
	}

	function i(n) {
		var t = n % 1 * 4;
		return 2 > t ? t - 1 : 3 - t
	}

	function a(n) {
		return .00390625 * Math.pow(1.059463094, n - 128)
	}

	function f(n, t) {
		setTimeout(function() {
			var e = new Uint8Array(n * vr * 2),
				r = e.length - 2,
				o = function() {
					for (var n = new Date, i = 0; r >= 0;)
						if (e[r] = 0, e[r + 1] = 128, r -= 2, i += 1, i % 1e3 === 0 && new Date - n > br) return void setTimeout(o, 0);
					setTimeout(function() {
						t(e)
					}, 0)
				};
			setTimeout(o, 0)
		}, 0)
	}

	function l(n, t, e, r, o) {
		var i = e.ft * r >> 1,
			a = e.fm / 255,
			f = 0,
			l = function() {
				for (var e, r, u, h = new Date, d = 0; t - i > f;)
					if (e = 4 * f, r = 4 * (f + i), u = n[r] + (n[r + 1] << 8) + (n[e + 2] + (n[e + 3] << 8) - 32768) * a, n[r] = 255 & u, n[r + 1] = u >> 8 & 255, u = n[r + 2] + (n[r + 3] << 8) + (n[e] + (n[e + 1] << 8) - 32768) * a, n[r + 2] = 255 & u, n[r + 3] = u >> 8 & 255, ++f, d += 1, d % 1e3 === 0 && new Date - h > br) return void setTimeout(l, 0);
				setTimeout(o, 0)
			};
		setTimeout(l, 0)
	}

	function u(n) {
		return {
			song: n,
			waveSize: wr * n.songLen
		}
	}

	function h(n, t) {
		y(n, function(n) {
			d(n, t)
		})
	}

	function d(n, t) {
		var e, r, o, i, a, f, l, u;
		null === kr && (kr = new AudioContext), e = n.mixBuf, r = n.waveSize, o = r * vr * 2, i = kr.createBuffer(vr, n.waveSize, wr), a = i.getChannelData(0), f = i.getChannelData(1), l = 0, u = function() {
			for (var n, r = new Date, h = 0; o / 2 > l;)
				if (n = 4 * (e[4 * l] + (e[4 * l + 1] << 8) - 32768), n = -32768 > n ? -32768 : n > 32767 ? 32767 : n, a[l] = n / 32768, n = 4 * (e[4 * l + 2] + (e[4 * l + 3] << 8) - 32768), n = -32768 > n ? -32768 : n > 32767 ? 32767 : n, f[l] = n / 32768, l += 1, h += 1, h % 1e3 === 0 && new Date - r > br) return void setTimeout(u, 0);
			setTimeout(function() {
				t(i)
			}, 0)
		}, setTimeout(u, 0)
	}

	function s(n) {
		return {
			mixBuf: n,
			waveSize: n.length / vr / 2
		}
	}

	function y(n, t) {
		f(n.waveSize, function(e) {
			var r = 0,
				o = function() {
					r < n.song.songData.length ? (r += 1, m(n, n.song.songData[r - 1], e, o)) : t(s(e))
				};
			o()
		})
	}

	function c(n, t) {
		return {
			instr: n,
			rowLen: t || 5605,
			osc_lfo: Mr[n.lw],
			osc1: Mr[n.ow],
			osc2: Mr[n.pw],
			attack: n.ea,
			sustain: n.es,
			release: n.er,
			panFreq: Math.pow(2, n.fp - 8) / t,
			lfoFreq: Math.pow(2, n.lr - 8) / t
		}
	}

	function m(n, t, e, r) {
		f(n.waveSize, function(o) {
			var i = n.waveSize,
				a = n.waveSize * vr * 2,
				f = n.song.rowLen,
				u = n.song.endPattern,
				h = c(t, f),
				d = 0,
				s = 0,
				y = 0,
				m = function() {
					for (var n, e, r = new Date;;)
						if (32 !== y) {
							if (s === u - 1) return void setTimeout(p, 0);
							if (n = t.p[s], n && (e = t.c[n - 1].n[y], e && x(h, e, o, d)), d += f, y += 1, new Date - r > br) return void setTimeout(m, 0)
						} else y = 0, s += 1
				},
				p = function() {
					l(o, i, t, f, w)
				},
				g = 0,
				w = function() {
					for (var n, t = new Date, i = 0; a > g;)
						if (n = e[g] + (e[g + 1] << 8) + o[g] + (o[g + 1] << 8) - 32768, e[g] = 255 & n, e[g + 1] = n >> 8 & 255, g += 2, i += 1, i % 1e3 === 0 && new Date - t > br) return void setTimeout(w, 0);
					setTimeout(r, 0)
				};
			setTimeout(m, 0)
		})
	}

	function x(n, t, r, o) {
		var i, f, l, u, h, d, s, y, c, m, x = (new Date, 0),
			p = 0,
			g = a(t + 12 * (n.instr.oo - 8) + n.instr.od) * (1 + 8e-4 * n.instr.oe),
			w = a(t + 12 * (n.instr.po - 8) + n.instr.pd) * (1 + 8e-4 * n.instr.pe),
			v = n.instr.fr / 255,
			b = 0,
			k = 0;
		for (i = n.attack + n.sustain + n.release - 1; i >= 0; --i) f = i + o, l = n.osc_lfo(f * n.lfoFreq) * n.instr.la / 512 + .5, u = 1, i < n.attack ? u = i / n.attack : i >= n.attack + n.sustain && (u -= (i - n.attack - n.sustain) / n.release), h = g, n.instr.lf && (h += l), n.instr.ox && (h *= u * u), x += h, d = n.osc1(x) * n.instr.ov, h = w, n.instr.px && (h *= u * u), p += h, d += n.osc2(p) * n.instr.pv, n.instr.nf && (d += (2 * Math.random() - 1) * n.instr.nf * u), d *= u / 255, s = n.instr.fq, n.instr.lq && (s *= l), s = 1.5 * Math.sin(3.141592 * s / wr), b += s * k, y = v * (d - k) - b, k += s * y, c = n.instr.ff, 1 === c && (d = y), 2 === c && (d = b), 3 === c && (d = k), 4 === c && (d = b + y), h = e(f * n.panFreq) * n.instr.ft / 512 + .5, d *= 39 * n.instr.em, f = 4 * f, f + 3 < r.length && (m = r[f] + (r[f + 1] << 8) + d * (1 - h), r[f] = 255 & m, r[f + 1] = m >> 8 & 255, m = r[f + 2] + (r[f + 3] << 8) + d * h, r[f + 2] = 255 & m, r[f + 3] = m >> 8 & 255)
	}

	function p() {
		var n, t, e, r, o, i, a, f, l, u, h, d, s, y, c, m, x, p;
		for (pt(), W(ae, mr.c.bd, mr.c.bd, 2), ae.fillRect(0, 0, re.width, re.height), ae.fillStyle = mr.c.bg, ae.clearRect(0 - hr, 0 - dr, _e, Ye), n = H(hr) - 1, t = H(dr) - 1, e = H(hr) + H(ee.width) + 2, r = H(dr) + H(ee.height) + 2, 0 > n && (n = 0), 0 > t && (t = 0), e > Xe && (e = Xe), r > Xe && (r = Xe), o = {}, i = t; r > i; i++)
			for (a = 0, f = 16 * -Xe * 2, l = 0, W(ae, mr.c.bg, !1, !1), h = n; e > h; h++) 1 === $e[U(h, i, Xe)] && (a += 16, f === 16 * -Xe * 2 && (f = 16 * h - hr), u = 0 > i - 1 ? -1 : $e[U(h, i - 1, Xe)], 0 === u && (l = 1)), (1 !== $e[U(h, i, Xe)] || h === e - 1) && (d = f, s = 16 * i - dr, l ? T(ae, !0, !1, d, s - 5, a, 21) : T(ae, !0, !1, d, s, a, 16)), (1 !== $e[U(h, i, Xe)] || h === e - 1) && (a = 0, f = 16 * -Xe * 2, l = 0);
		for (i = t; r > i; i++)
			for (h = n; e > h; h++) $e[U(h, i, Xe)] > 1 && (9 === $e[U(h, i, Xe)] && mr.s > -1 ? (W(ae, gr[mr.s].l, gr[mr.s].bd, 2), y = 8, ae.beginPath(), ae.arc(16 * h + 8 - hr, 16 * i + 8 - dr, y, 0, 2 * Math.PI, !1), ae.fill(), ae.stroke(), ae.closePath()) : 9 !== $e[U(h, i, Xe)] && 10 !== $e[U(h, i, Xe)] && (W(ae, gr[$e[U(h, i, Xe)] - 2].l, !1, !1), d = 16 * h - hr, s = 16 * i - dr, l && T(ae, !0, !1, d, s - 5, a, 21)));
		for (h = 0; nr / 10 > h; h++)
			for (i = 0; tr / 10 > i; i++) c = Lt(mr, h, i, "N"), m = Lt(mr, h, i, "E"), x = Lt(mr, h, i, "S"), p = Lt(mr, h, i, "W"), c && D(c, h, i), m && D(m, h, i), x && D(x, h, i), p && D(p, h, i);
		g(n, t, e, r, 1), g(n, t, e, r, 4), w(n, t, e, r, 2), w(n, t, e, r, 8)
	}

	function g(n, t, e, r, o) {
		var i, a, f, l, u, h, d, s, y, c, m, x, p, g;
		for (i = n; e > i; i++)
			for (a = 0, f = 16 * -Xe * 2, l = 0, u = 0, h = t; r > h; h++) d = $e[U(i + 1, h - 1, Xe)], s = $e[U(i, h - 1, Xe)], y = $e[U(i - 1, h - 1, Xe)], 1 === o ? (u = $e[U(i - 1, h, Xe)], 0 > i - 1 && (u = -1)) : 4 === o && (u = $e[U(i + 1, h, Xe)], i + 1 > Xe - 1 && (u = -1)), 0 !== $e[U(i, h, Xe)] && 9 !== $e[U(i, h, Xe)] && 1 > u && (a += 16, f === 16 * -Xe * 2 && (0 === s && (l = 1), f = 16 * h - dr)), (0 === $e[U(i, h, Xe)] || 9 === $e[U(i, h, Xe)] || h === r - 1 || u > 0) && (c = f, m = 16 * i - hr, x = c + a, p = 16 * (i + 1) - hr, g = m, 4 === o && (g = p), l && (c -= 5), (4 === o && 0 === d || 1 === o && 0 === y) && u > 0 ? A(fe, !1, !0, g, c, g, x + 3) : A(fe, !1, !0, g, c, g, x)), (0 === $e[U(i, h, Xe)] || 9 === $e[U(i, h, Xe)] || h === r - 1 || u > 0) && (a = 0, f = 16 * -Xe * 2, l = 0)
	}

	function w(n, t, e, r, o) {
		var i, a, f, l, u, h, d, s, y, c;
		for (i = t; r > i; i++)
			for (a = 0, f = 16 * -Xe * 2, l = 0, u = 0, h = n; e > h; h++) 2 === o ? 0 > i - 1 ? u = -1 : (u = $e[U(h, i - 1, Xe)], l = 1) : 8 === o && (u = $e[U(h, i + 1, Xe)], i + 1 > Xe - 1 && (u = -1)), 0 !== $e[U(h, i, Xe)] && 9 !== $e[U(h, i, Xe)] && 1 > u && (a += 16, f === 16 * -Xe * 2 && (f = 16 * h - hr)), (0 === $e[U(h, i, Xe)] || 9 === $e[U(h, i, Xe)] || h === e - 1 || u > 0) && (d = f, s = 16 * i - dr, y = d + a, c = 16 * (i + 1) - dr, 2 === o ? 1 === l ? (A(fe, !1, !0, d, s - 5, y, s - 5), A(fe, !1, !0, d, s + 3, y, s + 3)) : A(fe, !1, !0, d, c, y, c) : 8 === o && A(fe, !1, !0, d, c, y, c)), (0 === $e[U(h, i, Xe)] || 9 === $e[U(h, i, Xe)] || h === e - 1 || u > 0) && (a = 0, f = 16 * -Xe * 2, l = 0)
	}

	function v() {
		var n, t, e, r, o;
		for (ue.width = Fr, ue.height = Fr, gt(), Qt = 16 * mr.x + 16 * H(H(H(be.x), 10), 1), Vt = 16 * mr.y + 16 * H(H(H(be.y), 10), 1), le.clearRect(0, 0, ue.width, ue.height), Zt.length = 0, W(le, "#000", !1, 2), n = 0; n < cr.r.length; n++)
			for (t = 0; t < cr.r[n].rooms.length; t++) e = cr.r[n].rooms[t], r = 16 * e.x - sr, o = 16 * e.y - yr, r + 16 * e.mw > 0 && o + 16 * e.mh > 0 && r < ue.width && o < ue.height && T(le, !0, !1, r, o, 16 * e.mw, 16 * e.mh);
		b("bg", "bd", function(n, t, e) {
			n.v && T(le, !0, !0, t, e, 16 * n.mw, 16 * n.mh)
		}, le), b("bd", 0, function(n, t, e) {
			n.r.u && !n.v && T(le, !0, !1, t, e, 16 * n.mw, 16 * n.mh)
		}, le), Kt.clearRect(0, 0, 16, 16), b("bg", "bd", function(n, t, e) {
			n.v && T(Kt, !0, !0, t / 16 * 2, e / 16 * 2, 2 * n.mw, 2 * n.mh)
		}, Kt), Cr.href = Sr.toDataURL(), b(0, "bg", F, le), b(0, 0, k, le), S()
	}

	function b(n, t, e, r) {
		var o, i, a, f, l, u = r || le;
		for (o = 0; o < cr.r.length; o++)
			for (W(u, cr.r[o].color[n] || "rgba(0,0,0,0)", cr.r[o].color[t] || "rgba(0,0,0,0)", !1), i = 0; i < cr.r[o].rooms.length; i++) a = cr.r[o].rooms[i], f = 16 * a.x - sr, l = 16 * a.y - yr, f + 16 * a.mw > 0 && l + 16 * a.mh > 0 && f < ue.width && l < ue.height && e(a, f, l, u)
	}

	function k(n) {
		var t, e, r, o, i, a;
		if (n.v) {
			for (t = null, e = null, r = null, o = 0; o < n.d.length; o++) t = n.d[o], t.dt > -1 && (e = gr[t.dt].l, r = gr[t.dt].bd, i = 0, a = 0, "N" === t.dir && (i = 5), "S" === t.dir && (i = 5, a = 16), "W" === t.dir && (i = -3, a = 8), "E" === t.dir && (i = 13, a = 8), M(16 * t.x + i, 16 * t.y + a, e, r));
			n.s > -1 && (e = gr[n.s].l, r = gr[n.s].bd, M(16 * (n.x + n.mw / 2) - 3, 16 * (n.y + n.mh / 2), r, e))
		}
	}

	function M(n, t, e, r) {
		var o = 3;
		le.beginPath(), le.arc(n + o - sr, t - yr, o, 0, 2 * Math.PI, !1), le.fillStyle = e, le.fill(), r && (le.lineWidth = 2, le.strokeStyle = r, le.stroke()), le.closePath()
	}

	function F(n) {
		var t, e, r, o, i, a;
		if (n.v)
			for (t = null, e = 0; e < n.d.length; e++) t = n.d[e], r = n.x + "-" + n.y + "-" + t.r2.x + "-" + t.r2.y, o = t.r2.x + "-" + t.r2.y + "-" + n.x + "-" + n.y, -1 === Zt.indexOf(o) && -1 === Zt.indexOf(r) && (i = 16 * t.x, a = 16 * t.y, "N" === t.dir && A(le, !1, !0, i + 4, a, i + 16 - 4, a), "S" === t.dir && A(le, !1, !0, i + 4, 16 * (t.y + 1), i + 16 - 4, 16 * (t.y + 1)), "W" === t.dir && A(le, !1, !0, i, a + 4, i, a + 16 - 4), "E" === t.dir && A(le, !1, !0, 16 * (t.x + 1), a + 4, 16 * (t.x + 1), a + 16 - 4), Zt.push(r))
	}

	function C() {
		for (var n = 0; n < be.keys.length; n++) W(ie, gr[be.keys[n]].l, !1, !1), T(ie, !0, !1, be.x - hr + 1, be.y - dr + (4 - n) * be.h / 5, be.w - 2, be.h / 5 - 1)
	}

	function S() {
		var n, t, e, r;
		for (n = 0; n < Me.length; n++) t = Me[n], e = (15 - 15 * (be.ῼ / be.mῼ)).toString(16), W(ie, "rgba(0,0,0,0.1)", "#" + e + e + "0000", 1), T(ie, !0, !0, t.x - hr, t.y - dr, t.w, t.h), C();
		$t += 2 * (ke / 1e3), $t %= 2, r = 1, $t > 1 && (r = 0), te !== r && W(he, "rgba(255,255,0," + .6 * r + ")", "rgba(255,255,0," + .8 * r + ")", !1), de.width !== ue.width && (de.width = ue.width, de.height = ue.height, W(he, "rgba(255,255,0," + .6 * r + ")", "rgba(255,255,0," + .8 * r + ")", !1)), ne || (W(he, !1, !1, 1), ne = !0), he.clearRect(0, 0, de.width, de.height), T(he, !0, !0, Qt - sr, Vt - yr, 16, 16), W(Kt, "rgba(200,200,255,1)", "rgba(200,200,255,1)", !1), T(Kt, !0, !0, (Qt - sr) / 16 * 2, (Vt - yr) / 16 * 2, 2, 2), te = r
	}

	function j() {
		be.keys.length > 0 && (W(ie, gr[be.keys[Ie]].l, "#000000", !1), L(ie, be.x - hr + be.w / 2, be.y - dr + be.h / 2, je, function() {
			A(ie, !0, !0, 10 + be.w, 0, 0 + be.w, -10, 0 + be.w, 10, 10 + be.w, 0)
		}))
	}

	function E() {
		var n, t;
		for (n = 0; n < Ee.length; n++) t = Ee[n], W(ie, gr[t.key].l, gr[t.key].bd, 1), L(ie, t.x - hr, t.y - dr, t.a, function() {
			T(ie, !0, !0, 0, 0, 10, 2)
		})
	}

	function D(n, t, e) {
		var r, o, i, a = "#FFFFFF",
			f = "#000000";
		n.dt > -1 && (f = gr[n.dt].l), W(ae, f, a, !1), r = 0, o = 160, i = 80, "N" === n.dir && (r = 90, i = 0, o = 80), "W" === n.dir && (r = 180, o = 0, i = 80), "S" === n.dir && (r = 270, o = 80, i = 160), L(ae, 16 * t * 10 - hr + o, 16 * e * 10 - dr + i, !1, function() {
			"N" === n.dir && A(ae, !0, !0, 0, -20, 10, -10, -10, -10, 0, -20), "W" === n.dir && A(ae, !0, !0, -20, 0, -10, -10, -10, 10, -20, 0), "S" === n.dir && A(ae, !0, !0, 0, 20, 10, 10, -10, 10, 0, 20), "E" === n.dir && A(ae, !0, !0, 20, 0, 10, -10, 10, 10, 20, 0)
		})
	}

	function W(n, t, e, r) {
		t !== !1 && (n.fillStyle = t), e !== !1 && (n.strokeStyle = e), r !== !1 && (ie.lineWidth = r)
	}

	function T(n, t, e, r, o, i, a) {
		n.beginPath(), n.rect(r, o, i, a), t && n.fill(), e && n.stroke(), n.closePath()
	}

	function A(n, t, e, r, o) {
		n.beginPath(), n.moveTo(r, o);
		for (var i = 3; i < arguments.length; i += 2) n.lineTo(arguments[i], arguments[i + 1]);
		t && n.fill(), e && n.stroke(), n.closePath()
	}

	function L(n, t, e, r, o) {
		n.save(), n.translate(t, e), r !== !1 && n.rotate(r), o(), n.restore()
	}

	function B(n, t) {
		ge[n] || (ge[n] = []), ge[n].push(t)
	}

	function O(n) {
		var t, e = n.type;
		if (ge[e] && ge[e].length > 0)
			for (t = 0; t < ge[e].length; t++) ge[e][t](n)
	}

	function I(n) {
		return t.getElementById(n)
	}

	function P() {
		var n, t, e, r, o, i, a, f;
		for (se = I("clr"), ee = I("p"), oe = I("b"), re = I("t"), ue = I("m"), de = I("i"), ie = ee.getContext("2d"), fe = oe.getContext("2d"), ae = re.getContext("2d"), le = ue.getContext("2d"), he = de.getContext("2d"), N(), _t(), n = null, t = 0; t < gr.length; t++) {
			for (e = z(5, 10), r = 0; e > r; r++) Ot();
			t + 1 < gr.length && (n = cr.r[cr.r.length - 1], vt(Gt(), n))
		}
		for (vt(Gt(), cr.r[0]), e = z(5, 10), r = 0; e > r; r++) Ot();
		o = cr.r[0].rooms[0], i = o.d[0], a = i.dir, f = i.x, o.sr = !0, o.sx = f - o.x, o.sy = i.y - o.y, ("E" === i.dir || "W" === i.dir) && (f = i.y), zt(), Ht(), xt(o, a, f), R()
	}

	function N() {
		oe.width = ee.width = re.width = n.innerWidth > 300 ? 300 : n.innerWidth, oe.height = ee.height = re.height = n.innerHeight > 300 ? 300 : n.innerHeight
	}

	function q() {
		var n, t;
		if (ye) {
			for (n = 0; n < Me.length; n++) t = Me[n], et(t), t.x = Y(t.x), t.y = Y(t.y), at(t), it(t), rt(t), ct(), ot(t);
			for (V(), $(), n = 0; n < Ee.length; n++) lt(Ee[n]);
			ie.clearRect(0, 0, ee.width, ee.height), fe.clearRect(0, 0, oe.width, oe.height), p(), v(), j(), E()
		}
	}

	function R() {
		xe = n.performance.now(), ke = xe - pe, pe = xe, t.dispatchEvent(me), ce && requestAnimationFrame(R)
	}

	function z(n, t) {
		return Math.floor(Math.random() * (t - n + 1) + n)
	}

	function H(n, t) {
		var e = n % (t || 16);
		return (n - e) / (t || 16)
	}

	function U(n, t, e) {
		return t * e + n
	}

	function X(n, t) {
		var e, r, o;
		if ("object" == typeof t) {
			for (e = 0; e < n.length; e++)
				if (r = !0, "object" == typeof n[e]) {
					for (o in t)
						if (n[e][o] !== t[o]) {
							r = !1;
							break
						}
					if (r === !0) return e
				}
			return -1
		}
		return n.indexOf(t)
	}

	function Y(n) {
		return~~ (.5 + n)
	}

	function _(t) {
		for (var e in Fe) Fe[e] === t.keyCode && t.preventDefault();
		we[t.keyCode] !== t.type && (t.keyCode === Fe.space && (be.j = 1), t.keyCode === Fe.tab && (Fr = Math.min(16 * H(n.innerHeight), 16 * H(n.innerWidth)))), we[t.keyCode] = t.type, t.keyCode === Fe.d ? be.xd = 1 : t.keyCode === Fe.a && (be.xd = -1)
	}

	function G(n) {
		for (var t in Fe) Fe[t] === n.keyCode && n.preventDefault();
		we[n.keyCode] !== n.type && n.keyCode === Fe.space && (be.j = 0), we[n.keyCode] = n.type, n.keyCode === Fe.tab && (Fr = 150), (n.keyCode === Fe.d || n.keyCode === Fe.a) && (we[Fe.d] && we[Fe.a] ? we[Fe.d] === n.type && we[Fe.a] === n.type && (be.xd = 0) : be.xd = 0)
	}

	function J(n) {
		var t = ee.getBoundingClientRect();
		Be = n.clientX - t.left, Oe = n.clientY - t.top, Ce = n.clientX, Se = n.clientY, je = Math.atan2(be.y + be.h / 2 - dr - Oe, be.x + be.w / 2 - hr - Be) + Math.PI
	}

	function K(n) {
		n.preventDefault(), 1 === n.which && (We = !0), 2 === n.which && (Ie++, Ie > be.keys.length - 1 && (Ie = 0)), 3 === n.which && (Te = !0)
	}

	function Q(n) {
		n.preventDefault(), 1 === n.which && (We = !1), 3 === n.which && (Te = !1)
	}

	function V() {
		We && n.performance.now() - De > Ae && be.keys.length > 0 && (De = n.performance.now(), Ee.push(nt(be.x + be.w / 2 + 10 * Math.cos(je), be.y + be.h / 2 + 10 * Math.sin(je), je, be.keys[Ie])))
	}

	function Z(n) {
		n.preventDefault()
	}

	function $() {
		var n, t, e;
		Te && (n = Be + hr, t = Oe + dr, n >= 0 && 16 * nr > n && t >= 0 && 16 * tr > t && (e = U(H(n), H(t), Xe), 0 === $e[e] && Le[be.keys[Ie]] > 0 && ($e[e] = be.keys[Ie] + 2, Le[be.keys[Ie]]--)))
	}

	function nt(n, t, e, r) {
		return {
			x: n,
			y: t,
			a: e,
			key: r
		}
	}

	function tt() {
		ze ? (qe.stop(), He += kr.currentTime - Ue) : (Ue = kr.currentTime, qe = kr.createBufferSource(), qe.buffer = Re, qe.loop = !0, qe.connect(kr.destination), qe.start(0, He % Re.duration)), ze = !ze
	}

	function et(n) {
		n.xa = n.xa + n.xd / 60 * ke, n.xa > n.maxa && (n.xa = n.maxa), n.xa < -n.maxa && (n.xa = -n.maxa), 0 === n.xd && (n.xa > 0 ? n.xa = n.xa + -2 / 60 * ke : n.xa < 0 && (n.xa = n.xa + 2 / 60 * ke), (n.xa < 1 / 60 * ke && n.xa > -1 / 60 * ke || 1 === n.yd || -1 === n.yd) && (n.xa = 0)), n.x = n.x + n.xa
	}

	function rt(n) {
		n.j && -1 !== n.yd && n.ju < n.mj && (n.mj > 1 && 0 === n.ju && 1 === n.yd && n.ju++, (0 === n.ju && 0 === n.yd || n.ju > 0 || n.mj > 1) && (n.yd = -1, n.ya = -n.jf, n.js = n.y, n.ju++), n.ht = 0), (0 === n.yd || !n.j || n.ht > n.jh) && (n.yd = 1), 1 === n.yd && (n.j = 0, n.ya = n.ya + n.jf / 2 / 60 * ke), 0 === n.yd && (n.ya > 0 ? n.ya = n.ya + -1 / 60 * ke : n.ya < 0 && (n.ya = n.ya + 1 / 60 * ke), n.ya < 1 / 60 * ke && n.ya > -1 / 60 * ke && (n.ya = 0)), n.ya > n.maxa && (n.ya = 10), n.ht -= n.ya, n.ht = Y(n.ht), n.y = n.y + n.ya
	}

	function ot(n) {
		var t = n.x % 16,
			e = U(H(n.x), H(n.y + n.h), Xe),
			r = U(H(n.x + n.w), H(n.y + n.h), Xe),
			o = !1;
		o = 0 === t ? ft($e[e]) : ft($e[r]) || ft($e[e]), (o || n.y + n.h > 16 * tr) && 1 === n.yd && (n.y = 16 * H(n.y), n.ya = 0, n.yd = 0, n.ju = 0, n.j = 0, n.ht = 0)
	}

	function it(n) {
		var t = n.x % 16,
			e = U(H(n.x), H(n.y - n.h / 2), Xe),
			r = U(H(n.x + n.w), H(n.y - n.h / 2), Xe),
			o = !1;
		o = 0 === t ? ft($e[e]) : ft($e[e]) || ft($e[r]), o && 1 === n.j && (n.y = 16 * H(n.y), n.ya = -1, n.yd = 1, n.j = 0, n.ht = 0)
	}

	function at(n) {
		var t = n.y % 16,
			e = n.x % 16,
			r = U(H(n.x), H(n.y - n.h / 2), Xe),
			o = U(H(n.x + n.w), H(n.y - n.h / 2), Xe),
			i = U(H(n.x), H(n.y), Xe),
			a = U(H(n.x + n.w), H(n.y), Xe),
			f = U(H(n.x), H(n.y + n.h / 2), Xe),
			l = U(H(n.x + n.w), H(n.y + n.h / 2), Xe),
			u = U(H(n.x), H(n.y + n.h), Xe),
			h = U(H(n.x + n.w), H(n.y + n.h), Xe),
			d = !1,
			s = !1;
		0 === t ? (d = ft($e[f]) || ft($e[i]), s = ft($e[l]) || ft($e[a])) : 16 * H(n.y + n.h) > n.y + n.h ? (d = ft($e[f]) || ft($e[i]) || ft($e[r]), s = ft($e[l]) || ft($e[a]) || ft($e[o])) : (d = ft($e[f]) || ft($e[i]) || ft($e[u]), s = ft($e[l]) || ft($e[a]) || ft($e[h])), 0 === e ? (s || n.x + n.w > 16 * nr || n.x < 0) && n.xa > 0 && (n.x = 16 * H(n.x), n.xa = 0) : (s || n.x + n.w > 16 * nr || n.x < 0) && n.xa > 0 ? (n.x = 16 * H(n.x), n.xa = 0) : (d || n.x + n.w > 16 * nr || n.x < 0) && n.xa < 0 && (n.x = 16 * H(n.x + n.w), n.xa = 0)
	}

	function ft(n) {
		return 9 === n && Ut(mr), 0 !== n
	}

	function lt(n) {
		var t, e, r, o, i = !1;
		n.x += Math.cos(n.a) * (10 / 60) * ke, n.y += Math.sin(n.a) * (10 / 60) * ke, t = H(n.x), e = H(n.y), r = U(t, e, Xe), 0 !== $e[r] && ($e[r] > 1 && be.keys[Ie] === $e[r] - 2 && (Le[$e[r] - 2]++, $e[r] = 0), i = !0), (n.x > 16 * nr || n.x < 0 || n.y > 16 * tr || n.y < 0) && (i = !0), i && (o = Ee.indexOf(n), o > -1 && Ee.splice(o, 1))
	}

	function ut(n, t) {
		t = t.split("");
		for (var e = 0; e < t.length; e++) t[e] = parseInt(t[e]);
		return {
			map: t,
			type: n
		}
	}

	function ht(n) {
		return {
			map: n.map.slice(0),
			type: n.type
		}
	}

	function dt(n, t, e, r) {
		function o(n, t) {
			return n > -1 && 2 > n && t > -1 && 2 > t ? !0 : n > 7 && 10 > n && t > -1 && 2 > t ? !0 : n > -1 && 2 > n && t > 7 && 10 > t ? !0 : n > 7 && 10 > n && t > 7 && 10 > t ? !0 : void 0
		}
		var i, a, f, l, u, h, d, s, y, c, m, x, p, g, w, v, b, k, M, F, C, S, j, E = [],
			D = [],
			W = Math.max(n, t);
		for (i = 0; W * W > i; i++) E[i] = 0;
		for (E = r(E, n, t, W), f = {}, s = 0; 10 * W > s; s++)
			for (y = 0; 10 * W > y; y++) c = Math.floor(y / 10), m = Math.floor(s / 10), l = Lt(e, c, m, "N"), u = Lt(e, c, m, "E"), h = Lt(e, c, m, "S"), d = Lt(e, c, m, "W"), x = U(c, m, W), p = c + "-" + m, (y % 10 === 0 || s % 10 === 0) && (f[p] || (a = ht(Ke[E[x]]), f[p] = a), a = f[p]), g = U(y, s, 10 * W), w = U(y % 10, s % 10, 10), v = U(y - 1, s, 10 * W), b = U(y + 1, s, 10 * W), k = U(y, s - 1, 10 * W), M = U(y, s - 2, 10 * W), 0 > s - 1 && (k = -1), 0 > y - 1 && (v = -1), s + 1 > 10 * t - 1 && (belowMap = -1), y + 1 > 10 * n - 1 && (b = -1), D[g] = e.r.u && 0 === e.r.id && 0 !== a.map[w] && 10 * n > y && 10 * t > s && 10 * n > y && 10 * t > s ? 1 === z(0, 5) ? z(0, gr.length - 1) + 2 : 0 : a.map[w], e.r.u && 0 === D[g] && 9 !== a.type && 10 * n > y && 10 * t > s && 10 * n > y && 10 * t > s && ((1 === e.r.id || 2 === e.r.id || 3 === e.r.id) && (D[g] = e.r.id + 2), z(0, 6) < 2 && 2 === e.r.id && (D[g] = 0), z(0, 6) < 4 && 3 === e.r.id && (D[g] = 0), 1 === z(0, 3) && 4 === e.r.id && (D[g] = e.r.id + 2), 1 === z(0, 3) && 0 === e.r.id && (D[g] = e.r.id + 2)), e.r.u && (3 === e.r.id || 4 === e.r.id || 0 === e.r.id) && 1 === D[g] && 9 !== a.type && 10 * n > y && 10 * t > s && 10 * n > y && 10 * t > s && (1 === z(0, 3) ? D[g] = e.r.id + 2 : 2 === z(0, 3) && (D[g] = 0)), F = 10 * t, C = 10 * n, S = y % 10, j = s % 10, 0 === s && null === l && C > y && (D[g] = 1), 0 === y && null === d && F > s && (D[g] = 1), s === F - 1 && null === h && C > y && (D[g] = 1), y === C - 1 && null === u && F > s && (D[g] = 1), o(S, j) && (D[g] = 1), 0 === D[g] && (0 === s && null !== l && C > y && l.dt > -1 && (D[g] = l.dt + 2), 0 === y && null !== d && F > s && d.dt > -1 && (D[g] = d.dt + 2), s === F - 1 && null !== h && C > y && h.dt > -1 && (D[g] = h.dt + 2), y === C - 1 && null !== u && F > s && u.dt > -1 && (D[g] = u.dt + 2));
		return {
			map: D,
			width: n,
			height: t,
			size: W,
			tiles: 10 * W
		}
	}

	function st(n) {
		var t, e, r, o, i, a, f, l, u, h, d, s;
		if (n.map = dt(1 * n.mw, 1 * n.mh, n, function(t, e, r, o) {
			var i, a, f, l, u, h, d, s = 0,
				y = 0,
				c = 0;
			for (i = 0; o * o > i; i++) a = Lt(n, s, y, "N"), f = Lt(n, s, y, "E"), l = Lt(n, s, y, "S"), u = Lt(n, s, y, "W"), h = [1, 3, 4, 9], d = [2, 9, 10, 11], (0 === s || 0 === y || s === e - 1 || y === r - 1) && (c = z(0, 11)), (0 === s || s === e - 1) && (c = d[z(0, 3)]), (0 === y || y === r - 1) && (c = h[z(0, 3)]), (0 === s && 0 === y || s === e - 1 && 0 === y || s === e - 1 && y === r - 1 || 0 === s && y === r - 1) && (c = 9), 1 === n.mw && (c = d[z(0, 3)]), 1 === n.mh && (c = h[z(0, 3)]), 0 === s && 0 === y && (c = 6), s === e - 1 && 0 === y && (c = 7), 0 === s && y === r - 1 && (c = 5), s === e - 1 && y === r - 1 && (c = 8), (a || l || f || u) && (c = 9), t[U(s, y, o)] = c, s++, s > e - 1 && (s = 0, y++), y > r - 1 && (i = o * o);
			return t
		}), n.s > -1 && -1 === be.keys.indexOf(n.s)) {
			for (t = 0, e = !1; e === !1 && 5 > t;) n.sr ? (r = 1 * n.sx, o = 1 * n.sy, i = z(1, 9), a = z(1, 9)) : (r = z(1, 1 * n.mw) - 1, o = z(1, 1 * n.mh) - 1, i = z(1, 9), a = z(1, 9)), f = U(10 * r + i, 10 * o + a, n.map.tiles), l = 0 === n.map.map[f] || n.map.map[f] === n.r.id + 2, l && (e = !0, n.map.map[U(10 * r + i, 10 * o + a, n.map.tiles)] = 9), t++;
			if (!e)
				if (n.sr)
					for (u = 1 * n.sx * 10, h = 1 * n.sy * 10, d = u + 1; u + 10 - 1 > d; d++)
						for (s = h + 1; h + 10 - 1 > s; s++) f = U(d, s, n.map.tiles), l = 0 === n.map.map[f] || n.map.map[f] === n.r.id + 2, l && (n.map.map[f] = 9);
				else
					for (u = 1 * n.sx * 10, h = 1 * n.sy * 10, d = 1; d < 1 * n.mw * 10 - 1; d++)
						for (s = 1; s < 1 * n.mh * 10 - 1; s++) f = U(d, s, n.map.tiles), l = 0 === n.map.map[f] || n.map.map[f] === n.r.id + 2, l && (n.map.map[f] = 9)
		}
	}

	function yt(n, t, e) {
		var r, o, i, a, f;
		for (r = 0; r < n.d.length; r++) o = !1, i = n.d[r], i.dir === t && (("N" === i.dir || "S" === i.dir) && (o = e === i.x), ("E" === i.dir || "W" === i.dir) && (o = e === i.y), o && (a = 1 * (i.x - n.x), f = 1 * (i.y - n.y), -1 === be.y && (be.y = 10 * f * 16 + 80), -1 === be.x && (be.x = 10 * a * 16 + 80), "N" === i.dir && (a += Math.floor(.5), be.y = 0, i.dt > -1 && (be.y = 16), be.x = be.x % 160 + 10 * a * 16), "E" === i.dir && (f += Math.floor(.5), a += 1, be.x = 10 * n.mw * 16 * 1 - be.w, i.dt > -1 && (be.x -= 16), be.y = be.y % 160 + 10 * f * 16), "S" === i.dir && (a += Math.floor(.5), f += 1, be.y = 10 * n.mh * 16 * 1 - be.h, i.dt > -1 && (be.y -= 16), be.x = be.x % 160 + 10 * a * 16), "W" === i.dir && (f += Math.floor(.5), be.x = 0, i.dt > -1 && (be.x = 16), be.y = be.y % 160 + 10 * f * 16)))
	}

	function ct() {
		var t, e, r, o, i, a, f, l, u, h;
		for (t = 0; t < mr.d.length; t++) e = mr.d[t], r = 1 * (e.x - mr.x), o = 1 * (e.y - mr.y), i = H(H(be.x), 10), a = H(H(be.x + be.w), 10), f = H(H(be.y), 10), l = H(H(be.y + be.h), 10), u = 10 * mr.mw * 16 * 1, h = 10 * mr.mh * 16 * 1, "N" === e.dir && (r += Math.floor(.5)), "E" === e.dir && (o += Math.floor(.5), r += 1), "S" === e.dir && (r += Math.floor(.5), o += 1), "W" === e.dir && (o += Math.floor(.5)), n.performance.now() - be.dc > 400 && (be.x <= 0 && -1 === be.xd && "W" === e.dir && r === i && o === f && xt(e.r2, "E", e.y), be.y <= 0 && -1 === be.yd && "N" === e.dir && r === i && o === f && xt(e.r2, "S", e.x), be.x + be.w >= u && 1 === be.xd && "E" === e.dir && r === a && o === f && xt(e.r2, "W", e.y), be.y + be.h >= h && 0 !== be.yd && Math.abs(be.ya) > 5 && "S" === e.dir && r === i && (o === l || o === f) && xt(e.r2, "N", e.x))
	}

	function mt() {
		var e, r, o, i, a, f;
		ir && (null === mr && (lr = ur), e = ee.width, r = ee.height, o = e, i = r, ur > lr && (o = e * lr / ur, o = e - o, i = r * lr / ur, i = r - i), lr >= ur && (mr !== or && (fe.clearRect(0, 0, e, r), ae.clearRect(0, 0, e, r), mr = or, mr.v = !0, Xe = or.map.tiles, $e = or.map.map, tr = 10 * or.map.height, nr = 10 * or.map.width, Ye = 10 * or.map.height * 16, _e = 10 * or.map.width * 16, yt(or, er, rr), t.title = mr.c.name, history.pushState(null, null, "#" + t.title), Ee.length = 0), o = e * (lr - ur) / ur, i = r * (lr - ur) / ur), ar.width = e, ar.height = r, fr.clearRect(0, 0, e, r), v(), p(), fr.drawImage(re, 0, 0), fr.drawImage(oe, 0, 0), fr.drawImage(ee, 0, 0), ie.clearRect(0, 0, e, r), oe.style.display = "none", re.style.display = "none", fr.globalCompositeOperation = "destination-in", a = be.x + be.w / 2 - hr - o / 2, f = be.y + be.h / 2 - dr - i / 2, fr.beginPath(), fr.rect(a, f, o, i), fr.fillStyle = "black", fr.fill(), ie.drawImage(ar, 0, 0), lr += 2 * ur * (ke / 1e3), lr > 2 * ur && (lr = 0, ye = !0, or = null, ir = !1, oe.style.display = "initial", re.style.display = "initial", be.dc = n.performance.now()))
	}

	function xt(n, t, e) {
		er = t, rr = e, ir = !0, or = n, ye = !1, null === n.map && st(n)
	}

	function pt() {
		var n = ae.canvas,
			t = n.width / 2,
			e = n.height / 2;
		be.x - hr + t > n.width ? hr = be.x - (n.width - t) : be.x - t < hr && (hr = be.x - t), be.y - dr + e > n.height ? dr = be.y - (n.height - e) : be.y - e < dr && (dr = be.y - e), dr = ~~ (.5 + dr), dr = ~~ (.5 + dr)
	}

	function gt() {
		var n = le.canvas,
			t = n.width / 2,
			e = n.height / 2,
			r = 16 * (mr.x + H(H(H(be.x), 10), 1)),
			o = 16 * (mr.y + H(H(H(be.y), 10), 1));
		r - sr + t > n.width ? sr = r - (n.width - t) : sr > r - t && (sr = r - t), o - yr + e > n.height ? yr = o - (n.height - e) : yr > o - e && (yr = o - e), yr = ~~ (.5 + yr), yr = ~~ (.5 + yr)
	}

	function wt(n, t, e) {
		cr.f.length = 0, cr.f.push({
			x: n,
			y: t
		}), cr.cr = e, cr.r.push(e)
	}

	function vt(n, t) {
		for (var e, r, o = !0, i = kt(t), a = [], f = null, l = []; o;) {
			if (e = 0, f = bt(i, l), a.length = 0, f)
				for (a.push(At(f.x - 1, f.y), At(f.x + 1, f.y), At(f.x, f.y - 1), At(f.x, f.y + 1)), r = 0; 4 > r; r++) null === a[r] && e++;
			else o = !1;
			e > 2 && (o = !1)
		}
		f && wt(f.x, f.y, n)
	}

	function bt(n, t) {
		if (t.length === n.length) return !1;
		for (var e = z(0, n.length - 1); t.indexOf(e) > -1;) e = z(0, n.length - 1);
		return t.push(e), n[e]
	}

	function kt(n) {
		var t, e = [],
			r = cr.rooms;
		for (n && (r = n.rooms), t = 0; t < r.length; t++) e = Mt(e, r[t]);
		return e
	}

	function Mt(n, t) {
		for (var e, r = t.x; r < t.x + t.mw;) Ft(r, t.y - 1, 1, 1) && n.push({
			x: r,
			y: t.y - 1
		}), Ft(r, t.y + t.mh, 1, 1) && n.push({
			x: r,
			y: t.y + t.mh
		}), r++;
		for (e = t.x; e < t.y + t.mh;) Ft(e, t.x - 1, 1, 1) && n.push({
			x: e,
			y: t.x - 1
		}), Ft(e, t.x + t.mw, 1, 1) && n.push({
			x: e,
			y: t.x + t.mw
		}), e++;
		return n
	}

	function Ft(n, t, e, r) {
		return Ct(n, t, e, r) && !St(n, t, e, r)
	}

	function Ct(n, t, e, r) {
		return n > 0 && t > 0 && n + e < cr.width && t + r < cr.height
	}

	function St(n, t, e, r) {
		for (var o = null, i = 0; i < cr.rooms.length;) {
			o = cr.rooms[i]; {
				if (!(o.x > n + e - 1 || o.x + o.mw - 1 < n || o.y > t + r - 1 || o.y + o.mh - 1 < t)) return !0;
				i++
			}
		}
		return !1
	}

	function jt(n) {
		for (var t, e, r, o = 0, i = null, a = !1, f = 100; cr.rooms.length > 1 && !a;) {
			for (o = 0, o += Et(n), o += Dt(n), o += Wt(n), o += Tt(n), 1 === n.r.rooms.length && o > 0 && (a = !0), t = 0; t < n.d.length; t++) i = n.d[t], Yt(i, n).r === n.r && (a = !0);
			f--, 0 === f && (a = !0)
		}
		for (t = 0; t < n.d.length; t++) e = n.r, r = Yt(i, n).r, e !== r && (-1 === e.bds.indexOf(r) && e.bds.push(r), -1 === r.bds.indexOf(e) && r.bds.push(e))
	}

	function Et(n) {
		for (var t, e, r, o, i = null, a = null, f = null, l = null, u = [], h = n.x; h < n.x + n.mw;) a = At(h, n.y - 1), null !== a && u.push({
			x: h,
			y: n.y,
			o: a
		}), h++;
		for (t = 0, e = 0; e < u.length; e++) {
			for (i = u[e], r = !1, o = 0; o < n.d.length; o++) n.d[o].r2 === i.o && (r = !0);
			Math.random() > xr || X(n.d, i) >= 0 || r || (f = Rt(i.x, i.y, "N", n, i.o), l = Rt(i.x, i.y - 1, "S", i.o, n), n.d.push(f), f.o = l, l.o = f, i.o.d.push(l), t++)
		}
		return t
	}

	function Dt(n) {
		for (var t, e, r, o, i = null, a = null, f = null, l = null, u = [], h = n.x; h < n.x + n.mw;) a = At(h, n.y + n.mh), null !== a && u.push({
			x: h,
			y: n.y + n.mh - 1,
			o: a
		}), h++;
		for (t = 0, e = 0; e < u.length; e++) {
			for (i = u[e], r = !1, o = 0; o < n.d.length; o++) n.d[o].r2 === i.o && (r = !0);
			Math.random() > xr || X(n.d, i) >= 0 || r || (f = Rt(i.x, i.y, "S", n, i.o), l = Rt(i.x, i.y + 1, "N", i.o, n), n.d.push(f), f.o = l, l.o = f, i.o.d.push(l), t++)
		}
		return t
	}

	function Wt(n) {
		for (var t, e, r, o, i = null, a = null, f = null, l = null, u = [], h = n.y; h < n.y + n.mh;) a = At(n.x - 1, h), null !== a && u.push({
			x: n.x,
			y: h,
			o: a
		}), h++;
		for (t = 0, e = 0; e < u.length; e++) {
			for (i = u[e], r = !1, o = 0; o < n.d.length; o++) n.d[o].r2 === i.o && (r = !0);
			Math.random() > xr || X(n.d, i) >= 0 || r || (f = Rt(i.x, i.y, "W", n, i.o), l = Rt(i.x - 1, i.y, "E", i.o, n), n.d.push(f), f.o = l, l.o = f, i.o.d.push(l), t++)
		}
		return t
	}

	function Tt(n) {
		for (var t, e, r, o, i = null, a = null, f = null, l = null, u = [], h = n.y; h < n.y + n.mh;) a = At(n.x + n.mw, h), null !== a && u.push({
			x: n.x + n.mw - 1,
			y: h,
			o: a
		}), h++;
		for (t = 0, e = 0; e < u.length; e++) {
			for (i = u[e], r = !1, o = 0; o < n.d.length; o++) n.d[o].r2 === i.o && (r = !0);
			Math.random() > xr || X(n.d, i) >= 0 || r || (f = Rt(i.x, i.y, "E", n, i.o), l = Rt(i.x + 1, i.y, "W", i.o, n), f.o = l, l.o = f, n.d.push(f), i.o.d.push(l), t++)
		}
		return t
	}

	function At(n, t) {
		for (var e = null, r = 0; r < cr.rooms.length;) {
			e = cr.rooms[r]; {
				if (!(e.x > n || e.x + e.mw - 1 < n || e.y > t || e.y + e.mh - 1 < t)) return e;
				r++
			}
		}
		return null
	}

	function Lt(n, t, e, r) {
		var o, i = null;
		for (o = 0; o < n.d.length; o++)
			if (i = n.d[o], i.dir === r && i.x === n.x + t && i.y === n.y + e) return i;
		return null
	}

	function Bt(n) {
		for (var t = 0, e = cr.rooms.length; t++ < 10 * n && cr.rooms.length < e + n;) Ot()
	}

	function Ot() {
		var n = [],
			t = bt(cr.f, n);
		t && It(Nt(t.x, t.y))
	}

	function It(n) {
		if (null === n || !Ft(n.x, n.y, n.mw, n.mh)) return !1;
		var t = [];
		t = Pt(t, n), cr.f = Mt(t, n), n.c = cr.cr.color, cr.rooms.push(n), cr.cr.rooms.push(n), jt(n)
	}

	function Mt(n, t) {
		for (var e, r = t.x; r < t.x + t.mw;) Ft(r, t.y - 1, 1, 1) && n.push({
			x: r,
			y: t.y - 1
		}), Ft(r, t.y + t.mh, 1, 1) && n.push({
			x: r,
			y: t.y + t.mh
		}), r++;
		for (e = t.y; e < t.y + t.mh;) Ft(t.x - 1, e, 1, 1) && n.push({
			x: t.x - 1,
			y: e
		}), Ft(t.x + t.mw, e, 1, 1) && n.push({
			x: t.x + t.mw,
			y: e
		}), e++;
		return n
	}

	function Pt(n, t) {
		for (var e = 0; e < cr.f.length; e++) cr.f[e].x >= t.x - 1 && cr.f[e].x <= t.x + t.mw && cr.f[e].y >= t.y && cr.f[e].y <= t.y + t.mh - 1 || cr.f[e].x >= t.x && cr.f[e].x <= t.x + t.mw - 1 && cr.f[e].y >= t.y - 1 && cr.f[e].y <= t.y + t.mh || n.push(cr.f[e]);
		return n
	}

	function Nt(n, t) {
		for (var e, r = 0, o = 1, i = 1; r++ < 25 && (o < cr.cr.maxW || i < cr.cr.maxH) && Math.random() < .9;) e = parseInt(4 * Math.random()), 0 === e && i < cr.cr.maxH && Ft(n, t - 1, o, i + 1) && (t--, i++), 1 === e && i < cr.cr.maxH && Ft(n, t, o, i + 1) && i++, 2 === e && o < cr.cr.maxW && Ft(n - 1, t, o + 1, i) && (n--, o++), 3 === e && o < cr.cr.maxW && Ft(n, t, o + 1, i) && o++;
		return qt(n, t, o, i, cr.cr)
	}

	function qt(n, t, e, r, o) {
		return {
			x: n,
			y: t,
			mw: e,
			mh: r,
			c: null,
			r: o,
			s: -1,
			sx: 0,
			sy: 0,
			sr: !1,
			v: !1,
			d: [],
			map: null
		}
	}

	function Rt(n, t, e, r, o) {
		return {
			x: n,
			y: t,
			dt: -1,
			dir: e,
			r1: r,
			r2: o,
			o: null
		}
	}

	function zt() {
		var n, t, e = null,
			r = null;
		for (n = 0; n < cr.rooms.length; n++)
			for (e = cr.rooms[n], e.s = -1, t = 0; t < e.d.length; t++) r = e.d[t], r.dt = -1
	}

	function Ht() {
		var n, t, e, r, o = null,
			i = null,
			a = null,
			f = null;
		for (n = 0; n < cr.r.length; n++)
			for (t = [], i = cr.r[n], 0 !== n && (f = bt(i.rooms, t), f.s = (n + 1) % gr.length), e = 0; e < i.rooms.length; e++)
				for (f = i.rooms[e], 0 === n && f.sr && (f.s = (n + 1) % gr.length), r = 0; r < f.d.length; r++) o = f.d[r], a = Yt(o, f).r, a !== i && -1 === o.o.dt && (o.o.dt = n % gr.length)
	}

	function Ut(n) {
		-1 === be.keys.indexOf(n.s) && n.s > -1 && (be.keys.push(n.s), Xt())
	}

	function Xt() {
		var n, t, e, r, o, i;
		for (se.innerHTML = "find " + (5 - be.keys.length) + " color circles", 5 - be.keys.length === 0 && (se.innerHTML = "find the exit"), n = 0; n < cr.r.length; n++) be.keys.indexOf(cr.r[n].id) > -1 && (cr.r[n].u = !0);
		for (t = 0; t < cr.rooms.length; t++) {
			for (e = !1, r = cr.rooms[t], be.keys.indexOf(r.s) > -1 && (r.s = -1, null !== r.map && (o = r.map.map.indexOf(9), o > -1 && (r.map.map[o] = 0))), n = 0; n < r.d.length; n++) i = r.d[n], be.keys.indexOf(i.dt) > -1 && (i.dt = -1, e = !0);
			e && null !== r.map && -1 === r.s
		}
	}

	function Yt(n, t) {
		return n.r1 === t ? n.r2 : n.r1
	}

	function _t() {
		cr = {
			width: 0,
			height: 0,
			rooms: [],
			f: [],
			r: [],
			cr: 0
		}, pr = 0, cr.width = 80, cr.height = 48, wt(40, 24, Gt()), Bt(1)
	}

	function Gt() {
		var n = Jt(gr[pr], parseInt(3 * Math.random()) + parseInt(3 * Math.random()) + 1, parseInt(3 * Math.random()) + parseInt(3 * Math.random()) + 1, pr);
		return pr = (pr + 1) % gr.length, n
	}

	function Jt(n, t, e, r) {
		return {
			color: n,
			maxW: t,
			maxH: e,
			id: r,
			u: !1,
			bds: [],
			rooms: []
		}
	}
	var Kt, Qt, Vt, Zt, $t, ne, te, ee, re, oe, ie, ae, fe, le, ue, he, de, se, ye, ce, me, xe, pe, ge, we, ve, be, ke, Me, Fe, Ce, Se, je, Ee, De, We, Te, Ae, Le, Be, Oe, Ie, Pe, Ne, qe, Re, ze, He, Ue, Xe, Ye, _e, Ge, Je, Ke, Qe, Ve, Ze, $e, nr, tr, er, rr, or, ir, ar, fr, lr, ur, hr, dr, sr, yr, cr, mr, xr, pr, gr, wr = 44100,
		vr = 2,
		br = 33,
		kr = null,
		Mr = [e, r, o, i],
		Fr = 150,
		Cr = t.getElementById("f"),
		Sr = t.createElement("canvas");
	for (Sr.height = 16, Sr.width = 16, Kt = Sr.getContext("2d"), Qt = 0, Vt = 0, Zt = [], $t = 0, ne = !1, te = 0, ye = !0, ce = !0, me = new CustomEvent("frame"), xe = n.performance.now(), pe = n.performance.now(), ge = {}, we = {}, ve = "beginPath", be = {
		x: -1,
		y: -1,
		w: 16,
		h: 32,
		img: null,
		xd: 0,
		yd: 1,
		xa: 0,
		ya: 0,
		maxa: 5,
		jf: 7,
		jh: 50,
		js: 0,
		j: 0,
		ju: 0,
		ht: 0,
		mj: 1,
		a: 0,
		"ῼ": 5,
		dc: n.performance.now(),
		"mῼ": 5,
		keys: []
	}, ke = xe - pe, Me = [be], Fe = {
		a: 65,
		w: 87,
		s: 83,
		d: 68,
		space: 32,
		shift: 16,
		ctrl: 17,
		alt: 18,
		tab: 9,
		debug: 192
	}, B("keydown", _), B("keyup", G), B("resize", N), B("DOMContentLoaded", P), B("frame", q), B("frame", mt), B("mousemove", J), B("mousedown", K), B("mouseup", Q), B("contextmenu", Z), n.addEventListener("resize", O), t.addEventListener("DOMContentLoaded", O), t.addEventListener("mousedown", O), t.addEventListener("mouseup", O), t.addEventListener("keydown", O), t.addEventListener("keyup", O), t.addEventListener("frame", O), t.addEventListener("mousemove", O), t.addEventListener("contextmenu", O), Ce = 0, Se = 0, je = 0, Ee = [], De = n.performance.now(), We = !1, Te = !1, Ae = 150, Le = [0, 0, 0, 0, 0], Be = -1, Oe = -1, Ie = 0, Pe = {
		songLen: 29,
		songData: [{
			oo: 7,
			od: 0,
			oe: 0,
			ox: 0,
			ov: 127,
			ow: 1,
			po: 6,
			pd: 0,
			pe: 9,
			px: 0,
			pv: 93,
			pw: 1,
			nf: 0,
			ea: 137,
			es: 2e3,
			er: 4611,
			em: 192,
			ff: 1,
			fq: 982,
			fr: 89,
			ft: 6,
			fm: 25,
			fp: 6,
			ft: 77,
			lf: 0,
			lq: 1,
			lr: 3,
			la: 69,
			lw: 0,
			p: [1, 1, 1, 1, 2, 2],
			c: [{
				n: [0, 135, 135, 135, 135, 135, 135, 135, 135, 135, 135, 135, 135, 135, 0, 0, 135, 140, 140, 0, 0, 0, 0, 140, 137, 0, 135, 135, 135, 0, 0, 0]
			}, {
				n: [0, 142, 142, 142, 142, 142, 142, 142, 142, 142, 142, 142, 142, 142, 0, 0, 142, 147, 147, 0, 0, 0, 0, 147, 144, 0, 142, 142, 142, 0, 0, 0]
			}]
		}, {
			oo: 7,
			od: 0,
			oe: 0,
			ox: 0,
			ov: 192,
			ow: 2,
			po: 7,
			pd: 0,
			pe: 0,
			px: 0,
			pv: 201,
			pw: 3,
			nf: 0,
			ea: 100,
			es: 150,
			er: 13636,
			em: 191,
			ff: 2,
			fq: 5839,
			fr: 254,
			ft: 6,
			fm: 121,
			fp: 6,
			ft: 147,
			lf: 0,
			lq: 1,
			lr: 6,
			la: 195,
			lw: 0,
			p: [2, 2, 2, 2, 3, 3],
			c: [{
				n: [135, 0, 135, 0, 0, 135, 0, 135, 135, 0, 135, 0, 0, 135, 0, 135, 135, 0, 135, 0, 0, 135, 0, 135, 135, 0, 135, 0, 0, 135, 0, 135]
			}, {
				n: [135, 0, 0, 0, 135, 0, 0, 0, 135, 0, 0, 0, 135, 0, 0, 0, 135, 0, 0, 0, 135, 0, 0, 0, 135, 0, 0, 0, 135, 0, 0, 0]
			}, {
				n: [149, 0, 0, 0, 149, 0, 0, 0, 149, 0, 0, 0, 149, 0, 0, 0, 149, 0, 0, 0, 149, 0, 0, 0, 149, 0, 0, 0, 149, 0, 0, 0]
			}]
		}, {
			oo: 7,
			od: 0,
			oe: 0,
			ox: 0,
			ov: 192,
			ow: 2,
			po: 7,
			pd: 0,
			pe: 0,
			px: 0,
			pv: 201,
			pw: 3,
			nf: 0,
			ea: 100,
			es: 150,
			er: 13636,
			em: 191,
			ff: 2,
			fq: 5839,
			fr: 254,
			ft: 6,
			fm: 121,
			fp: 6,
			ft: 147,
			lf: 0,
			lq: 1,
			lr: 6,
			la: 195,
			lw: 0,
			p: [1, 1, 1, 1, 2, 2],
			c: [{
				n: [154, 0, 151, 0, 0, 156, 152, 0, 0, 154, 0, 0, 151, 0, 156, 0, 0, 152, 0, 0, 154, 0, 0, 151, 0, 0, 154, 154, 0, 0, 0, 0]
			}, {
				n: [161, 0, 158, 0, 0, 163, 159, 0, 0, 161, 0, 0, 158, 0, 163, 0, 0, 159, 0, 0, 161, 0, 0, 158, 0, 0, 161, 161, 0, 0, 0, 0]
			}]
		}],
		rowLen: 5606,
		endPattern: 7
	}, Ne = u(Pe), h(Ne, function(n) {
		Re = n, tt()
	}), ze = !1, He = 0, Ue = 0, Xe = 0, Ye = 0, _e = 0, Ge = Xe, Je = Xe, Ke = [], Qe = [], Ve = 0; 100 > Ve; Ve++) Qe[Ve] = 0;
	for (Ze = "1111111111111111111100000000000000000000000000000000000000000000000000000000000011111111111111111111,1100000011111000001111110000111100000011110000001111000000111100000111110000111111000000111100000011,1000000001110000001111100001110001001000000000000000000000000000000000000111100011111111111111111111,1111111111111000011100000000000000000000000011000000011110000000000000000000000011000000111100000111,1111000011110000001111000000111100000011110001111111000000001100000000110000000011111111111111111111,1111111111100000000010000000001000000000100000000010000000001000000000100000000010000011111000000011,1111111111000000000100000000010000000001000000000100000000010000000001000000000110000000011100000001,1111000011110000001111000000111100000011110001111100000111110000111111000011111111111111111111111111,1110000011110000000100000000000000000000000011000000001100000000000000000000000011000000111100000111,1100000011111000001100110000110000000011000000001100000000110000000111000000111111000000111100000011,1100000011111000001111110000001100000000110000000011000000001100000111110000111111000000111100000011".split(","), Ke.push({
		map: Qe,
		type: 0
	}), Ve = 0; Ve < Ze.length; Ve++) Ke.push(ut(Ve + 1, Ze[Ve]));
	$e = null, nr = 0, tr = 0, er = 0, rr = 0, or = null, ir = !1, ar = t.createElement("canvas"), fr = ar.getContext("2d"), lr = 0, ur = 1, hr = 0, dr = 0, sr = 0, yr = 0, cr = null, mr = null, xr = .2, pr = 0, gr = [{
		bg: "#BBBBBB",
		bd: "#A0A0A0",
		o: "#CFCFCF",
		l: "#FFFFFF",
		name: "Dungeon"
	}, {
		bg: "#FF3333",
		bd: "#990000",
		o: "#FF0000",
		l: "#FFAAAA",
		name: "Fire"
	}, {
		bg: "#00BB00",
		bd: "#006600",
		o: "#00BB00",
		l: "#AAFFAA",
		name: "Air"
	}, {
		bg: "#3333FF",
		bd: "#000066",
		o: "#0000FF",
		l: "#AAAAFF",
		name: "Water"
	}, {
		bg: "#9F9F9F",
		bd: "#555555",
		o: "#555555",
		l: "#000000",
		name: "Earth"
	}]
}(window, document);