!function(t,e){function n(){var t,e,n,i,a,h,d,f,y,u,s,x,c,m,p,w;for(qe.strokeStyle=qn.c.bd,qe.lineWidth=2,te(),Ye.fillStyle=qn.c.bd,Ye.fillRect(0,0,He.width,He.height),Ye.fillStyle=qn.c.bg,Ye.clearRect(0-Dn,0-Hn,bn,vn),t=F(Dn)-1,e=F(Hn)-1,n=F(Dn)+F(De.width)+2,i=F(Hn)+F(De.height)+2,0>t&&(t=0),0>e&&(e=0),n>wn&&(n=wn),i>wn&&(i=wn),a={},h=e;i>h;h++)for(d=0,f=16*-wn*2,y=0,Ye.fillStyle=qn.c.bg,s=t;n>s;s++)1===En[j(s,h,wn)]&&(d+=16,f===16*-wn*2&&(f=16*s-Dn),u=0>h-1?-1:En[j(s,h-1,wn)],0===u&&(y=1)),(1!==En[j(s,h,wn)]||s===n-1)&&r(h,f,d,y),(1!==En[j(s,h,wn)]||s===n-1)&&(d=0,f=16*-wn*2,y=0);for(h=e;i>h;h++)for(s=t;n>s;s++)En[j(s,h,wn)]>1&&(9===En[j(s,h,wn)]&&qn.s>-1?(Ye.fillStyle=Jn[qn.s].l,Ye.strokeStyle=Jn[qn.s].bd,x=8,Ye.beginPath(),Ye.arc(16*s+8-Dn,16*h+8-Hn,x,0,2*Math.PI,!1),Ye.fill(),Ye.lineWidth=2,Ye.stroke(),Ye.closePath()):9!==En[j(s,h,wn)]&&(Ye.fillStyle=Jn[En[j(s,h,wn)]-2].l,r(h,16*s-Dn,16,!0)));for(s=0;Cn/10>s;s++)for(h=0;Wn/10>h;h++)c=me(qn,s,h,"N"),m=me(qn,s,h,"E"),p=me(qn,s,h,"S"),w=me(qn,s,h,"W"),c&&g(c,s,h),m&&g(m,s,h),p&&g(p,s,h),w&&g(w,s,h);o(t,e,n,i,1),o(t,e,n,i,4),l(t,e,n,i,2),l(t,e,n,i,8)}function r(t,e,n,r){var o=e,l=16*t-Hn;r?Ye.fillRect(o,l-5,n,21):Ye.fillRect(o,l,n,16)}function o(t,e,n,r,o){var l,a,h,d,f,y,u,s,x,c,m,g,p,w;for(l=t;n>l;l++)for(a=0,h=16*-wn*2,d=0,f=0,y=e;r>y;y++)u=En[j(l+1,y-1,wn)],s=En[j(l,y-1,wn)],x=En[j(l-1,y-1,wn)],1===o?(f=En[j(l-1,y,wn)],0>l-1&&(f=-1)):4===o&&(f=En[j(l+1,y,wn)],l+1>wn-1&&(f=-1)),0!==En[j(l,y,wn)]&&9!==En[j(l,y,wn)]&&1>f&&(a+=16,h===16*-wn*2&&(0===s&&(d=1),h=16*y-Hn)),(0===En[j(l,y,wn)]||9===En[j(l,y,wn)]||y===r-1||f>0)&&(qe.beginPath(),c=h,m=16*l-Dn,g=c+a,p=16*(l+1)-Dn,w=m,4===o&&(w=p),d&&(c-=5),(4===o&&0===u||1===o&&0===x)&&f>0?i(w,c,w,g+3):i(w,c,w,g),qe.closePath(),qe.stroke()),(0===En[j(l,y,wn)]||9===En[j(l,y,wn)]||y===r-1||f>0)&&(a=0,h=16*-wn*2,d=0)}function l(t,e,n,r,o){var l,a,h,d,f,y,u,s,x,c;for(l=e;r>l;l++)for(a=0,h=16*-wn*2,d=0,f=0,y=t;n>y;y++)2===o?0>l-1?f=-1:(f=En[j(y,l-1,wn)],d=1):8===o&&(f=En[j(y,l+1,wn)],l+1>wn-1&&(f=-1)),0!==En[j(y,l,wn)]&&9!==En[j(y,l,wn)]&&1>f&&(a+=16,h===16*-wn*2&&(h=16*y-Dn)),(0===En[j(y,l,wn)]||9===En[j(y,l,wn)]||y===n-1||f>0)&&(qe.beginPath(),u=h,s=16*l-Hn,x=u+a,c=16*(l+1)-Hn,2===o?1===d?(i(u,s-5,x,s-5),i(u,s+3,x,s+3)):i(u,s,x,s):8===o&&i(u,c,x,c),qe.closePath(),qe.stroke()),(0===En[j(y,l,wn)]||9===En[j(y,l,wn)]||y===n-1||f>0)&&(a=0,h=16*-wn*2,d=0)}function i(t,e,n,r){qe.moveTo(t,e),qe.lineTo(n,r)}function a(){var t,e,n,r,o;for(Ge.width=Kn,Ge.height=Kn,ee(),Oe=16*qn.x+16*F(F(F(nn.x),10),1),Ie=16*qn.y+16*F(F(F(nn.y),10),1),Ue.clearRect(0,0,Ge.width,Ge.height),Re.length=0,Ue.lineWidth=2,Ue.fillStyle="#000",t=0;t<Yn.r.length;t++)for(e=0;e<Yn.r[t].rooms.length;e++)n=Yn.r[t].rooms[e],r=16*n.x-zn,o=16*n.y-Xn,r+16*n.mw>0&&o+16*n.mh>0&&r<Ge.width&&o<Ge.height&&(Ue.beginPath(),Ue.rect(r,o,16*n.mw,16*n.mh),Ue.fill(),Ue.closePath());h("bg","bd",function(t,e,n){t.v&&(Ue.beginPath(),Ue.rect(e,n,16*t.mw,16*t.mh),Ue.fill(),Ue.stroke(),Ue.closePath())},Ue),h("bd",0,function(t,e,n){t.r.u&&!t.v&&(Ue.beginPath(),Ue.rect(e,n,16*t.mw,16*t.mh),Ue.fill(),Ue.stroke(),Ue.closePath())},Ue),Ae.clearRect(0,0,16,16),h("bg","bd",function(t,e,n){t.v&&(Ae.beginPath(),Ae.rect(e/16*2,n/16*2,2*t.mw,2*t.mh),Ae.fill(),Ae.stroke(),Ae.closePath())},Ae),Qn.href=Vn.toDataURL(),h(0,"bg",y,Ue),h(0,0,d,Ue),x()}function h(t,e,n,r){var o,l,i,a,h,d=r||Ue;for(o=0;o<Yn.r.length;o++)for(d.fillStyle="string"==typeof t?Yn.r[o].color[t]:"rgba(0,0,0,0)",d.strokeStyle="string"==typeof e?Yn.r[o].color[e]:"rgba(0,0,0,0)",l=0;l<Yn.r[o].rooms.length;l++)i=Yn.r[o].rooms[l],a=16*i.x-zn,h=16*i.y-Xn,a+16*i.mw>0&&h+16*i.mh>0&&a<Ge.width&&h<Ge.height&&n(i,a,h,d)}function d(t){var e,n,r,o,l,i;if(t.v){for(e=null,n=null,r=null,o=0;o<t.d.length;o++)e=t.d[o],e.dt>-1&&(n=Jn[e.dt].l,r=Jn[e.dt].bd,l=0,i=0,"N"===e.dir&&(l=5),"S"===e.dir&&(l=5,i=16),"W"===e.dir&&(l=-3,i=8),"E"===e.dir&&(l=13,i=8),f(16*e.x+l,16*e.y+i,n,r));t.s>-1&&(n=Jn[t.s].l,r=Jn[t.s].bd,f(16*(t.x+t.mw/2)-3,16*(t.y+t.mh/2),r,n))}}function f(t,e,n,r){var o=3;Ue.beginPath(),Ue.arc(t+o-zn,e-Xn,o,0,2*Math.PI,!1),Ue.fillStyle=n,Ue.fill(),r&&(Ue.lineWidth=2,Ue.strokeStyle=r,Ue.stroke()),Ue.closePath()}function y(t){var e,n,r,o,l,i;if(t.v)for(e=null,n=0;n<t.d.length;n++)e=t.d[n],r=t.x+"-"+t.y+"-"+e.r2.x+"-"+e.r2.y,o=e.r2.x+"-"+e.r2.y+"-"+t.x+"-"+t.y,-1===Re.indexOf(o)&&-1===Re.indexOf(r)&&(l=16*e.x,i=16*e.y,"N"===e.dir&&u(l+4,i,l+16-4,i),"S"===e.dir&&u(l+4,16*(e.y+1),l+16-4,16*(e.y+1)),"W"===e.dir&&u(l,i+4,l,i+16-4),"E"===e.dir&&u(16*(e.x+1),i+4,16*(e.x+1),i+16-4),Re.push(r))}function u(t,e,n,r){Ue.beginPath(),Ue.moveTo(t-zn,e-Xn),Ue.lineTo(n-zn,r-Xn),Ue.stroke(),Ue.closePath()}function s(){for(var t=0;t<nn.keys.length;t++)Xe.beginPath(),Xe.fillStyle=Jn[nn.keys[t]].l,Xe.rect(nn.x-Dn,nn.y-Hn+(4-t)*nn.h/5,nn.w,nn.h/5),Xe.fill(),Xe.closePath()}function x(){var t,e,n,r;for(Xe.fillStyle="#000000",t=0;t<on.length;t++)e=on[t],n=(15-15*(nn.ῼ/nn.mῼ)).toString(16),Xe.beginPath(),Xe.fillStyle="rgba(0,0,0,0.1)",Xe.rect(e.x-Dn,e.y-Hn,e.w,e.h),Xe.fill(),Xe.closePath(),s(),Xe.beginPath(),Xe.lineWidth=1,Xe.strokeStyle="#"+n+n+"0000",Xe.fillStyle="rgba(0,0,0,0)",Xe.rect(e.x-Dn,e.y-Hn,e.w,e.h),Xe.stroke(),Xe.closePath();Ne+=2*(rn/1e3),Ne%=2,r=1,Ne>1&&(r=0),Le!==r&&(Je.fillStyle="rgba(255,255,0,"+.6*r+")",Je.strokeStyle="rgba(255,255,0,"+.8*r+")"),Ke.width!==Ge.width&&(Ke.width=Ge.width,Ke.height=Ge.height,Je.fillStyle="rgba(255,255,0,"+.6*r+")",Je.strokeStyle="rgba(255,255,0,"+.8*r+")"),Be||(Je.lineWidth=1,Be=!0),Je.clearRect(0,0,Ke.width,Ke.height),Je.beginPath(),Je.rect(Oe-zn,Ie-Xn,16,16),Je.fill(),Je.stroke(),Je.closePath(),Ae.beginPath(),Ae.fillStyle="rgba(200,200,255,1)",Ae.strokeStyle="rgba(200,200,255,1)",Ae.rect((Oe-zn)/16*2,(Ie-Xn)/16*2,2,2),Ae.fill(),Ae.stroke(),Ae.closePath(),Le=r}function c(){nn.keys.length>0&&(Xe.fillStyle=Jn[nn.keys[pn]].l,Xe.strokeStyle="#000000",Xe.save(),Xe.translate(nn.x-Dn+nn.w/2,nn.y-Hn+nn.h/2),Xe.rotate(dn),Xe.beginPath(),Xe.moveTo(10+nn.w,0),Xe.lineTo(0+nn.w,-10),Xe.lineTo(0+nn.w,10),Xe.lineTo(10+nn.w,0),Xe.fill(),Xe.stroke(),Xe.closePath(),Xe.restore())}function m(){var t,e;for(t=0;t<fn.length;t++)e=fn[t],Xe.fillStyle=Jn[e.key].l,Xe.strokeStyle=Jn[e.key].bd,Xe.lineWidth=1,Xe.save(),Xe.translate(e.x-Dn,e.y-Hn),Xe.rotate(e.a),Xe.beginPath(),Xe.rect(0,0,10,2),Xe.fill(),Xe.stroke(),Xe.closePath(),Xe.restore()}function g(t,e,n){var r,o,l;Ye.fillStyle=-1===t.dt?"#000000":Jn[t.dt].l,Ye.strokeStyle="#FFFFFF",Ye.save(),r=0,o=160,l=80,"N"===t.dir&&(r=90,l=0,o=80),"W"===t.dir&&(r=180,o=0,l=80),"S"===t.dir&&(r=270,o=80,l=160),Ye.translate(16*e*10-Dn+o,16*n*10-Hn+l),Ye.beginPath(),"N"===t.dir&&(Ye.moveTo(0,-20),Ye.lineTo(10,-10),Ye.lineTo(-10,-10),Ye.lineTo(0,-20)),"W"===t.dir&&(Ye.moveTo(-20,0),Ye.lineTo(-10,-10),Ye.lineTo(-10,10),Ye.lineTo(-20,0)),"S"===t.dir&&(Ye.moveTo(0,20),Ye.lineTo(10,10),Ye.lineTo(-10,10),Ye.lineTo(0,20)),"E"===t.dir&&(Ye.moveTo(20,0),Ye.lineTo(10,-10),Ye.lineTo(10,10),Ye.lineTo(20,0)),Ye.fill(),Ye.stroke(),Ye.closePath(),Ye.restore()}function p(t,e){tn[t]||(tn[t]=[]),tn[t].push(e)}function w(t){var e,n=t.type;if(tn[n]&&tn[n].length>0)for(e=0;e<tn[n].length;e++)tn[n][e](t)}function v(t){return e.getElementById(t)}function b(){var t,n,r,o,l,i,a,h,d;for(De=v("p"),ze=v("b"),He=v("t"),Ge=v("m"),Ke=v("i"),Xe=De.getContext("2d"),qe=ze.getContext("2d"),Ye=He.getContext("2d"),Ue=Ge.getContext("2d"),Je=Ke.getContext("2d"),k(),Ce(),t=null,n=0;n<Jn.length;n++){for(r=M(5,10),o=0;r>o;o++)pe();n+1<Jn.length&&(t=Yn.r[Yn.r.length-1],re(We(),t))}l=Yn.r[0].rooms[0],i=l.d[0],a=i.dir,h=i.x,l.sr=!0,l.sx=h-l.x,l.sy=i.y-l.y,("E"===i.dir||"W"===i.dir)&&(h=i.y),Pe(),Me(),_(l,a,h),P(),d=e.createElement("span"),d.innerHTML="<p>find 5 color circles</p><br><p>A, D, to move</p><p>space to jump</p><p>mouse to aim</p><p>left click to take colors</p><p>right click to place colors</p><p>middle click to change colors</p><p>hold tab for a larger minimap</p>",e.body.appendChild(d)}function k(){ze.width=De.width=He.width=t.innerWidth>300?300:t.innerWidth,ze.height=De.height=He.height=t.innerHeight>300?300:t.innerHeight}function S(){var t,e;if(Qe){for(t=0;t<on.length;t++)e=on[t],D(e),e.x=C(e.x),e.y=C(e.y),Y(e),X(e),H(e),Z(),z(e);for(R(),B(),t=0;t<fn.length;t++)U(fn[t]);Xe.clearRect(0,0,De.width,De.height),qe.clearRect(0,0,ze.width,ze.height),n(),a(),c(),m()}}function P(){$e=t.performance.now(),rn=$e-_e,_e=$e,e.dispatchEvent(Ze),Ve&&requestAnimationFrame(P)}function M(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function F(t,e){var n=t%(e||16);return(t-n)/(e||16)}function j(t,e,n){return e*n+t}function E(t,e){var n,r,o;if("object"==typeof e){for(n=0;n<t.length;n++)if(r=!0,"object"==typeof t[n]){for(o in e)if(t[n][o]!==e[o]){r=!1;break}if(r===!0)return n}return-1}return t.indexOf(e)}function C(t){return~~(.5+t)}function W(e){for(var n in ln)ln[n]===e.keyCode&&e.preventDefault();en[e.keyCode]!==e.type&&(e.keyCode===ln.space&&(nn.j=1),e.keyCode===ln.tab&&(Kn=Math.min(16*F(t.innerHeight),16*F(t.innerWidth)))),en[e.keyCode]=e.type,e.keyCode===ln.d?nn.xd=1:e.keyCode===ln.a&&(nn.xd=-1)}function T(t){for(var e in ln)ln[e]===t.keyCode&&t.preventDefault();en[t.keyCode]!==t.type&&t.keyCode===ln.space&&(nn.j=0),en[t.keyCode]=t.type,t.keyCode===ln.tab&&(Kn=150),(t.keyCode===ln.d||t.keyCode===ln.a)&&(en[ln.d]&&en[ln.a]?en[ln.d]===t.type&&en[ln.a]===t.type&&(nn.xd=0):nn.xd=0)}function A(t){var e=De.getBoundingClientRect();mn=t.clientX-e.left,gn=t.clientY-e.top,an=t.clientX,hn=t.clientY,dn=Math.atan2(nn.y+nn.h/2-Hn-gn,nn.x+nn.w/2-Dn-mn)+Math.PI}function O(t){t.preventDefault(),1===t.which&&(un=!0),2===t.which&&(pn++,pn>nn.keys.length-1&&(pn=0)),3===t.which&&(sn=!0)}function I(t){t.preventDefault(),1===t.which&&(un=!1),3===t.which&&(sn=!1)}function R(){un&&t.performance.now()-yn>xn&&nn.keys.length>0&&(yn=t.performance.now(),fn.push(L(nn.x+nn.w/2+10*Math.cos(dn),nn.y+nn.h/2+10*Math.sin(dn),dn,nn.keys[pn])))}function N(t){t.preventDefault()}function B(){var t,e,n;sn&&(t=mn+Dn,e=gn+Hn,t>=0&&16*Cn>t&&e>=0&&16*Wn>e&&(n=j(F(t),F(e),wn),0===En[n]&&cn[nn.keys[pn]]>0&&(En[n]=nn.keys[pn]+2,cn[nn.keys[pn]]--)))}function L(t,e,n,r){return{x:t,y:e,a:n,key:r}}function D(t){t.xa=t.xa+t.xd/60*rn,t.xa>t.maxa&&(t.xa=t.maxa),t.xa<-t.maxa&&(t.xa=-t.maxa),0===t.xd&&(t.xa>0?t.xa=t.xa+-2/60*rn:t.xa<0&&(t.xa=t.xa+2/60*rn),(t.xa<1/60*rn&&t.xa>-1/60*rn||1===t.yd||-1===t.yd)&&(t.xa=0)),t.x=t.x+t.xa}function H(t){t.j&&-1!==t.yd&&t.ju<t.mj&&(t.mj>1&&0===t.ju&&1===t.yd&&t.ju++,(0===t.ju&&0===t.yd||t.ju>0||t.mj>1)&&(t.yd=-1,t.ya=-t.jf,t.js=t.y,t.ju++),t.ht=0),(0===t.yd||!t.j||t.ht>t.jh)&&(t.yd=1),1===t.yd&&(t.j=0,t.ya=t.ya+t.jf/2/60*rn),0===t.yd&&(t.ya>0?t.ya=t.ya+-1/60*rn:t.ya<0&&(t.ya=t.ya+1/60*rn),t.ya<1/60*rn&&t.ya>-1/60*rn&&(t.ya=0)),t.ya>t.maxa&&(t.ya=10),t.ht-=t.ya,t.ht=C(t.ht),t.y=t.y+t.ya}function z(t){var e=t.x%16,n=j(F(t.x),F(t.y+t.h),wn),r=j(F(t.x+t.w),F(t.y+t.h),wn),o=!1;o=0===e?q(En[n]):q(En[r])||q(En[n]),(o||t.y+t.h>16*Wn)&&1===t.yd&&(t.y=16*F(t.y),t.ya=0,t.yd=0,t.ju=0,t.j=0,t.ht=0)}function X(t){var e=t.x%16,n=j(F(t.x),F(t.y-t.h/2),wn),r=j(F(t.x+t.w),F(t.y-t.h/2),wn),o=!1;o=0===e?q(En[n]):q(En[n])||q(En[r]),o&&1===t.j&&(t.y=16*F(t.y),t.ya=-1,t.yd=1,t.j=0,t.ht=0)}function Y(t){var e=t.y%16,n=t.x%16,r=j(F(t.x),F(t.y-t.h/2),wn),o=j(F(t.x+t.w),F(t.y-t.h/2),wn),l=j(F(t.x),F(t.y),wn),i=j(F(t.x+t.w),F(t.y),wn),a=j(F(t.x),F(t.y+t.h/2),wn),h=j(F(t.x+t.w),F(t.y+t.h/2),wn),d=j(F(t.x),F(t.y+t.h),wn),f=j(F(t.x+t.w),F(t.y+t.h),wn),y=!1,u=!1;0===e?(y=q(En[a])||q(En[l]),u=q(En[h])||q(En[i])):16*F(t.y+t.h)>t.y+t.h?(y=q(En[a])||q(En[l])||q(En[r]),u=q(En[h])||q(En[i])||q(En[o])):(y=q(En[a])||q(En[l])||q(En[d]),u=q(En[h])||q(En[i])||q(En[f])),0===n?(u||t.x+t.w>16*Cn||t.x<0)&&t.xa>0&&(t.x=16*F(t.x),t.xa=0):(u||t.x+t.w>16*Cn||t.x<0)&&t.xa>0?(t.x=16*F(t.x),t.xa=0):(y||t.x+t.w>16*Cn||t.x<0)&&t.xa<0&&(t.x=16*F(t.x+t.w),t.xa=0)}function q(t){return 9===t&&Fe(qn),0!==t}function U(t){var e,n,r,o,l=!1;t.x+=Math.cos(t.a)*(10/60)*rn,t.y+=Math.sin(t.a)*(10/60)*rn,e=F(t.x),n=F(t.y),r=j(e,n,wn),0!==En[r]&&(En[r]>1&&nn.keys[pn]===En[r]-2&&(cn[En[r]-2]++,En[r]=0),l=!0),(t.x>16*Cn||t.x<0||t.y>16*Wn||t.y<0)&&(l=!0),l&&(o=fn.indexOf(t),o>-1&&fn.splice(o,1))}function G(t,e){e=e.split("");for(var n=0;n<e.length;n++)e[n]=parseInt(e[n]);return{map:e,type:t}}function J(t){return{map:t.map.slice(0),type:t.type}}function K(t,e,n,r){var o,l,i,a,h,d,f,y,u,s,x,c,m,g,p,w=[],v=[],b=Math.max(t,e);for(o=0;b*b>o;o++)w[o]=0;for(w=r(w,t,e,b),i={},y=0;10*b>y;y++)for(u=0;10*b>u;u++)s=Math.floor(u/10),x=Math.floor(y/10),a=me(n,s,x,"N"),h=me(n,s,x,"E"),d=me(n,s,x,"S"),f=me(n,s,x,"W"),c=j(s,x,b),m=s+"-"+x,(u%10===0||y%10===0)&&(i[m]||(l=J(Pn[w[c]]),i[m]=l),l=i[m]),g=j(u,y,10*b),p=j(u%10,y%10,10),v[g]=l.map[p],0!==n.r.id&&0===v[g]&&9!==l.type&&10*t>u&&10*e>y&&10*t>u&&10*e>y&&1===M(0,1)&&(v[g]=n.r.id+2),0===y&&null===a&&10*t>u&&(v[g]=1),0===u&&null===f&&10*e>y&&(v[g]=1),y===10*e-1&&null===d&&10*t>u&&(v[g]=1),u===10*t-1&&null===h&&10*e>y&&(v[g]=1),0===y&&null!==a&&10*t>u&&a.dt>-1&&0===v[g]&&(v[g]=a.dt+2),0===u&&null!==f&&10*e>y&&f.dt>-1&&0===v[g]&&(v[g]=f.dt+2),y===10*e-1&&null!==d&&10*t>u&&d.dt>-1&&0===v[g]&&(v[g]=d.dt+2),u===10*t-1&&null!==h&&10*e>y&&h.dt>-1&&0===v[g]&&(v[g]=h.dt+2);return{map:v,width:t,height:e,size:b,tiles:10*b}}function Q(t){var e,n,r,o,l,i,a,h,d,f,y,u;if(t.map=K(1*t.mw,1*t.mh,t,function(e,n,r,o){var l,i,a,h,d,f,y,u=0,s=0,x=0;for(l=0;o*o>l;l++)i=me(t,u,s,"N"),a=me(t,u,s,"E"),h=me(t,u,s,"S"),d=me(t,u,s,"W"),f=[1,3,4,9],y=[2,9,10,11],(0===u||0===s||u===n-1||s===r-1)&&(x=M(0,11)),(0===u||u===n-1)&&(x=y[M(0,3)]),(0===s||s===r-1)&&(x=f[M(0,3)]),(0===u&&0===s||u===n-1&&0===s||u===n-1&&s===r-1||0===u&&s===r-1)&&(x=9),1===t.mw&&(x=y[M(0,3)]),1===t.mh&&(x=f[M(0,3)]),0===u&&0===s&&(x=6),u===n-1&&0===s&&(x=7),0===u&&s===r-1&&(x=5),u===n-1&&s===r-1&&(x=8),(i||h||a||d)&&(x=9),e[j(u,s,o)]=x,u++,u>n-1&&(u=0,s++),s>r-1&&(l=o*o);return e}),t.s>-1&&-1===nn.keys.indexOf(t.s)){for(e=0,n=!1;n===!1&&5>e;)t.sr?(r=1*t.sx,o=1*t.sy,l=M(1,9),i=M(1,9)):(r=M(1,1*t.mw)-1,o=M(1,1*t.mh)-1,l=M(1,9),i=M(1,9)),a=j(10*r+l,10*o+i,t.map.tiles),h=0===t.map.map[a]||t.map.map[a]===t.r.id+2,h&&(n=!0,t.map.map[j(10*r+l,10*o+i,t.map.tiles)]=9),e++;if(!n)if(t.sr)for(d=1*t.sx*10,f=1*t.sy*10,y=d+1;d+10-1>y;y++)for(u=f+1;f+10-1>u;u++)a=j(y,u,t.map.tiles),h=0===t.map.map[a]||t.map.map[a]===t.r.id+2,h&&(t.map.map[a]=9);else for(d=1*t.sx*10,f=1*t.sy*10,y=1;y<1*t.mw*10-1;y++)for(u=1;u<1*t.mh*10-1;u++)a=j(y,u,t.map.tiles),h=0===t.map.map[a]||t.map.map[a]===t.r.id+2,h&&(t.map.map[a]=9)}}function V(t,e,n){var r,o,l,i,a;for(r=0;r<t.d.length;r++)o=!1,l=t.d[r],l.dir===e&&(("N"===l.dir||"S"===l.dir)&&(o=n===l.x),("E"===l.dir||"W"===l.dir)&&(o=n===l.y),o&&(i=1*(l.x-t.x),a=1*(l.y-t.y),-1===nn.y&&(nn.y=10*a*16+80),-1===nn.x&&(nn.x=10*i*16+80),"N"===l.dir&&(i+=Math.floor(.5),nn.y=0,l.dt>-1&&(nn.y=16),nn.x=nn.x%160+10*i*16),"E"===l.dir&&(a+=Math.floor(.5),i+=1,nn.x=10*t.mw*16*1-nn.w,l.dt>-1&&(nn.x-=16),nn.y=nn.y%160+10*a*16),"S"===l.dir&&(i+=Math.floor(.5),a+=1,nn.y=10*t.mh*16*1-nn.h,l.dt>-1&&(nn.y-=16),nn.x=nn.x%160+10*i*16),"W"===l.dir&&(a+=Math.floor(.5),nn.x=0,l.dt>-1&&(nn.x=16),nn.y=nn.y%160+10*a*16)))}function Z(){var e,n,r,o,l,i,a,h,d,f;for(e=0;e<qn.d.length;e++)n=qn.d[e],r=1*(n.x-qn.x),o=1*(n.y-qn.y),l=F(F(nn.x),10),i=F(F(nn.x+nn.w),10),a=F(F(nn.y),10),h=F(F(nn.y+nn.h),10),d=10*qn.mw*16*1,f=10*qn.mh*16*1,"N"===n.dir&&(r+=Math.floor(.5)),"E"===n.dir&&(o+=Math.floor(.5),r+=1),"S"===n.dir&&(r+=Math.floor(.5),o+=1),"W"===n.dir&&(o+=Math.floor(.5)),t.performance.now()-nn.dc>400&&(nn.x<=0&&-1===nn.xd&&"W"===n.dir&&r===l&&o===a&&_(n.r2,"E",n.y),nn.y<=0&&-1===nn.yd&&"N"===n.dir&&r===l&&o===a&&_(n.r2,"S",n.x),nn.x+nn.w>=d&&1===nn.xd&&"E"===n.dir&&r===i&&o===a&&_(n.r2,"W",n.y),nn.y+nn.h>=f&&0!==nn.yd&&Math.abs(nn.ya)>5&&"S"===n.dir&&r===l&&(o===h||o===a)&&_(n.r2,"N",n.x))}function $(){var r,o,l,i,h,d;In&&(null===qn&&(Bn=Ln),r=De.width,o=De.height,l=r,i=o,Ln>Bn&&(l=r*Bn/Ln,l=r-l,i=o*Bn/Ln,i=o-i),Bn>=Ln&&(qn!==On&&(qe.clearRect(0,0,r,o),Ye.clearRect(0,0,r,o),qn=On,qn.v=!0,wn=On.map.tiles,En=On.map.map,Wn=10*On.map.height,Cn=10*On.map.width,vn=10*On.map.height*16,bn=10*On.map.width*16,V(On,Tn,An),e.title=qn.c.name,history.pushState(null,null,"#"+e.title),fn.length=0),l=r*(Bn-Ln)/Ln,i=o*(Bn-Ln)/Ln),Rn.width=r,Rn.height=o,Nn.clearRect(0,0,r,o),a(),n(),Nn.drawImage(He,0,0),Nn.drawImage(ze,0,0),Nn.drawImage(De,0,0),Xe.clearRect(0,0,r,o),ze.style.display="none",He.style.display="none",Nn.globalCompositeOperation="destination-in",h=nn.x+nn.w/2-Dn-l/2,d=nn.y+nn.h/2-Hn-i/2,Nn.beginPath(),Nn.rect(h,d,l,i),Nn.fillStyle="black",Nn.fill(),Xe.drawImage(Rn,0,0),Bn+=2*Ln*(rn/1e3),Bn>2*Ln&&(Bn=0,Qe=!0,On=null,In=!1,ze.style.display="initial",He.style.display="initial",nn.dc=t.performance.now()))}function _(t,e,n){Tn=e,An=n,In=!0,On=t,Qe=!1,null===t.map&&Q(t)}function te(){var t=Ye.canvas,e=t.width/2,n=t.height/2;nn.x-Dn+e>t.width?Dn=nn.x-(t.width-e):nn.x-e<Dn&&(Dn=nn.x-e),nn.y-Hn+n>t.height?Hn=nn.y-(t.height-n):nn.y-n<Hn&&(Hn=nn.y-n),Hn=~~(.5+Hn),Hn=~~(.5+Hn)}function ee(){var t=Ue.canvas,e=t.width/2,n=t.height/2,r=16*(qn.x+F(F(F(nn.x),10),1)),o=16*(qn.y+F(F(F(nn.y),10),1));r-zn+e>t.width?zn=r-(t.width-e):zn>r-e&&(zn=r-e),o-Xn+n>t.height?Xn=o-(t.height-n):Xn>o-n&&(Xn=o-n),Xn=~~(.5+Xn),Xn=~~(.5+Xn)}function ne(t,e,n){Yn.f.length=0,Yn.f.push({x:t,y:e}),Yn.cr=n,Yn.r.push(n)}function re(t,e){for(var n,r,o=!0,l=le(e),i=[],a=null,h=[];o;){if(n=0,a=oe(l,h),i.length=0,a)for(i.push(ce(a.x-1,a.y),ce(a.x+1,a.y),ce(a.x,a.y-1),ce(a.x,a.y+1)),r=0;4>r;r++)null===i[r]&&n++;else o=!1;n>2&&(o=!1)}a&&ne(a.x,a.y,t)}function oe(t,e){if(e.length===t.length)return!1;for(var n=M(0,t.length-1);e.indexOf(n)>-1;)n=M(0,t.length-1);return e.push(n),t[n]}function le(t){var e,n=[],r=Yn.rooms;for(t&&(r=t.rooms),e=0;e<r.length;e++)n=ie(n,r[e]);return n}function ie(t,e){for(var n,r=e.x;r<e.x+e.mw;)ae(r,e.y-1,1,1)&&t.push({x:r,y:e.y-1}),ae(r,e.y+e.mh,1,1)&&t.push({x:r,y:e.y+e.mh}),r++;for(n=e.x;n<e.y+e.mh;)ae(n,e.x-1,1,1)&&t.push({x:n,y:e.x-1}),ae(n,e.x+e.mw,1,1)&&t.push({x:n,y:e.x+e.mw}),n++;return t}function ae(t,e,n,r){return he(t,e,n,r)&&!de(t,e,n,r)}function he(t,e,n,r){return t>0&&e>0&&t+n<Yn.width&&e+r<Yn.height}function de(t,e,n,r){for(var o=null,l=0;l<Yn.rooms.length;){o=Yn.rooms[l];{if(!(o.x>t+n-1||o.x+o.mw-1<t||o.y>e+r-1||o.y+o.mh-1<e))return!0;l++}}return!1}function fe(t){for(var e,n,r,o=0,l=null,i=!1,a=100;Yn.rooms.length>1&&!i;){for(o=0,o+=ye(t),o+=ue(t),o+=se(t),o+=xe(t),1===t.r.rooms.length&&o>0&&(i=!0),e=0;e<t.d.length;e++)l=t.d[e],Ee(l,t).r===t.r&&(i=!0);a--,0===a&&(i=!0)}for(e=0;e<t.d.length;e++)n=t.r,r=Ee(l,t).r,n!==r&&(-1===n.bds.indexOf(r)&&n.bds.push(r),-1===r.bds.indexOf(n)&&r.bds.push(n))}function ye(t){for(var e,n,r,o,l=null,i=null,a=null,h=null,d=[],f=t.x;f<t.x+t.mw;)i=ce(f,t.y-1),null!==i&&d.push({x:f,y:t.y,o:i}),f++;for(e=0,n=0;n<d.length;n++){for(l=d[n],r=!1,o=0;o<t.d.length;o++)t.d[o].r2===l.o&&(r=!0);Math.random()>Un||E(t.d,l)>=0||r||(a=Se(l.x,l.y,"N",t,l.o),h=Se(l.x,l.y-1,"S",l.o,t),t.d.push(a),a.o=h,h.o=a,l.o.d.push(h),e++)}return e}function ue(t){for(var e,n,r,o,l=null,i=null,a=null,h=null,d=[],f=t.x;f<t.x+t.mw;)i=ce(f,t.y+t.mh),null!==i&&d.push({x:f,y:t.y+t.mh-1,o:i}),f++;for(e=0,n=0;n<d.length;n++){for(l=d[n],r=!1,o=0;o<t.d.length;o++)t.d[o].r2===l.o&&(r=!0);Math.random()>Un||E(t.d,l)>=0||r||(a=Se(l.x,l.y,"S",t,l.o),h=Se(l.x,l.y+1,"N",l.o,t),t.d.push(a),a.o=h,h.o=a,l.o.d.push(h),e++)}return e}function se(t){for(var e,n,r,o,l=null,i=null,a=null,h=null,d=[],f=t.y;f<t.y+t.mh;)i=ce(t.x-1,f),null!==i&&d.push({x:t.x,y:f,o:i}),f++;for(e=0,n=0;n<d.length;n++){for(l=d[n],r=!1,o=0;o<t.d.length;o++)t.d[o].r2===l.o&&(r=!0);Math.random()>Un||E(t.d,l)>=0||r||(a=Se(l.x,l.y,"W",t,l.o),h=Se(l.x-1,l.y,"E",l.o,t),t.d.push(a),a.o=h,h.o=a,l.o.d.push(h),e++)}return e}function xe(t){for(var e,n,r,o,l=null,i=null,a=null,h=null,d=[],f=t.y;f<t.y+t.mh;)i=ce(t.x+t.mw,f),null!==i&&d.push({x:t.x+t.mw-1,y:f,o:i}),f++;for(e=0,n=0;n<d.length;n++){for(l=d[n],r=!1,o=0;o<t.d.length;o++)t.d[o].r2===l.o&&(r=!0);Math.random()>Un||E(t.d,l)>=0||r||(a=Se(l.x,l.y,"E",t,l.o),h=Se(l.x+1,l.y,"W",l.o,t),a.o=h,h.o=a,t.d.push(a),l.o.d.push(h),e++)}return e}function ce(t,e){for(var n=null,r=0;r<Yn.rooms.length;){n=Yn.rooms[r];{if(!(n.x>t||n.x+n.mw-1<t||n.y>e||n.y+n.mh-1<e))return n;r++}}return null}function me(t,e,n,r){var o,l=null;for(o=0;o<t.d.length;o++)if(l=t.d[o],l.dir===r&&l.x===t.x+e&&l.y===t.y+n)return l;return null}function ge(t){for(var e=0,n=Yn.rooms.length;e++<10*t&&Yn.rooms.length<n+t;)pe()}function pe(){var t=[],e=oe(Yn.f,t);e&&we(be(e.x,e.y))}function we(t){if(null===t||!ae(t.x,t.y,t.mw,t.mh))return!1;var e=[];e=ve(e,t),Yn.f=ie(e,t),t.c=Yn.cr.color,Yn.rooms.push(t),Yn.cr.rooms.push(t),fe(t)}function ie(t,e){for(var n,r=e.x;r<e.x+e.mw;)ae(r,e.y-1,1,1)&&t.push({x:r,y:e.y-1}),ae(r,e.y+e.mh,1,1)&&t.push({x:r,y:e.y+e.mh}),r++;for(n=e.y;n<e.y+e.mh;)ae(e.x-1,n,1,1)&&t.push({x:e.x-1,y:n}),ae(e.x+e.mw,n,1,1)&&t.push({x:e.x+e.mw,y:n}),n++;return t}function ve(t,e){for(var n=0;n<Yn.f.length;n++)Yn.f[n].x>=e.x-1&&Yn.f[n].x<=e.x+e.mw&&Yn.f[n].y>=e.y&&Yn.f[n].y<=e.y+e.mh-1||Yn.f[n].x>=e.x&&Yn.f[n].x<=e.x+e.mw-1&&Yn.f[n].y>=e.y-1&&Yn.f[n].y<=e.y+e.mh||t.push(Yn.f[n]);return t}function be(t,e){for(var n,r=0,o=1,l=1;r++<25&&(o<Yn.cr.maxW||l<Yn.cr.maxH)&&Math.random()<.9;)n=parseInt(4*Math.random()),0===n&&l<Yn.cr.maxH&&ae(t,e-1,o,l+1)&&(e--,l++),1===n&&l<Yn.cr.maxH&&ae(t,e,o,l+1)&&l++,2===n&&o<Yn.cr.maxW&&ae(t-1,e,o+1,l)&&(t--,o++),3===n&&o<Yn.cr.maxW&&ae(t,e,o+1,l)&&o++;return ke(t,e,o,l,Yn.cr)}function ke(t,e,n,r,o){return{x:t,y:e,mw:n,mh:r,c:null,r:o,s:-1,sx:0,sy:0,sr:!1,v:!1,d:[],map:null}}function Se(t,e,n,r,o){return{x:t,y:e,dt:-1,dir:n,r1:r,r2:o,o:null}}function Pe(){var t,e,n=null,r=null;for(t=0;t<Yn.rooms.length;t++)for(n=Yn.rooms[t],n.s=-1,e=0;e<n.d.length;e++)r=n.d[e],r.dt=-1}function Me(){var t,e,n,r,o=null,l=null,i=null,a=null;for(t=0;t<Yn.r.length;t++)for(e=[],l=Yn.r[t],0!==t&&(a=oe(l.rooms,e),a.s=(t+1)%Jn.length),n=0;n<l.rooms.length;n++)for(a=l.rooms[n],0===t&&a.sr&&(a.s=(t+1)%Jn.length),r=0;r<a.d.length;r++)o=a.d[r],i=Ee(o,a).r,i!==l&&-1===o.o.dt&&(o.o.dt=t%Jn.length)}function Fe(t){-1===nn.keys.indexOf(t.s)&&t.s>-1&&(nn.keys.push(t.s),je())}function je(){var t,e,n,r,o,l;for(t=0;t<Yn.r.length;t++)nn.keys.indexOf(Yn.r[t].id)>-1&&(Yn.r[t].u=!0);for(e=0;e<Yn.rooms.length;e++){for(n=!1,r=Yn.rooms[e],nn.keys.indexOf(r.s)>-1&&(r.s=-1,null!==r.map&&(o=r.map.map.indexOf(9),o>-1&&(r.map.map[o]=0))),t=0;t<r.d.length;t++)l=r.d[t],nn.keys.indexOf(l.dt)>-1&&(l.dt=-1,n=!0);n&&null!==r.map&&-1===r.s}}function Ee(t,e){return t.r1===e?t.r2:t.r1}function Ce(){Yn={width:0,height:0,rooms:[],f:[],r:[],cr:0},Gn=0,Yn.width=80,Yn.height=48,ne(40,24,We()),ge(1)}function We(){var t=Te(Jn[Gn],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1,Gn);return Gn=(Gn+1)%Jn.length,t}function Te(t,e,n,r){return{color:t,maxW:e,maxH:n,id:r,u:!1,bds:[],rooms:[]}}var Ae,Oe,Ie,Re,Ne,Be,Le,De,He,ze,Xe,Ye,qe,Ue,Ge,Je,Ke,Qe,Ve,Ze,$e,_e,tn,en,nn,rn,on,ln,an,hn,dn,fn,yn,un,sn,xn,cn,mn,gn,pn,wn,vn,bn,kn,Sn,Pn,Mn,Fn,jn,En,Cn,Wn,Tn,An,On,In,Rn,Nn,Bn,Ln,Dn,Hn,zn,Xn,Yn,qn,Un,Gn,Jn,Kn=150,Qn=e.getElementById("f"),Vn=e.createElement("canvas");for(Vn.height=16,Vn.width=16,Ae=Vn.getContext("2d"),Oe=0,Ie=0,Re=[],Ne=0,Be=!1,Le=0,Qe=!0,Ve=!0,Ze=new CustomEvent("frame"),$e=t.performance.now(),_e=t.performance.now(),tn={},en={},nn={x:-1,y:-1,w:16,h:32,img:null,xd:0,yd:1,xa:0,ya:0,maxa:5,jf:7,jh:50,js:0,j:0,ju:0,ht:0,mj:1,a:0,"ῼ":5,dc:t.performance.now(),"mῼ":5,keys:[]},rn=$e-_e,on=[nn],ln={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192},p("keydown",W),p("keyup",T),p("resize",k),p("DOMContentLoaded",b),p("frame",S),p("frame",$),p("mousemove",A),p("mousedown",O),p("mouseup",I),p("contextmenu",N),t.addEventListener("resize",w),e.addEventListener("DOMContentLoaded",w),e.addEventListener("mousedown",w),e.addEventListener("mouseup",w),e.addEventListener("keydown",w),e.addEventListener("keyup",w),e.addEventListener("frame",w),e.addEventListener("mousemove",w),e.addEventListener("contextmenu",w),an=0,hn=0,dn=0,fn=[],yn=t.performance.now(),un=!1,sn=!1,xn=150,cn=[0,0,0,0,0],mn=-1,gn=-1,pn=0,wn=0,vn=0,bn=0,kn=wn,Sn=wn,Pn=[],Mn=[],Fn=0;100>Fn;Fn++)Mn[Fn]=0;for(jn="1111111111111111111100000000000000000000000000000000000000000000000000000000000011111111111111111111,1100000011111000001111110000111100000011110000001111000000111100000111110000111111000000111100000011,1000000001110000001111100001110001001000000000000000000000000000000000000111100011111111111111111111,1111111111111000011100000000000000000000000011000000011110000000000000000000000011000000111100000111,1111000011110000001111000000111100000011110001111111000000001100000000110000000011111111111111111111,1111111111100000000010000000001000000000100000000010000000001000000000100000000010000011111000000011,1111111111000000000100000000010000000001000000000100000000010000000001000000000110000000011100000001,1111000011110000001111000000111100000011110001111100000111110000111111000011111111111111111111111111,1110000011110000000100000000000000000000000011000000001100000000000000000000000011000000111100000111,1100000011111000001100110000110000000011000000001100000000110000000111000000111111000000111100000011,1100000011111000001111110000001100000000110000000011000000001100000111110000111111000000111100000011".split(","),Pn.push({map:Mn,type:0}),Fn=0;Fn<jn.length;Fn++)Pn.push(G(Fn+1,jn[Fn]));En=null,Cn=0,Wn=0,Tn=0,An=0,On=null,In=!1,Rn=e.createElement("canvas"),Nn=Rn.getContext("2d"),Bn=0,Ln=1,Dn=0,Hn=0,zn=0,Xn=0,Yn=null,qn=null,Un=.2,Gn=0,Jn=[{bg:"#BBBBBB",bd:"#A0A0A0",o:"#CFCFCF",l:"#FFFFFF",name:"Dungeon"},{bg:"#FF3333",bd:"#990000",o:"#FF0000",l:"#FFAAAA",name:"Fire"},{bg:"#00BB00",bd:"#006600",o:"#00BB00",l:"#AAFFAA",name:"Air"},{bg:"#3333FF",bd:"#000066",o:"#0000FF",l:"#AAAAFF",name:"Water"},{bg:"#9F9F9F",bd:"#555555",o:"#555555",l:"#000000",name:"Earth"}]}(window,document);