function o(){j(),Er.fillStyle=Be.c.bd,Er.fillRect(0,0,Wr.width,Wr.height),Er.fillStyle=Be.c.bg,Er.clearRect(0-We,0-Xe,ne,te);var o=g(We)-1,n=g(Xe)-1,a=g(We)+g(Yr.width)+2,i=g(Xe)+g(Yr.height)+2;0>o&&(o=0),0>n&&(n=0),a>ee&&(a=ee),i>ee&&(i=ee);for(var l=n;i>l;l++){var s,d=0,m=16*-ee*2,u=0;Er.fillStyle=Be.c.bg;for(var c=o;a>c;c++)0!==Pe[C(c,l,ee)]&&(d+=16,m===16*-ee*2&&(m=16*c-We),s=0>l-1?-1:Pe[C(c,l-1,ee)],0===s&&(u=1)),(0===Pe[C(c,l,ee)]||c===a-1)&&r(c,l,Pe,ee,m,d,u),(0===Pe[C(c,l,ee)]||c===a-1)&&(d=0,m=16*-ee*2,u=0)}for(var l=n;i>l;l++)for(var c=o;a>c;c++)Pe[C(c,l,ee)]>1&&(Er.fillStyle=Oe[Pe[C(c,l,ee)]-1].bg,r(c,l,Pe,ee,16*c-We,16,!0));e(o,n,a,i,1),e(o,n,a,i,4),t(o,n,a,i,2),t(o,n,a,i,8)}function r(o,r,e,t,n,a,i){var l=n,s=16*r-Xe;1===i?Er.fillRect(l,s-5,a,21):Er.fillRect(l,s,a,16)}function e(o,r,e,t,a){for(var i=o;e>i;i++)for(var l=0,s=16*-ee*2,d=0,m=0,u=r;t>u;u++){var c=Pe[C(i+1,u-1,ee)],p=Pe[C(i,u-1,ee)],y=Pe[C(i-1,u-1,ee)];if(1===a?(m=Pe[C(i-1,u,ee)],0>i-1&&(m=-1)):4===a&&(m=Pe[C(i+1,u,ee)],i+1>ee-1&&(m=-1)),0!==Pe[C(i,u,ee)]&&1>m&&(l+=16,s===16*-ee*2&&(0===p&&(d=1),s=16*u-Xe)),0===Pe[C(i,u,ee)]||u===t-1||m>0){Vr.beginPath();var h=s,x=16*i-We,w=h+l,f=16*(i+1)-We,v=x;4===a&&(v=f),d&&(h-=5),(4===a&&0===c||1===a&&0===y)&&m>0?n(v,h,v,w+3):n(v,h,v,w),Vr.closePath(),Vr.stroke()}(0===Pe[C(i,u,ee)]||u===t-1||m>0)&&(l=0,s=16*-ee*2,d=0)}}function t(o,r,e,t,a){for(var i=r;t>i;i++)for(var l=0,s=16*-ee*2,d=0,m=0,u=o;e>u;u++){if(2===a?0>i-1?m=-1:(m=Pe[C(u,i-1,ee)],d=1):8===a&&(m=Pe[C(u,i+1,ee)],i+1>ee-1&&(m=-1)),0!==Pe[C(u,i,ee)]&&1>m&&(l+=16,s===16*-ee*2&&(s=16*u-We)),0===Pe[C(u,i,ee)]||u===e-1||m>0){Vr.beginPath();var c=s,p=16*i-Xe,y=c+l,h=16*(i+1)-Xe;2===a?1===d?(n(c,p-5,y,p-5),n(c,p+3,y,p+3)):n(c,p,y,p):8===a&&n(c,h,y,h),Vr.closePath(),Vr.stroke()}(0===Pe[C(u,i,ee)]||u===e-1||m>0)&&(l=0,s=16*-ee*2,d=0)}}function n(o,r,e,t){Vr.moveTo(o,r),Vr.lineTo(e,t)}function a(){if(A(),Pr=16*Be.x+16*g(g(g($r.x),10),1)-Ie,Tr=16*Be.y+16*g(g(g($r.y),10),1)-Ee,Pr!==Mr||Tr!==Rr){jr.width=150,jr.height=150,Br.clearRect(0,0,jr.width,jr.height),Fr.length=0,Br.lineWidth=2,Br.fillStyle="#000";for(var o=0;o<Ve.r.length;o++)for(var r=0;r<Ve.r[o].rooms.length;r++)room=Ve.r[o].rooms[r],roomX=16*room.x-Ie,roomY=16*room.y-Ee,roomX+16*room.w>0&&roomY+16*room.h>0&&roomX<jr.width&&roomY<jr.height&&(Br.beginPath(),Br.rect(roomX,roomY,16*room.w,16*room.h),Br.fill(),Br.closePath());i("bg","bd",function(o,r,e){o.v&&(Br.beginPath(),Br.rect(r,e,16*o.w,16*o.h),Br.fill(),Br.stroke(),Br.closePath())}),i(0,"bg",d),i(0,0,l)}u(),Mr=Pr,Rr=Tr,kr=Ve.rooms.length}function i(o,r,e){for(var t=0;t<Ve.r.length;t++){"string"==typeof o&&(Br.fillStyle=Ve.r[t].color[o]),"string"==typeof r&&(Br.strokeStyle=Ve.r[t].color[r]);for(var n=0;n<Ve.r[t].rooms.length;n++)room=Ve.r[t].rooms[n],roomX=16*room.x-Ie,roomY=16*room.y-Ee,roomX+16*room.w>0&&roomY+16*room.h>0&&roomX<jr.width&&roomY<jr.height&&e(room,roomX,roomY)}}function l(o){if(o.v){for(var r=null,e=0;e<o.d.length;e++){r=o.d[e];var t=Oe[r.dt].l;if(r.dt>0)switch(r.dir){case"N":s(16*r.x+5,16*r.y,t);continue;case"S":s(16*r.x+5,16*r.y+16,t);continue;case"W":s(16*r.x-3,16*r.y+8,t);continue;case"E":s(16*r.x+13,16*r.y+8,t);continue;default:continue}}var t=Oe[o.s].l;o.s>0&&s(16*(o.x+o.w/2)-3,16*(o.y+o.h/2),"rgba(0,0,0,0)",t)}}function s(o,r,e,t){var n=3;Br.beginPath(),Br.arc(o+n-Ie,r-Ee,n,0,2*Math.PI,!1),Br.fillStyle=e,Br.fill(),t&&(Br.lineWidth=2,Br.strokeStyle=t,Br.stroke()),Br.closePath()}function d(o){if(o.v)for(var r=null,e=0;e<o.d.length;e++){r=o.d[e];var t=o.x+"-"+o.y+"-"+r.r2.x+"-"+r.r2.y,n=r.r2.x+"-"+r.r2.y+"-"+o.x+"-"+o.y;if(-1===Fr.indexOf(n)&&-1===Fr.indexOf(t)){var a=16*r.x,i=16*r.y;"N"===r.dir&&m(a+4,i,a+16-4,i),"S"===r.dir&&m(a+4,16*(r.y+1),a+16-4,16*(r.y+1)),"W"===r.dir&&m(a,i+4,a,i+16-4),"E"===r.dir&&m(16*(r.x+1),i+4,16*(r.x+1),i+16-4),Fr.push(t)}}}function m(o,r,e,t){Br.beginPath(),Br.moveTo(o-Ie,r-Ee),Br.lineTo(e-Ie,t-Ee),Br.stroke(),Br.closePath()}function u(){Dr||(Or.width=jr.width,Or.height=jr.height,Ar.lineWidth=1,Dr=!0),Ir.fillStyle="#000000";for(var o=0;o<oe.length;o++){var r=oe[o],e=(15-15*($r.ῼ/$r.mῼ)).toString(16);Ir.fillStyle="#"+e+e+"0000",Ir.fillRect(r.x-We,r.y-Xe,r.w,r.h)}Ar.clearRect(0,0,Or.width,Or.height),Lr+=2*(_r/1e3),Lr%=2;var t=1;Lr>1&&(t=0),Sr!==t&&(Ar.fillStyle="rgba(200,200,255,"+.6*t+")",Ar.strokeStyle="rgba(200,200,255,"+.8*t+")"),Ar.beginPath(),Ar.rect(Pr,Tr,16,16),Ar.fill(),Ar.stroke(),Ar.closePath(),Sr=t}function c(o,r){Qr[o]||(Qr[o]=[]),Qr[o].push(r)}function p(o){var r=o.type;if(Qr[r]&&Qr[r].length>0)for(var e=0;e<Qr[r].length;e++)Qr[r][e](o)}function y(o){return document.getElementById(o)}function h(){Yr=y("p"),Xr=y("b"),Wr=y("t"),jr=y("m"),Or=y("i"),Ir=Yr.getContext("2d"),Vr=Xr.getContext("2d"),Er=Wr.getContext("2d"),Br=jr.getContext("2d"),Ar=Or.getContext("2d"),x(),wr();for(var o=0;o<Oe.length;o++){for(var r=v(10,20),e=0;r>e;e++)fr();o+1<Oe.length&&vr()}gr();var t=Ve.rooms[0].d[0],n=t.dir,a=t.x;("E"===t.dir||"W"===t.dir)&&(a=t.y),B(Ve.rooms[0],n,a),f()}function x(){Xr.width=Yr.width=Wr.width=window.innerWidth>300?300:window.innerWidth,Xr.height=Yr.height=Wr.height=window.innerHeight>300?300:window.innerHeight}function w(){if(Kr){for(var r=0;r<oe.length;r++){var e=oe[r];k(e),e.x=R(e.x),e.y=R(e.y),D(e),L(e),b(e),E(),F(e)}Vr.strokeStyle=Be.c.bd,Vr.lineWidth=2,Ir.clearRect(0,0,Yr.width,Yr.height),Vr.clearRect(0,0,Xr.width,Xr.height),o(),a()}}function f(){qr=window.performance.now(),_r=qr-Ur,Ur=qr,document.dispatchEvent(Jr),Gr&&requestAnimationFrame(f)}function v(o,r){return Math.floor(Math.random()*(r-o+1)+o)}function g(o,r){var e=o%(r||16);return(o-e)/(r||16)}function C(o,r,e){return r*e+o}function M(o,r){if("object"==typeof r){for(var e=0;e<o.length;e++){var t=!0;if("object"==typeof o[e]){for(var n in r)if(o[e][n]!==r[n]){t=!1;break}if(t===!0)return e}}return-1}return o.indexOf(r)}function R(o){return~~(.5+o)}function P(o){for(var r in re)re[r]===o.keyCode&&o.preventDefault();Zr[o.keyCode]!==o.type&&o.keyCode===re.space&&($r.j=1),Zr[o.keyCode]=o.type,o.keyCode===re.d?$r.xd=1:o.keyCode===re.a&&($r.xd=-1)}function T(o){for(var r in re)re[r]===o.keyCode&&o.preventDefault();Zr[o.keyCode]!==o.type&&o.keyCode===re.space&&($r.j=0),Zr[o.keyCode]=o.type,(o.keyCode===re.d||o.keyCode===re.a)&&(Zr[re.d]&&Zr[re.a]?Zr[re.d]===o.type&&Zr[re.a]===o.type&&($r.xd=0):$r.xd=0)}function k(o){o.xa=o.xa+o.xd/60*_r,o.xa>o.maxa&&(o.xa=o.maxa),o.xa<-o.maxa&&(o.xa=-o.maxa),0===o.xd&&(o.xa>0?o.xa=o.xa+-2/60*_r:o.xa<0&&(o.xa=o.xa+2/60*_r),(o.xa<1/60*_r&&o.xa>-1/60*_r||1===o.yd||-1===o.yd)&&(o.xa=0)),o.x=o.x+o.xa}function b(o){o.j&&-1!==o.yd&&o.ju<o.mj&&(o.mj>1&&0===o.ju&&1===o.yd&&o.ju++,(0===o.ju&&0===o.yd||o.ju>0||o.mj>1)&&(o.yd=-1,o.ya=-o.jf,o.js=o.y,o.ju++),o.ht=0),(0===o.yd||!o.j||o.ht>o.jh)&&(o.yd=1),1===o.yd&&(o.j=0,o.ya=o.ya+o.jf/2/60*_r),0===o.yd&&(o.ya>0?o.ya=o.ya+-1/60*_r:o.ya<0&&(o.ya=o.ya+1/60*_r),o.ya<1/60*_r&&o.ya>-1/60*_r&&(o.ya=0)),o.ya>o.maxa&&(o.ya=10),o.ht-=o.ya,o.ht=R(o.ht),o.y=o.y+o.ya}function F(o){var r=o.x%16,e=C(g(o.x),g(o.y+o.h),ee),t=C(g(o.x+o.w),g(o.y+o.h),ee),n=!1;n=0===r?Pe[e]:0!==Pe[t]||0!==Pe[e],(n||o.y+o.h>16*ie)&&1===o.yd&&(o.y=16*g(o.y),o.ya=0,o.yd=0,o.ju=0,o.j=0,o.ht=0)}function L(o){var r=o.x%16,e=C(g(o.x),g(o.y-o.h/2),ee),t=C(g(o.x+o.w),g(o.y-o.h/2),ee),n=!1;n=0===r?0!==Pe[e]:0!==Pe[e]||0!==Pe[t],n&&1===o.j&&(o.y=16*g(o.y),o.ya=-1,o.yd=1,o.j=0,o.ht=0)}function D(o){var r=o.y%16,e=o.x%16,t=C(g(o.x),g(o.y-o.h/2),ee),n=C(g(o.x+o.w),g(o.y-o.h/2),ee),a=C(g(o.x),g(o.y),ee),i=C(g(o.x+o.w),g(o.y),ee),l=C(g(o.x),g(o.y+o.h/2),ee),s=C(g(o.x+o.w),g(o.y+o.h/2),ee),d=C(g(o.x),g(o.y+o.h),ee),m=C(g(o.x+o.w),g(o.y+o.h),ee),u=!1,c=!1;0===r?(u=0!==Pe[l]||0!==Pe[a],c=0!==Pe[s]||0!==Pe[i]):16*g(o.y+o.h)>o.y+o.h?(u=0!==Pe[l]||0!==Pe[a]||0!==Pe[t],c=0!==Pe[s]||0!==Pe[i]||0!==Pe[n]):(u=0!==Pe[l]||0!==Pe[a]||0!==Pe[d],c=0!==Pe[s]||0!==Pe[i]||0!==Pe[m]),0===e?(c||o.x+o.w>16*ae||o.x<0)&&o.xa>0&&(o.x=16*g(o.x),o.xa=0):(c||o.x+o.w>16*ae||o.x<0)&&o.xa>0?(o.x=16*g(o.x),o.xa=0):(u||o.x+o.w>16*ae||o.x<0)&&o.xa<0&&(o.x=16*g(o.x+o.w),o.xa=0)}function S(o,r){r=r.split("");for(var e=0;e<r.length;e++)r[e]=parseInt(r[e]);return{map:r,type:o}}function Y(o){return{map:o.map.slice(0),type:o.type}}function W(o,r,e,t){for(var n=[],a=[],i=Math.max(o,r),l=0;i*i>l;l++)n[l]=0;n=t(n,o,r,i);for(var s,d,m,u,c,p={},y=0;10*i>y;y++)for(var h=0;10*i>h;h++){var x=Math.floor(h/10),w=Math.floor(y/10);d=rr(e,x,w,"N"),m=rr(e,x,w,"E"),u=rr(e,x,w,"S"),c=rr(e,x,w,"W");var f=C(x,w,i),v=x+"-"+w;(h%10===0||y%10===0)&&(p[v]||(s=Y(le[n[f]]),p[v]=s),s=p[v]);var g=C(h,y,10*i),M=C(h%10,y%10,10);a[g]=s.map[M],0===y&&null===d&&10*o>h&&(a[g]=1),0===h&&null===c&&10*r>y&&(a[g]=1),y===10*r-1&&null===u&&10*o>h&&(a[g]=1),h===10*o-1&&null===m&&10*r>y&&(a[g]=1),0===y&&null!==d&&10*o>h&&d.dt>0&&0===a[g]&&(a[g]=d.dt+1),0===h&&null!==c&&10*r>y&&c.dt>0&&0===a[g]&&(a[g]=c.dt+1),y===10*r-1&&null!==u&&10*o>h&&u.dt>0&&0===a[g]&&(a[g]=u.dt+1),h===10*o-1&&null!==m&&10*r>y&&m.dt>0&&0===a[g]&&(a[g]=m.dt+1)}return{map:a,width:o,height:r,size:i,tiles:10*i}}function X(o){o.map=W(1*o.w,1*o.h,o,function(o,r,e,t){for(var n=0,a=0,i=0;t*t>i;i++)o[C(n,a,t)]=9,n++,n>r-1&&(n=0,a++),a>e-1&&(i=t*t);return o})}function I(o,r,e){for(var t=0;t<o.d.length;t++){var n=!1,a=o.d[t];if(a.dir===r&&(("N"===a.dir||"S"===a.dir)&&(n=e===a.x),("E"===a.dir||"W"===a.dir)&&(n=e===a.y),n)){var i=1*(a.x-o.x),l=1*(a.y-o.y);-1===$r.y&&($r.y=10*l*16+80),-1===$r.x&&($r.x=10*i*16+80),"N"===a.dir&&(i+=Math.floor(.5),$r.y=0,$r.x=$r.x%160+10*i*16),"E"===a.dir&&(l+=Math.floor(.5),i+=1,$r.x=10*o.w*16*1-$r.w,$r.y=$r.y%160+10*l*16),"S"===a.dir&&(i+=Math.floor(.5),l+=1,$r.y=10*o.h*16*1-$r.h,$r.x=$r.x%160+10*i*16),"W"===a.dir&&(l+=Math.floor(.5),$r.x=0,$r.y=$r.y%160+10*l*16)}}}function E(){for(var o=0;o<Be.d.length;o++){var r=Be.d[o],e=1*(r.x-Be.x),t=1*(r.y-Be.y),n=g(g($r.x),10),a=g(g($r.x+$r.w),10),i=g(g($r.y),10),l=g(g($r.y+$r.h),10),s=10*Be.w*16*1,d=10*Be.h*16*1;"N"===r.dir&&(e+=Math.floor(.5)),"E"===r.dir&&(t+=Math.floor(.5),e+=1),"S"===r.dir&&(e+=Math.floor(.5),t+=1),"W"===r.dir&&(t+=Math.floor(.5)),window.performance.now()-$r.dc>400&&($r.x<=0&&-1===$r.xd&&"W"===r.dir&&e===n&&t===i&&B(r.r2,"E",r.y),$r.y<=0&&-1===$r.yd&&"N"===r.dir&&e===n&&t===i&&B(r.r2,"S",r.x),$r.x+$r.w>=s&&1===$r.xd&&"E"===r.dir&&e===a&&t===i&&B(r.r2,"W",r.y),$r.y+$r.h>=d&&0!==$r.yd&&Math.abs($r.ya)>5&&"S"===r.dir&&e===n&&(t===l||t===i)&&B(r.r2,"N",r.x))}}function V(){if(Fe){null===Be&&(Se=Ye);var r=Yr.width,e=Yr.height;if(Ye>Se){var t=r*Se/Ye;t=r-t;var n=e*Se/Ye;n=e-n}if(Se>=Ye){Be!==be&&(Vr.clearRect(0,0,r,e),Er.clearRect(0,0,r,e),Be=be,ur(be),Be.v=!0,ee=be.map.tiles,Pe=be.map.map,e=10*be.map.height,r=10*be.map.width,te=10*be.map.height*16,ne=10*be.map.width*16,I(be,Te,ke));var t=r*(Se-Ye)/Ye,n=e*(Se-Ye)/Ye}Le.width=r,Le.height=e,De.clearRect(0,0,r,e),a(),o(),De.drawImage(Wr,0,0),De.drawImage(Xr,0,0),De.drawImage(Yr,0,0),Ir.clearRect(0,0,r,e),Xr.style.display="none",Wr.style.display="none",De.globalCompositeOperation="destination-in";var i=$r.x+$r.w/2-We-t/2,l=$r.y+$r.h/2-Xe-n/2;De.beginPath(),De.rect(i,l,t,n),De.fillStyle="black",De.fill(),Ir.drawImage(Le,0,0),Se+=2*Ye*(_r/1e3),Se>2*Ye&&(Se=0,Kr=!0,be=null,Fe=!1,Xr.style.display="bl",Wr.style.display="bl",$r.dc=window.performance.now(),document.title=Be.c.name,history.pushState(null,null,"#"+document.title))}}function B(o,r,e){Te=r,ke=e,Fe=!0,be=o,Kr=!1,null===o.map&&X(o)}function j(){var o=Er.canvas,r=o.width/2,e=o.height/2;$r.x-We+r>o.width?We=$r.x-(o.width-r):$r.x-r<We&&(We=$r.x-r),$r.y-Xe+e>o.height?Xe=$r.y-(o.height-e):$r.y-e<Xe&&(Xe=$r.y-e),Xe=~~(.5+Xe),Xe=~~(.5+Xe)}function A(){var o=Br.canvas,r=o.width/2,e=o.height/2,t=16*(Be.x+g(g(g($r.x),10),1)),n=16*(Be.y+g(g(g($r.y),10),1));t-Ie+r>o.width?Ie=t-(o.width-r):Ie>t-r&&(Ie=t-r),n-Ee+e>o.height?Ee=n-(o.height-e):Ee>n-e&&(Ee=n-e),Ee=~~(.5+Ee),Ee=~~(.5+Ee)}function O(o,r,e){Ve.f.length=0,Ve.f.push({x:o,y:r}),Ve.cr=e,Ve.r.push(e)}function N(o){for(var r=!0,e=z(),t=[];r;){var n=0,a=H(e);t.length=0,t.push(or(a.x-1,a.y),or(a.x+1,a.y),or(a.x,a.y-1),or(a.x,a.y+1));for(var i=0;4>i;i++)null===t[i]&&n++;n>2&&(r=!1)}O(a.x,a.y,o)}function H(o){var r=v(0,o.length-1);return o[r]}function z(){for(var o=[],r=0;r<Ve.rooms.length;r++)o=K(o,Ve.rooms[r]);return o}function K(o,r){for(var e=r.x;e<r.x+r.w;)G(e,r.y-1,1,1)&&o.push({x:e,y:r.y-1}),G(e,r.y+r.h,1,1)&&o.push({x:e,y:r.y+r.h}),e++;for(var t=r.x;t<r.y+r.h;)G(t,r.x-1,1,1)&&o.push({x:t,y:r.x-1}),G(t,r.x+r.w,1,1)&&o.push({x:t,y:r.x+r.w}),t++;return o}function G(o,r,e,t){return J(o,r,e,t)&&!q(o,r,e,t)}function J(o,r,e,t){return o>0&&r>0&&o+e<Ve.width&&r+t<Ve.height}function q(o,r,e,t){for(var n=null,a=0;a<Ve.rooms.length;){n=Ve.rooms[a];{if(!(n.x>o+e-1||n.x+n.w-1<o||n.y>r+t-1||n.y+n.h-1<r))return!0;a++}}return!1}function U(o){for(var r=0,e=null,t=!1,n=100;Ve.rooms.length>1&&!t;){r=0,r+=Q(o),r+=Z(o),r+=$(o),r+=_(o),1===o.r.rooms.length&&r>0&&(t=!0);for(var a=0;a<o.d.length;a++)e=o.d[a],pr(e,o).r===o.r&&(t=!0);n--,0===n&&(t=!0)}}function Q(o){for(var r=null,e=null,t=null,n=[],a=o.x;a<o.x+o.w;)e=or(a,o.y-1),null!==e&&n.push({x:a,y:o.y,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(s=!0);Math.random()>je||M(o.d,r)>=0||s||(t=sr(r.x,r.y,"N",o,r.o),o.d.push(t),r.o.d.push(sr(r.x,r.y-1,"S",r.o,o)),i++)}return i}function Z(o){for(var r=null,e=null,t=null,n=[],a=o.x;a<o.x+o.w;)e=or(a,o.y+o.h),null!==e&&n.push({x:a,y:o.y+o.h-1,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(s=!0);Math.random()>je||M(o.d,r)>=0||s||(t=sr(r.x,r.y,"S",o,r.o),o.d.push(t),r.o.d.push(sr(r.x,r.y+1,"N",r.o,o)),i++)}return i}function $(o){for(var r=null,e=null,t=null,n=[],a=o.y;a<o.y+o.h;)e=or(o.x-1,a),null!==e&&n.push({x:o.x,y:a,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(s=!0);Math.random()>je||M(o.d,r)>=0||s||(t=sr(r.x,r.y,"W",o,r.o),o.d.push(t),r.o.d.push(sr(r.x-1,r.y,"E",r.o,o)),i++)}return i}function _(o){for(var r=null,e=null,t=null,n=[],a=o.y;a<o.y+o.h;)e=or(o.x+o.w,a),null!==e&&n.push({x:o.x+o.w-1,y:a,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(s=!0);Math.random()>je||M(o.d,r)>=0||s||(t=sr(r.x,r.y,"E",o,r.o),o.d.push(t),r.o.d.push(sr(r.x+1,r.y,"W",r.o,o)),i++)}return i}function or(o,r){for(var e=null,t=0;t<Ve.rooms.length;){e=Ve.rooms[t];{if(!(e.x>o||e.x+e.w-1<o||e.y>r||e.y+e.h-1<r))return e;t++}}return null}function rr(o,r,e,t){for(var n=null,a=0;a<o.d.length;a++)if(n=o.d[a],n.dir===t&&n.x===o.x+r&&n.y===o.y+e)return n;return null}function er(o){for(var r=0,e=Ve.rooms.length;r++<10*o&&Ve.rooms.length<e+o;)tr()}function tr(){var o=H(Ve.f);try{nr(ir(o.x,o.y))}catch(r){console.log(Ve,o,r)}}function nr(o){if(null===o||!G(o.x,o.y,o.w,o.h))return!1;var r=[];r=ar(r,o),Ve.f=K(r,o),0===Ve.f.length&&console.log(r,o,K(r,o)),o.c=Ve.cr.color,Ve.rooms.push(o),Ve.cr.rooms.push(o),U(o)}function K(o,r){for(var e=r.x;e<r.x+r.w;)G(e,r.y-1,1,1)&&o.push({x:e,y:r.y-1}),G(e,r.y+r.h,1,1)&&o.push({x:e,y:r.y+r.h}),e++;for(var t=r.y;t<r.y+r.h;)G(r.x-1,t,1,1)&&o.push({x:r.x-1,y:t}),G(r.x+r.w,t,1,1)&&o.push({x:r.x+r.w,y:t}),t++;return o}function ar(o,r){for(var e=0;e<Ve.f.length;e++)Ve.f[e].x>=r.x-1&&Ve.f[e].x<=r.x+r.w&&Ve.f[e].y>=r.y&&Ve.f[e].y<=r.y+r.h-1||Ve.f[e].x>=r.x&&Ve.f[e].x<=r.x+r.w-1&&Ve.f[e].y>=r.y-1&&Ve.f[e].y<=r.y+r.h||o.push(Ve.f[e]);return o}function ir(o,r){for(var e=0,t=1,n=1;e++<25&&(t<Ve.cr.maxW||n<Ve.cr.maxH)&&Math.random()<.9;)switch(parseInt(4*Math.random())){case 0:n<Ve.cr.maxH&&G(o,r-1,t,n+1)&&(r--,n++);continue;case 1:n<Ve.cr.maxH&&G(o,r,t,n+1)&&n++;continue;case 2:t<Ve.cr.maxW&&G(o-1,r,t+1,n)&&(o--,t++);continue;case 3:t<Ve.cr.maxW&&G(o,r,t+1,n)&&t++;continue;default:continue}return lr(o,r,t,n,Ve.cr)}function lr(o,r,e,t,n){return{x:o,y:r,w:e,h:t,c:null,r:n,s:0,sx:0,sy:0,sr:!1,v:!1,d:[],map:null}}function sr(o,r,e,t,n){return{x:o,y:r,dt:0,dir:e,r1:t,r2:n}}function dr(){for(var o=null,r=null,e=0;e<Ve.rooms.length;e++){o=Ve.rooms[e],o.s=0;for(var t=0;t<o.d.length;t++)r=o.d[t],r.dt=0}}function mr(){for(var o=null,r=null,e=null,t=null,n=0;n<Ve.r.length;n++){r=Ve.r[n],H(r.rooms).s=(n+1)%Oe.length;for(var a=0;a<r.rooms.length;a++){t=r.rooms[a];for(var i=0;i<t.d.length;i++)o=t.d[i],e=pr(o,t).r,e!==r&&0===o.dt&&(o.dt=(n+1)%Oe.length)}}}function ur(o){-1===$r.keys.indexOf(o.s)&&($r.keys.push(o.s),cr())}function cr(){for(var o=0;o<Ve.rooms.length;o++){var r=!1,e=Ve.rooms[o];$r.keys.indexOf(e.s)>-1&&(e.s=0);for(var t=0;t<e.d.length;t++){var n=e.d[t];$r.keys.indexOf(n.dt)>-1&&(n.dt=0,r=!0)}if(r&&null!==e.map)for(var a=0;a<e.map.map.length;a++)e.map.map[a]>1&&$r.keys.indexOf(e.map.map[a]-1)&&(e.map.map[a]=0)}}function pr(o,r){return o.r1===r?o.r2:o.r1}function yr(){Ve={width:0,height:0,rooms:[],f:[],r:[],cr:0},crColorIndex=0,Ve.width=80,Ve.height=48,O(40,24,hr()),er(1)}function hr(){var o=xr(Oe[crColorIndex],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1);return crColorIndex=(crColorIndex+1)%Oe.length,o}function xr(o,r,e){return{color:o,maxW:r,maxH:e,rooms:[]}}function wr(){yr()}function fr(){tr()}function vr(){N(hr())}function gr(){dr(),mr()}var Cr=0,Mr=0,Rr=0,Pr=0,Tr=0,kr=0,br=[],Fr=[],Lr=0,Dr=!1,Sr=0,Yr,Wr,Xr,Ir,Er,Vr,Br,jr,Ar,Or,Nr=0,Hr=1,zr=2,Kr=!0,Gr=!0,Jr=new CustomEvent("frame"),qr=window.performance.now(),Ur=window.performance.now(),Qr={},Zr={},$r={x:-1,y:-1,w:16,h:32,img:null,xd:0,yd:1,xa:0,ya:0,maxa:5,jf:7,jh:50,js:0,j:0,ju:0,ht:0,mj:1,a:0,"ῼ":5,dc:window.performance.now(),"mῼ":5,keys:[]},_r=qr-Ur,oe=[$r],re={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};c("keydown",P),c("keyup",T),c("resize",x),c("DOMContentLoaded",h),c("frame",w),c("frame",V),window.addEventListener("resize",p),document.addEventListener("DOMContentLoaded",p),document.addEventListener("mousedown",p),document.addEventListener("mouseup",p),document.addEventListener("keydown",p),document.addEventListener("keyup",p),document.addEventListener("frame",p);for(var ee=0,te=0,ne=0,ae=ee,ie=ee,le=[],se=[],de=[],me=0;100>me;me++)de[me]=0;var ue="1111111111111111111111111111110000000000000000000000000000001111111111111111111111111111111111111111",ce="1110001111111000111111100011111110001111111000111111100011111110001111111000111111100011111110001111",pe="1000000001110000001111100001110001001000000000000000000000000000000000000111100011111111111111111111",ye="1111111111111000011100000000000000000000000011000000011110000000000000000000000011000000111100000111",he="1100000011110000001111000001111110000001111000000011110000001111100000111111000011111111111111111111",xe="1111111111100000000110000000001100000000110001100011100011101110000011111100000111110000011111100001",we="1111111111100000000100000000010000000011000110001100110001110110000111010000111111000011111000011111",fe="1100000011110000001111100000111000000111000000011100000011110000011111000011111111111111111111111111",ve="1110000011110000000100000000000000000000000011000000001100000000000000000000000011000000111100000111",ge="1111111111111000000011100000001220000000122000000012200000001111100000111110000011111000001111111111",Ce="1111111111000000111100000011110000002211000000221100000022110000111111000011111100001111111111111111",Me="1110000111100000000110000000011000110001100111100110000000011000000001100000000111122221111112222111",Re="1112222111111222211110000000011000000001100000000110011110011000000001100000000110000000011100000111";le.push({map:de,type:0}),le.push(S(1,ue)),le.push(S(2,ce)),le.push(S(3,pe)),le.push(S(4,ye)),le.push(S(5,he)),le.push(S(6,xe)),le.push(S(7,we)),le.push(S(8,fe)),le.push(S(9,ve)),le.push(S(10,ge)),le.push(S(11,Ce)),le.push(S(12,Me)),le.push(S(13,Re));var Pe=null,ae=0,ie=0,Te=0,ke=0,be=null,Fe=!1,Le=document.createElement("canvas"),De=Le.getContext("2d");document.body.appendChild(Le),Le.style.right="initial",Le.style.bd="1px solid black";var Se=0,Ye=1,We=0,Xe=0,Ie=0,Ee=0,Ve=null,Be=null,je=.2,Ae=0,Oe=[{bg:"#BBBBBB",bd:"#A0A0A0",o:"#CFCFCF",l:"#FFFFFF",name:"Dungeon"},{bd:"#990000",bg:"#FF3333",o:"#FF0000",l:"#FF0000",name:"Fire"},{bd:"#006600",bg:"#00BB00",o:"#00BB00",l:"#00FF00",name:"Air"},{bd:"#000066",bg:"#3333FF",o:"#0000FF",l:"#0000FF",name:"Water"},{bg:"#9F9F9F",bd:"#555555",o:"#555555",l:"#000000",name:"Earth"}];