function o(){var o=window.performance.now(),n=x(Te)-1,a=x(Ye)-1,i=x(Te)+x(br.width)+2,l=x(Ye)+x(br.height)+2;0>n&&(n=0),0>a&&(a=0),i>oe&&(i=oe),l>oe&&(l=oe);for(var s=a;l>s;s++)for(var m,c=0,u=16*-oe*2,p=0,d=n;i>d;d++)0!==Me[C(d,s,oe)]&&(c+=16,u===16*-oe*2&&(u=16*d-Te),m=0>s-1?-1:Me[C(d,s-1,oe)],0===m&&(p=1)),(0===Me[C(d,s,oe)]||d===i-1)&&r(d,s,Me,oe,u,c,p),(0===Me[C(d,s,oe)]||d===i-1)&&(c=0,u=16*-oe*2,p=0);e(n,a,i,l,1),e(n,a,i,l,4),t(n,a,i,l,2),t(n,a,i,l,8);var h=window.performance.now()-o;h>vr&&(vr=h)}function r(o,r,e,t,n,a,i){var l=n,s=16*r-Ye;1===i?Sr.fillRect(l,s-5,a,21):Sr.fillRect(l,s,a,16)}function e(o,r,e,t,a){for(var i=o;e>i;i++)for(var l=0,s=16*-oe*2,m=0,c=0,u=r;t>u;u++){var p=Me[C(i+1,u-1,oe)],d=Me[C(i,u-1,oe)],h=Me[C(i-1,u-1,oe)];if(1===a?(c=Me[C(i-1,u,oe)],0>i-1&&(c=-1)):4===a&&(c=Me[C(i+1,u,oe)],i+1>oe-1&&(c=-1)),0!==Me[C(i,u,oe)]&&1>c&&(l+=16,s===16*-oe*2&&(0===d&&(m=1),s=16*u-Ye)),0===Me[C(i,u,oe)]||u===t-1||c>0){Fr.beginPath();var y=s,f=16*i-Te,g=y+l,w=16*(i+1)-Te,v=f;4===a&&(v=w),m&&(y-=5),(4===a&&0===p||1===a&&0===h)&&c>0?n(v,y,v,g+3):n(v,y,v,g),Fr.closePath(),Fr.stroke()}(0===Me[C(i,u,oe)]||u===t-1||c>0)&&(l=0,s=16*-oe*2,m=0)}}function t(o,r,e,t,a){for(var i=r;t>i;i++)for(var l=0,s=16*-oe*2,m=0,c=0,u=o;e>u;u++){if(2===a?0>i-1?c=-1:(c=Me[C(u,i-1,oe)],m=1):8===a&&(c=Me[C(u,i+1,oe)],i+1>oe-1&&(c=-1)),0!==Me[C(u,i,oe)]&&1>c&&(l+=16,s===16*-oe*2&&(s=16*u-Te)),0===Me[C(u,i,oe)]||u===e-1||c>0){Fr.beginPath();var p=s,d=16*i-Ye,h=p+l,y=16*(i+1)-Ye;2===a?1===m?(n(p,d-5,h,d-5),n(p,d+3,h,d+3)):n(p,d,h,d):8===a&&n(p,y,h,y),Fr.closePath(),Fr.stroke()}(0===Me[C(u,i,oe)]||u===e-1||c>0)&&(l=0,s=16*-oe*2,m=0)}}function n(o,r,e,t){Fr.moveTo(o,r),Fr.lineTo(e,t)}function a(){B(),Mr=16*ke.mapX+16*x(x(x(qr.x),10),3)-Xe,Rr=16*ke.mapY+16*x(x(x(qr.y),10),3)-Ae,(ke.mapX+x(x(x(qr.x),10),3)!==xr||ke.mapY+x(x(x(qr.y),10),3)!==Cr||Pr!==De.rooms.length)&&(Ir.width=150,Ir.height=150,Hr.clearRect(0,0,Ir.width,Ir.height),Yr.length=0,Hr.lineWidth=2,i("background","border",function(o,r,e){Hr.beginPath(),Hr.rect(r,e,16*o.mapW,16*o.mapH),Hr.fill(),Hr.stroke(),Hr.closePath()}),i(0,"background",m),i(0,0,l)),u(),xr=ke.mapX+x(x(x(qr.x),10),3),Cr=ke.mapY+x(x(x(qr.y),10),3),Pr=De.rooms.length}function i(o,r,e){for(var t=0;t<De.regions.length;t++){"string"==typeof o&&(Hr.fillStyle=De.regions[t].color[o]),"string"==typeof r&&(Hr.strokeStyle=De.regions[t].color[r]);for(var n=0;n<De.regions[t].rooms.length;n++)room=De.regions[t].rooms[n],roomX=16*room.mapX-Xe,roomY=16*room.mapY-Ae,roomX+16*room.mapW>0&&roomY+16*room.mapH>0&&roomX<Ir.width&&roomY<Ir.height&&e(room,roomX,roomY)}}function l(o){for(var r=null,e=0;e<o.doors.length;e++){r=o.doors[e];var t=We[r.doorType].lock;if(r.doorType>0)switch(r.dir){case"N":s(16*r.mapX+5,16*r.mapY,t);continue;case"S":s(16*r.mapX+5,16*r.mapY+16,t);continue;case"W":s(16*r.mapX-3,16*r.mapY+8,t);continue;case"E":s(16*r.mapX+13,16*r.mapY+8,t);continue;default:continue}}var t=We[o.specialType].lock;o.specialType>0&&s(16*(o.mapX+o.mapW/2)-3,16*(o.mapY+o.mapH/2),"rgba(0,0,0,0)",t)}function s(o,r,e,t){var n=3;Hr.beginPath(),Hr.arc(o+n-Xe,r-Ae,n,0,2*Math.PI,!1),Hr.fillStyle=e,Hr.fill(),t&&(Hr.lineWidth=2,Hr.strokeStyle=t,Hr.stroke()),Hr.closePath()}function m(o){for(var r=null,e=0;e<o.doors.length;e++){r=o.doors[e];var t=o.mapX+"-"+o.mapY+"-"+r.room2.mapX+"-"+r.room2.mapY,n=r.room2.mapX+"-"+r.room2.mapY+"-"+o.mapX+"-"+o.mapY;if(-1===Yr.indexOf(n)&&-1===Yr.indexOf(t)){var a=16*r.mapX,i=16*r.mapY;"N"===r.dir&&c(a+4,i,a+16-4,i),"S"===r.dir&&c(a+4,16*(r.mapY+1),a+16-4,16*(r.mapY+1)),"W"===r.dir&&c(a,i+4,a,i+16-4),"E"===r.dir&&c(16*(r.mapX+1),i+4,16*(r.mapX+1),i+16-4),Yr.push(t)}}}function c(o,r,e,t){Hr.beginPath(),Hr.moveTo(o-Xe,r-Ae),Hr.lineTo(e-Xe,t-Ae),Hr.stroke(),Hr.closePath()}function u(){Ar||(Br.width=150,Br.height=150,Vr.lineWidth=1,Ar=!0),Vr.clearRect(0,0,Br.width,Br.height),Xr+=2*(Kr/1e3),Xr%=2;var o=1;Xr>1&&(o=0),Dr!==o&&(Vr.fillStyle="rgba(200,200,255,"+.6*o+")",Vr.strokeStyle="rgba(200,200,255,"+.8*o+")"),Vr.beginPath(),Vr.rect(Mr,Rr,16,16),Vr.fill(),Vr.stroke(),Vr.closePath(),Dr=o}function p(o,r){Qr[o]||(Qr[o]=[]),Qr[o].push(r)}function d(o){var r=o.type;if(Qr[r]&&Qr[r].length>0)for(var e=0;e<Qr[r].length;e++)Qr[r][e](o)}function h(o){return document.getElementById(o)}function y(){br=h("player"),Wr=h("border"),Lr=h("tile"),Ir=h("minimap"),Br=h("minimapIcons"),Er=br.getContext("2d"),Fr=Wr.getContext("2d"),Sr=Lr.getContext("2d"),Hr=Ir.getContext("2d"),Vr=Br.getContext("2d"),f(),yr();for(var o=0;o<We.length;o++){for(var r=v(10,20),e=0;r>e;e++)fr();gr()}wr(),w()}function f(){Wr.width=br.width=Lr.width=window.innerWidth>300?300:window.innerWidth,Wr.height=br.height=Lr.height=window.innerHeight>300?300:window.innerHeight}function g(){for(var r=0;r<Zr.length;r++){var e=Zr[r];Y(e),e.x=R(e.x),e.y=R(e.y),k(e),D(e),X(e),H(),A(e)}V(),Fr.strokeStyle=ke.mapColor.border,Fr.lineWidth=2,Er.clearRect(0,0,br.width,br.height),Fr.clearRect(0,0,Wr.width,Wr.height),Sr.fillStyle=ke.mapColor.border,Sr.fillRect(0,0,Lr.width,Lr.height),Sr.fillStyle=ke.mapColor.background,Sr.clearRect(0-Te,0-Ye,ee,re),o(),a(),Er.fillStyle="#000000";for(var r=0;r<Zr.length;r++){var e=Zr[r],t=(15-15*(qr.health/qr.maxHealth)).toString(16);Er.fillStyle="#"+t+t+"0000",Er.fillRect(e.x-Te,e.y-Ye,e.w,e.h)}}function w(){Ur=window.performance.now(),Kr=Ur-Jr,Jr=Ur,document.dispatchEvent(zr),_r&&requestAnimationFrame(w)}function v(o,r){return Math.floor(Math.random()*(r-o+1)+o)}function x(o,r){var e=o%(r||16);return(o-e)/(r||16)}function C(o,r,e){return r*e+o}function M(o,r){if("object"==typeof r){for(var e=0;e<o.length;e++){var t=!0;if("object"==typeof o[e]){for(var n in r)if(o[e][n]!==r[n]){t=!1;break}if(t===!0)return e}}return-1}return o.indexOf(r)}function R(o){return~~(.5+o)}function P(o){for(var r in $r)$r[r]===o.keyCode&&o.preventDefault();Gr[o.keyCode]!==o.type&&o.keyCode===$r.space&&(qr.jumping=1),Gr[o.keyCode]=o.type,o.keyCode===$r.d?qr.xDirection=1:o.keyCode===$r.a&&(qr.xDirection=-1)}function T(o){for(var r in $r)$r[r]===o.keyCode&&o.preventDefault();Gr[o.keyCode]!==o.type&&o.keyCode===$r.space&&(qr.jumping=0),Gr[o.keyCode]=o.type,(o.keyCode===$r.d||o.keyCode===$r.a)&&(Gr[$r.d]&&Gr[$r.a]?Gr[$r.d]===o.type&&Gr[$r.a]===o.type&&(qr.xDirection=0):qr.xDirection=0)}function Y(o){o.xAccel=o.xAccel+o.xDirection/60*Kr,o.xAccel>o.maxAccel&&(o.xAccel=o.maxAccel),o.xAccel<-o.maxAccel&&(o.xAccel=-o.maxAccel),0===o.xDirection&&(o.xAccel>0?o.xAccel=o.xAccel+-2/60*Kr:o.xAccel<0&&(o.xAccel=o.xAccel+2/60*Kr),(o.xAccel<1/60*Kr&&o.xAccel>-1/60*Kr||1===o.yDirection||-1===o.yDirection)&&(o.xAccel=0)),o.x=o.x+o.xAccel}function X(o){o.jumping&&-1!==o.yDirection&&o.jumpsUsed<o.maxJumps&&(o.maxJumps>1&&0===o.jumpsUsed&&1===o.yDirection&&o.jumpsUsed++,(0===o.jumpsUsed&&0===o.yDirection||o.jumpsUsed>0||o.maxJumps>1)&&(o.yDirection=-1,o.yAccel=-o.jumpForce,o.jumpStart=o.y,o.jumpsUsed++),o.heightTraveled=0),(0===o.yDirection||!o.jumping||o.heightTraveled>o.jumpHeight)&&(o.yDirection=1),1===o.yDirection&&(o.jumping=0,o.yAccel=o.yAccel+o.jumpForce/2/60*Kr),0===o.yDirection&&(o.yAccel>0?o.yAccel=o.yAccel+-1/60*Kr:o.yAccel<0&&(o.yAccel=o.yAccel+1/60*Kr),o.yAccel<1/60*Kr&&o.yAccel>-1/60*Kr&&(o.yAccel=0)),o.yAccel>o.maxAccel&&(o.yAccel=10),o.heightTraveled-=o.yAccel,o.heightTraveled=R(o.heightTraveled),o.y=o.y+o.yAccel}function A(o){var r=o.x%16,e=C(x(o.x),x(o.y+o.h),oe),t=C(x(o.x+o.w),x(o.y+o.h),oe),n=!1;n=0===r?Me[e]:0!==Me[t]||0!==Me[e],(n||o.y+o.h>16*Pe)&&1===o.yDirection&&(o.y=16*x(o.y),o.yAccel=0,o.yDirection=0,o.jumpsUsed=0,o.jumping=0,o.heightTraveled=0)}function D(o){var r=o.x%16,e=C(x(o.x),x(o.y-o.h/2),oe),t=C(x(o.x+o.w),x(o.y-o.h/2),oe),n=!1;n=0===r?0!==Me[e]:0!==Me[e]||0!==Me[t],n&&1===o.jumping&&(o.y=16*x(o.y),o.yAccel=-1,o.yDirection=1,o.jumping=0,o.heightTraveled=0)}function k(o){var r=o.y%16,e=o.x%16,t=C(x(o.x),x(o.y-o.h/2),oe),n=C(x(o.x+o.w),x(o.y-o.h/2),oe),a=C(x(o.x),x(o.y),oe),i=C(x(o.x+o.w),x(o.y),oe),l=C(x(o.x),x(o.y+o.h/2),oe),s=C(x(o.x+o.w),x(o.y+o.h/2),oe),m=C(x(o.x),x(o.y+o.h),oe),c=C(x(o.x+o.w),x(o.y+o.h),oe),u=!1,p=!1;0===r?(u=0!==Me[l]||0!==Me[a],p=0!==Me[s]||0!==Me[i]):16*x(o.y+o.h)>o.y+o.h?(u=0!==Me[l]||0!==Me[a]||0!==Me[t],p=0!==Me[s]||0!==Me[i]||0!==Me[n]):(u=0!==Me[l]||0!==Me[a]||0!==Me[m],p=0!==Me[s]||0!==Me[i]||0!==Me[c]),0===e?(p||o.x+o.w>16*Re||o.x<0)&&o.xAccel>0&&(o.x=16*x(o.x),o.xAccel=0):(p||o.x+o.w>16*Re||o.x<0)&&o.xAccel>0?(o.x=16*x(o.x),o.xAccel=0):(u||o.x+o.w>16*Re||o.x<0)&&o.xAccel<0&&(o.x=16*x(o.x+o.w),o.xAccel=0)}function b(o,r){return{map:r,type:o}}function L(o){return{map:o.map.slice(0),type:o.type}}function W(o,r,e,t){for(var n=[],a=[],i=Math.max(o,r),l=0;i*i>l;l++)n[l]=0;n=t(n,o,r,i);for(var s,m={},c=0;10*i>c;c++)for(var u=0;10*i>u;u++){var p=C(Math.floor(u/10),Math.floor(c/10),i),d=Math.floor(u/10)+"-"+Math.floor(c/10);(u%10===0||c%10===0)&&(m[d]||(s=L(ae[n[p]]),m[d]=s),s=m[d]);var h=C(u,c,10*i),y=C(u%10,c%10,10);a[h]=s.map[y]}return{map:a,width:o,height:r,size:i,tiles:10*i}}function E(o,r,e,t,n,a,i,l,s,m){l.length=0;for(var c=0;c<ae.length;c++)i[c]=c;var u=a[C(e,t-1,n)],p=a[C(e-1,t,n)],d=a[C(e+1,t,n)],h=a[C(e,t+1,n)];if(0>t-1&&(u=-1),0>e-1&&(p=-1),t+1>m-1&&(h=-1),e+1>s-1&&(d=-1),4===u||2===u||6===u||7===u||9===u||13===u){console.warn("Room for Above");for(var y=0;y<i.length;y++)i[y]=-1;i[2]=2,i[3]=3,i[5]=5,i[8]=8,i[9]=9,-1!==p&&(1===p||3===p||4===p||5===p||6===p||9===p||10===p)&&(console.warn("Room for Above and Left"),i[2]=-1,i[5]=-1,i[3]=3,i[8]=8,i[9]=9,-1!==d&&(1===d||3===d||4===d||7===d||8===d||9===d||11===d)&&(i[8]=-1)),-1!==d&&(1===d||3===d||4===d||7===d||8===d||9===d||11===d)&&(console.warn("Room for Above and Left"),i[2]=-1,i[8]=-1,i[3]=3,i[5]=5,i[9]=9,-1!==p&&(1===p||3===p||4===p||5===p||6===p||9===p||10===p)&&(i[5]=-1))}if(0===e&&(console.warn("Left of Map"),i[7]=-1,i[8]=-1,i[1]=-1),e===s-1&&(console.warn("Right of Map"),i[5]=-1,i[6]=-1,i[1]=-1),0===t&&(console.warn("Top of Map"),i[3]=-1,i[5]=-1,i[8]=-1,i[2]=-1),t===m-1&&(console.warn("Bottom of Map"),i[4]=-1,i[6]=-1,i[7]=-1,i[2]=-1),e===o&&t===r){console.warn("Room for Start");for(var y=0;y<i.length;y++)i[y]=-1;i[10]=10,i[11]=11,i[12]=12,i[13]=13,-1===p&&(i[11]=-1),-1===u&&(i[12]=-1),-1===d&&(i[10]=-1),-1===h&&(i[13]=-1)}else i[10]=-1,i[11]=-1,i[12]=-1,i[13]=-1;i[9]=9;for(var y=0;y<i.length;y++)-1!==i[y]&&l.push(i[y]);var f=l[v(0,l.length-1)];11===f&&-1===[1,3,4,5,6,9].indexOf(p)&&E(o,r,e-1,t,n,a,i,l,s,m),12===f&&-1===[2,4,6,7,9].indexOf(u)&&E(o,r,e,t-1,n,a,i,l,s,m),a[C(e,t,n)]=f}function S(o){o.map=W(3*o.mapW,3*o.mapH,o,function(o,r,e,t){for(var n=0,a=0,i=0;t*t>i;i++)o[C(n,a,t)]=9,n++,n>r-1&&(n=0,a++),a>e-1&&(i=t*t);return o})}function F(o,r,e){I(o);for(var t=0;t<o.doors.length;t++){var n=!1,a=o.doors[t];if(a.dir===r&&(("N"===a.dir||"S"===a.dir)&&(n=e===a.mapX),("E"===a.dir||"W"===a.dir)&&(n=e===a.mapY),n)){var i=3*(a.mapX-o.mapX),l=3*(a.mapY-o.mapY);"N"===a.dir&&(i+=Math.floor(1.5),qr.y=0,qr.x=qr.x%160+10*i*16),"E"===a.dir&&(l+=Math.floor(1.5),i+=3,qr.x=10*o.mapW*16*3-qr.w,qr.y=qr.y%160+10*l*16),"S"===a.dir&&(i+=Math.floor(1.5),l+=3,qr.y=10*o.mapH*16*3-qr.h,qr.x=qr.x%160+10*i*16),"W"===a.dir&&(l+=Math.floor(1.5),qr.x=0,qr.y=qr.y%160+10*l*16)}}}function H(){for(var o=0;o<ke.doors.length;o++){var r=ke.doors[o],e=3*(r.mapX-ke.mapX),t=3*(r.mapY-ke.mapY),n=x(x(qr.x),10),a=x(x(qr.x+qr.w),10),i=x(x(qr.y),10),l=x(x(qr.y+qr.h),10),s=10*ke.mapW*16*3,m=10*ke.mapH*16*3;"N"===r.dir&&(e+=Math.floor(1.5)),"E"===r.dir&&(t+=Math.floor(1.5),e+=3),"S"===r.dir&&(e+=Math.floor(1.5),t+=3),"W"===r.dir&&(t+=Math.floor(1.5)),window.performance.now()-qr.doorCooldown>400&&(qr.x<=0&&-1===qr.xDirection&&"W"===r.dir&&e===n&&t===i&&F(r.room2,"E",r.mapY),qr.y<=0&&-1===qr.yDirection&&"N"===r.dir&&e===n&&t===i&&F(r.room2,"S",r.mapX),qr.x+qr.w>=s&&1===qr.xDirection&&"E"===r.dir&&e===a&&t===i&&F(r.room2,"W",r.mapY),qr.y+qr.h>=m&&0!==qr.yDirection&&Math.abs(qr.yAccel)>5&&"S"===r.dir&&e===n&&(t===l||t===i)&&F(r.room2,"N",r.mapX))}}function I(o){null===o.map&&S(o),ke=o,oe=o.map.tiles,Me=o.map.map,Pe=10*o.map.height,Re=10*o.map.width,re=10*o.map.height*16,ee=10*o.map.width*16,qr.doorCooldown=window.performance.now()}function V(){var o=Sr.canvas,r=o.width/2,e=o.height/2;qr.x-Te+r>o.width?Te=qr.x-(o.width-r):qr.x-r<Te&&(Te=qr.x-r),qr.y-Ye+e>o.height?Ye=qr.y-(o.height-e):qr.y-e<Ye&&(Ye=qr.y-e),Ye=~~(.5+Ye),Ye=~~(.5+Ye)}function B(){var o=Hr.canvas,r=o.width/2,e=o.height/2,t=16*(ke.mapX+x(x(x(qr.x),10),3)),n=16*(ke.mapY+x(x(x(qr.y),10),3));t-Xe+r>o.width?Xe=t-(o.width-r):Xe>t-r&&(Xe=t-r),n-Ae+e>o.height?Ae=n-(o.height-e):Ae>n-e&&(Ae=n-e),Ae=~~(.5+Ae),Ae=~~(.5+Ae)}function N(o,r,e){De.frontiers.length=0,De.frontiers.push({x:o,y:r}),De.currentRegion=e,De.regions.push(e)}function O(o){for(var r=!0,e=_(),t=[];r;){var n=0,a=j(e);t.length=0,t.push(or(a.x-1,a.y),or(a.x+1,a.y),or(a.x,a.y-1),or(a.x,a.y+1));for(var i=0;4>i;i++)null===t[i]&&n++;n>2&&(r=!1)}N(a.x,a.y,o)}function j(o){var r=v(0,o.length-1);return o[r]}function _(){for(var o=[],r=0;r<De.rooms.length;r++)o=z(o,De.rooms[r]);return o}function z(o,r){for(var e=r.mapX;e<r.mapX+r.mapW;)U(e,r.mapY-1,1,1)&&o.push({x:e,y:r.mapY-1}),U(e,r.mapY+r.mapH,1,1)&&o.push({x:e,y:r.mapY+r.mapH}),e++;for(var t=r.mapX;t<r.mapY+r.mapH;)U(t,r.mapX-1,1,1)&&o.push({x:t,y:r.mapX-1}),U(t,r.mapX+r.mapW,1,1)&&o.push({x:t,y:r.mapX+r.mapW}),t++;return o}function U(o,r,e,t){return J(o,r,e,t)&&!Q(o,r,e,t)}function J(o,r,e,t){return o>0&&r>0&&o+e<De.width&&r+t<De.height}function Q(o,r,e,t){for(var n=null,a=0;a<De.rooms.length;){n=De.rooms[a];{if(!(n.mapX>o+e-1||n.mapX+n.mapW-1<o||n.mapY>r+t-1||n.mapY+n.mapH-1<r))return!0;a++}}return!1}function G(o){for(var r=0,e=null,t=!1,n=100;De.rooms.length>1&&!t;){r=0,r+=q(o),r+=K(o),r+=Z(o),r+=$(o),1===o.region.rooms.length&&r>0&&(t=!0);for(var a=0;a<o.doors.length;a++)e=o.doors[a],ur(e,o).region===o.region&&(t=!0);n--,0===n&&(t=!0)}}function q(o){for(var r=null,e=null,t=null,n=[],a=o.mapX;a<o.mapX+o.mapW;)e=or(a,o.mapY-1),null!==e&&n.push({x:a,y:o.mapY,other:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,m=0;m<o.doors.length;m++)o.doors[m].room2===r.other&&(s=!0);Math.random()>be||M(o.doors,r)>=0||s||(t=sr(r.x,r.y,"N",o,r.other),o.doors.push(t),r.other.doors.push(sr(r.x,r.y-1,"S",r.other,o)),i++)}return i}function K(o){for(var r=null,e=null,t=null,n=[],a=o.mapX;a<o.mapX+o.mapW;)e=or(a,o.mapY+o.mapH),null!==e&&n.push({x:a,y:o.mapY+o.mapH-1,other:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,m=0;m<o.doors.length;m++)o.doors[m].room2===r.other&&(s=!0);Math.random()>be||M(o.doors,r)>=0||s||(t=sr(r.x,r.y,"S",o,r.other),o.doors.push(t),r.other.doors.push(sr(r.x,r.y+1,"N",r.other,o)),i++)}return i}function Z(o){for(var r=null,e=null,t=null,n=[],a=o.mapY;a<o.mapY+o.mapH;)e=or(o.mapX-1,a),null!==e&&n.push({x:o.mapX,y:a,other:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,m=0;m<o.doors.length;m++)o.doors[m].room2===r.other&&(s=!0);Math.random()>be||M(o.doors,r)>=0||s||(t=sr(r.x,r.y,"W",o,r.other),o.doors.push(t),r.other.doors.push(sr(r.x-1,r.y,"E",r.other,o)),i++)}return i}function $(o){for(var r=null,e=null,t=null,n=[],a=o.mapY;a<o.mapY+o.mapH;)e=or(o.mapX+o.mapW,a),null!==e&&n.push({x:o.mapX+o.mapW-1,y:a,other:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var s=!1,m=0;m<o.doors.length;m++)o.doors[m].room2===r.other&&(s=!0);Math.random()>be||M(o.doors,r)>=0||s||(t=sr(r.x,r.y,"E",o,r.other),o.doors.push(t),r.other.doors.push(sr(r.x+1,r.y,"W",r.other,o)),i++)}return i}function or(o,r){for(var e=null,t=0;t<De.rooms.length;){e=De.rooms[t];{if(!(e.mapX>o||e.mapX+e.mapW-1<o||e.mapY>r||e.mapY+e.mapH-1<r))return e;t++}}return null}function rr(o,r,e){for(var t=null,n=0;n<o.doors.length;)if(t=De.rooms[n],t.mapX===r&&t.mapY===e)return t;return null}function er(o){for(var r=0,e=De.rooms.length;r++<10*o&&De.rooms.length<e+o;)tr()}function tr(){var o=j(De.frontiers);try{nr(ir(o.x,o.y))}catch(r){console.log(De,o,r)}}function nr(o){if(null===o||!U(o.mapX,o.mapY,o.mapW,o.mapH))return!1;var r=[];r=ar(r,o),De.frontiers=z(r,o),0===De.frontiers.length&&console.log(r,o,z(r,o)),o.mapColor=De.currentRegion.color,De.rooms.push(o),De.currentRegion.rooms.push(o),G(o)}function z(o,r){for(var e=r.mapX;e<r.mapX+r.mapW;)U(e,r.mapY-1,1,1)&&o.push({x:e,y:r.mapY-1}),U(e,r.mapY+r.mapH,1,1)&&o.push({x:e,y:r.mapY+r.mapH}),e++;for(var t=r.mapY;t<r.mapY+r.mapH;)U(r.mapX-1,t,1,1)&&o.push({x:r.mapX-1,y:t}),U(r.mapX+r.mapW,t,1,1)&&o.push({x:r.mapX+r.mapW,y:t}),t++;return o}function ar(o,r){for(var e=0;e<De.frontiers.length;e++)De.frontiers[e].x>=r.mapX-1&&De.frontiers[e].x<=r.mapX+r.mapW&&De.frontiers[e].y>=r.mapY&&De.frontiers[e].y<=r.mapY+r.mapH-1||De.frontiers[e].x>=r.mapX&&De.frontiers[e].x<=r.mapX+r.mapW-1&&De.frontiers[e].y>=r.mapY-1&&De.frontiers[e].y<=r.mapY+r.mapH||o.push(De.frontiers[e]);return o}function ir(o,r){for(var e=0,t=1,n=1;e++<25&&(t<De.currentRegion.maxW||n<De.currentRegion.maxH)&&Math.random()<.9;)switch(parseInt(4*Math.random())){case 0:n<De.currentRegion.maxH&&U(o,r-1,t,n+1)&&(r--,n++);continue;case 1:n<De.currentRegion.maxH&&U(o,r,t,n+1)&&n++;continue;case 2:t<De.currentRegion.maxW&&U(o-1,r,t+1,n)&&(o--,t++);continue;case 3:t<De.currentRegion.maxW&&U(o,r,t+1,n)&&t++;continue;default:continue}return lr(o,r,t,n,De.currentRegion)}function lr(o,r,e,t,n){return{mapX:o,mapY:r,mapW:e,mapH:t,mapColor:null,region:n,specialType:0,startPositionX:0,startPositionY:0,startRoom:!1,visited:!1,doors:[],map:null}}function sr(o,r,e,t,n){return{mapX:o,mapY:r,doorType:0,dir:e,room1:t,room2:n}}function mr(){for(var o=null,r=null,e=0;e<De.rooms.length;e++){o=De.rooms[e],o.specialType=0;for(var t=0;t<o.doors.length;t++)r=o.doors[t],r.doorType=0}}function cr(){var o=null,r=[],e=null,t=null,n=null,a=null,i=[],l=[],s=[];s.push(De.regions[0]);for(var m=0;s.length>0;){m++,r.length=0,e=s.shift(),l.push(e),n=j(e.rooms),n.specialType=m%We.length;for(var c=0;c<e.rooms.length;c++){a=e.rooms[c];for(var u=0;u<a.doors.length;u++)o=a.doors[u],t=ur(o,a).region,t!==e&&o.doorType<=0&&(r.indexOf(t)>=0?i.push(o):(o.doorType=m%We.length,r.push(t),-1===l.indexOf(t)&&-1===s.indexOf(t)&&s.push(t)))}}for(var p=0;p<i.length;p++)o=i[p],o.doorType<=0&&(o.doorType=parseInt(Math.random()*(m%We.length))+1)}function ur(o,r){return o.room1===r?o.room2:o.room1}function pr(){De={width:0,height:0,rooms:[],frontiers:[],regions:[],currentRegion:0},currentRegionColorIndex=0,De.width=80,De.height=48,N(40,24,dr()),er(1),I(De.rooms[0]),ke.startRoom=!0,ke.startPositionX=v(0,3*ke.mapW-1),ke.startPositionY=v(0,3*ke.mapH-1),qr.x=10*ke.startPositionX*16+80,qr.y=10*ke.startPositionY*16+32}function dr(){var o=hr(We[currentRegionColorIndex],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1);return currentRegionColorIndex=(currentRegionColorIndex+1)%We.length,o}function hr(o,r,e){return{color:o,maxW:r,maxH:e,rooms:[]}}function yr(){pr(),a()}function fr(){tr(),a()}function gr(){O(dr())}function wr(){mr(),cr(),a()}var vr=0,xr=0,Cr=0,Mr=0,Rr=0,Pr=0,Tr=[],Yr=[],Xr=0,Ar=!1,Dr=0,kr=kr||{};kr.Node=function(o,r,e,t,n){this.parent=o,this.x=r,this.y=e,this.costSoFar=t,this.simpleDistanceToTarget=n,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},kr.Node.OPEN_LIST=0,kr.Node.CLOSED_LIST=1,kr.PriorityQueue=function(o,r){this.length=0;var e=[],t=!1;if(r==kr.PriorityQueue.MAX_HEAP)t=!0;else{if(r!=kr.PriorityQueue.MIN_HEAP)throw r+" not supported.";t=!1}this.insert=function(r){if(!r.hasOwnProperty(o))throw"Cannot insert "+r+" because it does not have a property by the name of "+o+".";e.push(r),this.length++,n(this.length-1)},this.getHighestPriorityElement=function(){return e[0]},this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";if(1===this.length){var o=e[0];return e=[],this.length=0,o}var r=e[0],t=e.pop();return this.length--,e[0]=t,a(0),r};var n=function(o){if(0!==o){var r=s(o);l(o,r)&&(i(o,r),n(r))}},a=function(o){var r=m(o),e=c(o);if(l(r,o))i(o,r),a(r);else if(l(e,o))i(o,e),a(e);else{if(0==o)return;a(0)}},i=function(o,r){var t=e[o];e[o]=e[r],e[r]=t},l=function(r,n){if(void 0===e[n]||void 0===e[r])return!1;var a,i;return"function"==typeof e[r][o]?(a=e[r][o](),i=e[n][o]()):(a=e[r][o],i=e[n][o]),t?a>i?!0:!1:i>a?!0:!1},s=function(o){return Math.floor(o/2)-1},m=function(o){return 2*o+1},c=function(o){return 2*o+2}},kr.PriorityQueue.MAX_HEAP=0,kr.PriorityQueue.MIN_HEAP=1,kr.instance=function(){this.isDoneCalculating=!0,this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},kr.js=function(){var o,r,e,t=10,n=14,a={},i={},l=[],s=Number.MAX_VALUE,m=!1;this.setAcceptableTiles=function(o){o instanceof Array?e=o:!isNaN(parseFloat(o))&&isFinite(o)&&(e=[o])},this.enableDiagonals=function(){m=!0},this.disableDiagonals=function(){m=!1},this.setGrid=function(r){o=r;for(var e=0;e<o.length;e++)for(var t=0;t<o[0].length;t++)i[o[e][t]]||(i[o[e][t]]=1)},this.setTileCost=function(o,r){i[o]=r},this.setIterationsPerCalculation=function(o){s=o},this.avoidAdditionalPoint=function(o,r){a[o+"_"+r]=1},this.stopAvoidingAdditionalPoint=function(o,r){delete a[o+"_"+r]},this.stopAvoidingAllAdditionalPoints=function(){a={}},this.findPath=function(r,n,a,i,s){if(void 0===e)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===o)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(0>r||0>n||0>a||0>a||r>o[0].length-1||n>o.length-1||a>o[0].length-1||i>o.length-1)throw new Error("Your start or end point is outside the scope of your grid.");r===a&&n===i&&s([]);for(var m=o[i][a],c=!1,p=0;p<e.length;p++)if(m===e[p]){c=!0;break}if(c===!1)return void s(null);var d=new kr.instance;d.openList=new kr.PriorityQueue("bestGuessDistance",kr.PriorityQueue.MIN_HEAP),d.isDoneCalculating=!1,d.nodeHash={},d.startX=r,d.startY=n,d.endX=a,d.endY=i,d.callback=s,d.openList.insert(u(d,d.startX,d.startY,null,t)),l.push(d)},this.calculate=function(){if(0!==l.length&&void 0!==o&&void 0!==e)for(r=0;s>r;r++){if(0===l.length)return;if(0!==l[0].openList.length){var a=l[0].openList.shiftHighestPriorityElement();if(a.list=kr.Node.CLOSED_LIST,a.y>0&&(c(l[0],a,0,-1,t*i[o[a.y-1][a.x]]),l[0].isDoneCalculating===!0))l.shift();else if(a.x<o[0].length-1&&(c(l[0],a,1,0,t*i[o[a.y][a.x+1]]),l[0].isDoneCalculating===!0))l.shift();else if(a.y<o.length-1&&(c(l[0],a,0,1,t*i[o[a.y+1][a.x]]),l[0].isDoneCalculating===!0))l.shift();else if(a.x>0&&(c(l[0],a,-1,0,t*i[o[a.y][a.x-1]]),l[0].isDoneCalculating===!0))l.shift();else if(m){if(a.x>0&&a.y>0&&(c(l[0],a,-1,-1,n*i[o[a.y-1][a.x-1]]),l[0].isDoneCalculating===!0)){l.shift();continue}if(a.x<o[0].length-1&&a.y<o.length-1&&(c(l[0],a,1,1,n*i[o[a.y+1][a.x+1]]),l[0].isDoneCalculating===!0)){l.shift();continue}if(a.x<o[0].length-1&&a.y>0&&(c(l[0],a,1,-1,n*i[o[a.y-1][a.x+1]]),l[0].isDoneCalculating===!0)){l.shift();continue}if(a.x>0&&a.y<o.length-1&&(c(l[0],a,-1,1,n*i[o[a.y+1][a.x-1]]),l[0].isDoneCalculating===!0)){l.shift();continue}}}else l[0].callback(null),l.shift()}};var c=function(r,t,n,i,l){var s=t.x+n,m=t.y+i;if(void 0===a[s+"_"+m]){if(r.endX===s&&r.endY===m){r.isDoneCalculating=!0;var c=[],p=0;c[p]={x:s,y:m},p++,c[p]={x:t.x,y:t.y},p++;for(var d=t.parent;null!=d;)c[p]={x:d.x,y:d.y},p++,d=d.parent;c.reverse(),r.callback(c)}for(var h=0;h<e.length;h++)if(o[m][s]===e[h]){var y=u(r,s,m,t,l);void 0===y.list?(y.list=kr.Node.OPEN_LIST,r.openList.insert(y)):y.list===kr.Node.OPEN_LIST&&t.costSoFar+l<y.costSoFar&&(y.costSoFar=t.costSoFar+l,y.parent=t);break}}},u=function(o,r,e,t,n){if(void 0!==o.nodeHash[r+"_"+e])return o.nodeHash[r+"_"+e];var a=p(r,e,o.endX,o.endY);if(null!==t)var i=t.costSoFar+n;else i=a;var l=new kr.Node(t,r,e,i,a);return o.nodeHash[r+"_"+e]=l,l},p=function(o,r,e,n){return Math.sqrt(Math.abs(e-o)*Math.abs(e-o)+Math.abs(n-r)*Math.abs(n-r))*t}};var br,Lr,Wr,Er,Sr,Fr,Hr,Ir,Vr,Br,Nr=0,Or=1,jr=2,_r=!0,zr=new CustomEvent("frame"),Ur=window.performance.now(),Jr=window.performance.now(),Qr={},Gr={},qr={x:151,y:48,w:16,h:32,img:null,xDirection:0,yDirection:1,xAccel:0,yAccel:0,maxAccel:5,jumpForce:7,jumpHeight:50,jumpStart:0,jumping:0,jumpsUsed:0,heightTraveled:0,maxJumps:1,angle:0,health:5,doorCooldown:window.performance.now(),maxHealth:5},Kr=Ur-Jr,Zr=[qr],$r={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};p("keydown",P),p("keyup",T),p("resize",f),p("DOMContentLoaded",y),p("frame",g),window.addEventListener("resize",d),document.addEventListener("DOMContentLoaded",d),document.addEventListener("mousedown",d),document.addEventListener("mouseup",d),document.addEventListener("keydown",d),document.addEventListener("keyup",d),document.addEventListener("frame",d);for(var oe=0,re=0,ee=0,te=oe,ne=oe,ae=[],ie=[],le=[],se=0;100>se;se++)le[se]=0;var me=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ce=[1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1],ue=[1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],pe=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],de=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],he=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],ye=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,1,0,1,1,0,0,0,0,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1],fe=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ge=[1,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],we=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],ve=[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],xe=[1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1],Ce=[1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1];ae.push(b(0,le)),ae.push(b(1,me)),ae.push(b(2,ce)),ae.push(b(3,ue)),ae.push(b(4,pe)),ae.push(b(5,de)),ae.push(b(6,he)),ae.push(b(7,ye)),ae.push(b(8,fe)),ae.push(b(9,ge)),ae.push(b(10,we)),ae.push(b(11,ve)),ae.push(b(12,xe)),ae.push(b(13,Ce));var Me=null,Re=0,Pe=0,Te=0,Ye=0,Xe=0,Ae=0,De,ke,be=.2,Le=0,We=[{background:"#BBBBBB",border:"#A0A0A0",other:"#CFCFCF",lock:"#FFFFFF"},{border:"#990000",background:"#FF3333",other:"#FF0000",lock:"#FF6666"},{border:"#006600",background:"#00BB00",other:"#00BB00",lock:"#66FF66"},{border:"#000066",background:"#3333FF",other:"#0000FF",lock:"#6666FF"},{background:"#9F9F9F",border:"#555555",other:"#555555",lock:"#B0B0B0"}];