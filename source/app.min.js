function o(){var o=g(Re)-1,t=g(Pe)-1,a=g(Re)+g(Fr.width)+2,i=g(Pe)+g(Fr.height)+2;0>o&&(o=0),0>t&&(t=0),a>oe&&(a=oe),i>oe&&(i=oe);for(var l=t;i>l;l++){var m,d=0,c=16*-oe*2,s=0;Ir.fillStyle=ke.c.bg;for(var u=o;a>u;u++)0!==Me[C(u,l,oe)]&&(d+=16,c===16*-oe*2&&(c=16*u-Re),m=0>l-1?-1:Me[C(u,l-1,oe)],0===m&&(s=1)),(0===Me[C(u,l,oe)]||u===a-1)&&r(u,l,Me,oe,c,d,s),(0===Me[C(u,l,oe)]||u===a-1)&&(d=0,c=16*-oe*2,s=0)}e(o,t,a,i,1),e(o,t,a,i,4),n(o,t,a,i,2),n(o,t,a,i,8)}function r(o,r,e,n,t,a,i){var l=t,m=16*r-Pe;1===i?Ir.fillRect(l,m-5,a,21):Ir.fillRect(l,m,a,16)}function e(o,r,e,n,a){for(var i=o;e>i;i++)for(var l=0,m=16*-oe*2,d=0,c=0,s=r;n>s;s++){var u=Me[C(i+1,s-1,oe)],p=Me[C(i,s-1,oe)],y=Me[C(i-1,s-1,oe)];if(1===a?(c=Me[C(i-1,s,oe)],0>i-1&&(c=-1)):4===a&&(c=Me[C(i+1,s,oe)],i+1>oe-1&&(c=-1)),0!==Me[C(i,s,oe)]&&1>c&&(l+=16,m===16*-oe*2&&(0===p&&(d=1),m=16*s-Pe)),0===Me[C(i,s,oe)]||s===n-1||c>0){Sr.beginPath();var h=m,x=16*i-Re,w=h+l,f=16*(i+1)-Re,v=x;4===a&&(v=f),d&&(h-=5),(4===a&&0===u||1===a&&0===y)&&c>0?t(v,h,v,w+3):t(v,h,v,w),Sr.closePath(),Sr.stroke()}(0===Me[C(i,s,oe)]||s===n-1||c>0)&&(l=0,m=16*-oe*2,d=0)}}function n(o,r,e,n,a){for(var i=r;n>i;i++)for(var l=0,m=16*-oe*2,d=0,c=0,s=o;e>s;s++){if(2===a?0>i-1?c=-1:(c=Me[C(s,i-1,oe)],d=1):8===a&&(c=Me[C(s,i+1,oe)],i+1>oe-1&&(c=-1)),0!==Me[C(s,i,oe)]&&1>c&&(l+=16,m===16*-oe*2&&(m=16*s-Re)),0===Me[C(s,i,oe)]||s===e-1||c>0){Sr.beginPath();var u=m,p=16*i-Pe,y=u+l,h=16*(i+1)-Pe;2===a?1===d?(t(u,p-5,y,p-5),t(u,p+3,y,p+3)):t(u,p,y,p):8===a&&t(u,h,y,h),Sr.closePath(),Sr.stroke()}(0===Me[C(s,i,oe)]||s===e-1||c>0)&&(l=0,m=16*-oe*2,d=0)}}function t(o,r,e,n){Sr.moveTo(o,r),Sr.lineTo(e,n)}function a(){if(B(),Rr=16*ke.x+16*g(g(g(Qr.x),10),1)-Te,Pr=16*ke.y+16*g(g(g(Qr.y),10),1)-Ae,ke.x+g(g(g(Qr.x),10),1)!==Cr||ke.y+g(g(g(Qr.y),10),1)!==Mr||Tr!==De.rooms.length){Vr.width=500,Vr.height=500,Er.clearRect(0,0,Vr.width,Vr.height),Dr.length=0,Er.lineWidth=2,Er.fillStyle="#000";for(var o=0;o<De.r.length;o++)for(var r=0;r<De.r[o].rooms.length;r++)room=De.r[o].rooms[r],roomX=16*room.x-Te,roomY=16*room.y-Ae,roomX+16*room.w>0&&roomY+16*room.h>0&&roomX<Vr.width&&roomY<Vr.height&&(Er.beginPath(),Er.rect(roomX,roomY,16*room.w,16*room.h),Er.fill(),Er.closePath());i("bg","bd",function(o,r,e){o.v&&(Er.beginPath(),Er.rect(r,e,16*o.w,16*o.h),Er.fill(),Er.stroke(),Er.closePath())}),i(0,"bg",d),i(0,0,l)}s(),Cr=ke.x+g(g(g(Qr.x),10),1),Mr=ke.y+g(g(g(Qr.y),10),1),Tr=De.rooms.length}function i(o,r,e){for(var n=0;n<De.r.length;n++){"string"==typeof o&&(Er.fillStyle=De.r[n].color[o]),"string"==typeof r&&(Er.strokeStyle=De.r[n].color[r]);for(var t=0;t<De.r[n].rooms.length;t++)room=De.r[n].rooms[t],roomX=16*room.x-Te,roomY=16*room.y-Ae,roomX+16*room.w>0&&roomY+16*room.h>0&&roomX<Vr.width&&roomY<Vr.height&&e(room,roomX,roomY)}}function l(o){if(o.v){for(var r=null,e=0;e<o.d.length;e++){r=o.d[e];var n=Fe[r.dt].l;if(r.dt>0)switch(r.dir){case"N":m(16*r.x+5,16*r.y,n);continue;case"S":m(16*r.x+5,16*r.y+16,n);continue;case"W":m(16*r.x-3,16*r.y+8,n);continue;case"E":m(16*r.x+13,16*r.y+8,n);continue;default:continue}}var n=Fe[o.s].l;o.s>0&&m(16*(o.x+o.w/2)-3,16*(o.y+o.h/2),"rgba(0,0,0,0)",n)}}function m(o,r,e,n){var t=3;Er.beginPath(),Er.arc(o+t-Te,r-Ae,t,0,2*Math.PI,!1),Er.fillStyle=e,Er.fill(),n&&(Er.lineWidth=2,Er.strokeStyle=n,Er.stroke()),Er.closePath()}function d(o){if(o.v)for(var r=null,e=0;e<o.d.length;e++){r=o.d[e];var n=o.x+"-"+o.y+"-"+r.r2.x+"-"+r.r2.y,t=r.r2.x+"-"+r.r2.y+"-"+o.x+"-"+o.y;if(-1===Dr.indexOf(t)&&-1===Dr.indexOf(n)){var a=16*r.x,i=16*r.y;"N"===r.dir&&c(a+4,i,a+16-4,i),"S"===r.dir&&c(a+4,16*(r.y+1),a+16-4,16*(r.y+1)),"W"===r.dir&&c(a,i+4,a,i+16-4),"E"===r.dir&&c(16*(r.x+1),i+4,16*(r.x+1),i+16-4),Dr.push(n)}}}function c(o,r,e,n){Er.beginPath(),Er.moveTo(o-Te,r-Ae),Er.lineTo(e-Te,n-Ae),Er.stroke(),Er.closePath()}function s(){br||(jr.width=Vr.width,jr.height=Vr.height,Br.lineWidth=1,br=!0),Br.clearRect(0,0,jr.width,jr.height),kr+=2*(Zr/1e3),kr%=2;var o=1;kr>1&&(o=0),Lr!==o&&(Br.fillStyle="rgba(200,200,255,"+.6*o+")",Br.strokeStyle="rgba(200,200,255,"+.8*o+")"),Br.beginPath(),Br.rect(Rr,Pr,16,16),Br.fill(),Br.stroke(),Br.closePath(),Lr=o}function u(o,r){qr[o]||(qr[o]=[]),qr[o].push(r)}function p(o){var r=o.type;if(qr[r]&&qr[r].length>0)for(var e=0;e<qr[r].length;e++)qr[r][e](o)}function y(o){return document.getElementById(o)}function h(){Fr=y("player"),Wr=y("bd"),Yr=y("tile"),Vr=y("minimap"),jr=y("minimapIcons"),Xr=Fr.getContext("2d"),Sr=Wr.getContext("2d"),Ir=Yr.getContext("2d"),Er=Vr.getContext("2d"),Br=jr.getContext("2d"),x(),xr();for(var o=0;o<Fe.length;o++){for(var r=v(10,20),e=0;r>e;e++)wr();o+1<Fe.length&&fr()}vr(),E(De.rooms[0]),ke.sr=!0,ke.sx=v(0,1*ke.w-1),ke.sy=v(0,1*ke.h-1),Qr.x=10*ke.sx*16+80,Qr.y=10*ke.sy*16+32,f()}function x(){Wr.width=Fr.width=Yr.width=window.innerWidth>300?300:window.innerWidth,Wr.height=Fr.height=Yr.height=window.innerHeight>300?300:window.innerHeight}function w(){for(var r=0;r<$r.length;r++){var e=$r[r];A(e),e.x=R(e.x),e.y=R(e.y),L(e),b(e),D(e),S(),k(e)}V(),Sr.strokeStyle=ke.c.bd,Sr.lineWidth=2,Xr.clearRect(0,0,Fr.width,Fr.height),Sr.clearRect(0,0,Wr.width,Wr.height),Ir.fillStyle=ke.c.bd,Ir.fillRect(0,0,Yr.width,Yr.height),Ir.fillStyle=ke.c.bg,Ir.clearRect(0-Re,0-Pe,ee,re),o(),a(),Xr.fillStyle="#000000";for(var r=0;r<$r.length;r++){var e=$r[r],n=(15-15*(Qr.health/Qr.maxHealth)).toString(16);Xr.fillStyle="#"+n+n+"0000",Xr.fillRect(e.x-Re,e.y-Pe,e.w,e.h)}}function f(){Jr=window.performance.now(),Zr=Jr-Kr,Kr=Jr,document.dispatchEvent(Ur),zr&&requestAnimationFrame(f)}function v(o,r){return Math.floor(Math.random()*(r-o+1)+o)}function g(o,r){var e=o%(r||16);return(o-e)/(r||16)}function C(o,r,e){return r*e+o}function M(o,r){if("object"==typeof r){for(var e=0;e<o.length;e++){var n=!0;if("object"==typeof o[e]){for(var t in r)if(o[e][t]!==r[t]){n=!1;break}if(n===!0)return e}}return-1}return o.indexOf(r)}function R(o){return~~(.5+o)}function P(o){for(var r in _r)_r[r]===o.keyCode&&o.preventDefault();Gr[o.keyCode]!==o.type&&o.keyCode===_r.space&&(Qr.jumping=1),Gr[o.keyCode]=o.type,o.keyCode===_r.d?Qr.xDirection=1:o.keyCode===_r.a&&(Qr.xDirection=-1)}function T(o){for(var r in _r)_r[r]===o.keyCode&&o.preventDefault();Gr[o.keyCode]!==o.type&&o.keyCode===_r.space&&(Qr.jumping=0),Gr[o.keyCode]=o.type,(o.keyCode===_r.d||o.keyCode===_r.a)&&(Gr[_r.d]&&Gr[_r.a]?Gr[_r.d]===o.type&&Gr[_r.a]===o.type&&(Qr.xDirection=0):Qr.xDirection=0)}function A(o){o.xAccel=o.xAccel+o.xDirection/60*Zr,o.xAccel>o.maxAccel&&(o.xAccel=o.maxAccel),o.xAccel<-o.maxAccel&&(o.xAccel=-o.maxAccel),0===o.xDirection&&(o.xAccel>0?o.xAccel=o.xAccel+-2/60*Zr:o.xAccel<0&&(o.xAccel=o.xAccel+2/60*Zr),(o.xAccel<1/60*Zr&&o.xAccel>-1/60*Zr||1===o.yDirection||-1===o.yDirection)&&(o.xAccel=0)),o.x=o.x+o.xAccel}function D(o){o.jumping&&-1!==o.yDirection&&o.jumpsUsed<o.maxJumps&&(o.maxJumps>1&&0===o.jumpsUsed&&1===o.yDirection&&o.jumpsUsed++,(0===o.jumpsUsed&&0===o.yDirection||o.jumpsUsed>0||o.maxJumps>1)&&(o.yDirection=-1,o.yAccel=-o.jumpForce,o.jumpStart=o.y,o.jumpsUsed++),o.heightTraveled=0),(0===o.yDirection||!o.jumping||o.heightTraveled>o.jumpHeight)&&(o.yDirection=1),1===o.yDirection&&(o.jumping=0,o.yAccel=o.yAccel+o.jumpForce/2/60*Zr),0===o.yDirection&&(o.yAccel>0?o.yAccel=o.yAccel+-1/60*Zr:o.yAccel<0&&(o.yAccel=o.yAccel+1/60*Zr),o.yAccel<1/60*Zr&&o.yAccel>-1/60*Zr&&(o.yAccel=0)),o.yAccel>o.maxAccel&&(o.yAccel=10),o.heightTraveled-=o.yAccel,o.heightTraveled=R(o.heightTraveled),o.y=o.y+o.yAccel}function k(o){var r=o.x%16,e=C(g(o.x),g(o.y+o.h),oe),n=C(g(o.x+o.w),g(o.y+o.h),oe),t=!1;t=0===r?Me[e]:0!==Me[n]||0!==Me[e],(t||o.y+o.h>16*te)&&1===o.yDirection&&(o.y=16*g(o.y),o.yAccel=0,o.yDirection=0,o.jumpsUsed=0,o.jumping=0,o.heightTraveled=0)}function b(o){var r=o.x%16,e=C(g(o.x),g(o.y-o.h/2),oe),n=C(g(o.x+o.w),g(o.y-o.h/2),oe),t=!1;t=0===r?0!==Me[e]:0!==Me[e]||0!==Me[n],t&&1===o.jumping&&(o.y=16*g(o.y),o.yAccel=-1,o.yDirection=1,o.jumping=0,o.heightTraveled=0)}function L(o){var r=o.y%16,e=o.x%16,n=C(g(o.x),g(o.y-o.h/2),oe),t=C(g(o.x+o.w),g(o.y-o.h/2),oe),a=C(g(o.x),g(o.y),oe),i=C(g(o.x+o.w),g(o.y),oe),l=C(g(o.x),g(o.y+o.h/2),oe),m=C(g(o.x+o.w),g(o.y+o.h/2),oe),d=C(g(o.x),g(o.y+o.h),oe),c=C(g(o.x+o.w),g(o.y+o.h),oe),s=!1,u=!1;0===r?(s=0!==Me[l]||0!==Me[a],u=0!==Me[m]||0!==Me[i]):16*g(o.y+o.h)>o.y+o.h?(s=0!==Me[l]||0!==Me[a]||0!==Me[n],u=0!==Me[m]||0!==Me[i]||0!==Me[t]):(s=0!==Me[l]||0!==Me[a]||0!==Me[d],u=0!==Me[m]||0!==Me[i]||0!==Me[c]),0===e?(u||o.x+o.w>16*ne||o.x<0)&&o.xAccel>0&&(o.x=16*g(o.x),o.xAccel=0):(u||o.x+o.w>16*ne||o.x<0)&&o.xAccel>0?(o.x=16*g(o.x),o.xAccel=0):(s||o.x+o.w>16*ne||o.x<0)&&o.xAccel<0&&(o.x=16*g(o.x+o.w),o.xAccel=0)}function F(o,r){r=r.split("");for(var e=0;e<r.length;e++)r[e]=parseInt(r[e]);return{map:r,type:o}}function Y(o){return{map:o.map.slice(0),type:o.type}}function W(o,r,e,n){for(var t=[],a=[],i=Math.max(o,r),l=0;i*i>l;l++)t[l]=0;t=n(t,o,r,i);for(var m,d,c,s,u,p={},y=0;10*i>y;y++)for(var h=0;10*i>h;h++){var x=Math.floor(h/10),w=Math.floor(y/10);d=or(e,x,w,"N"),c=or(e,x,w,"E"),s=or(e,x,w,"S"),u=or(e,x,w,"W");var f=C(x,w,i),v=x+"-"+w;(h%10===0||y%10===0)&&(p[v]||(m=Y(ae[t[f]]),p[v]=m),m=p[v]);var g=C(h,y,10*i),M=C(h%10,y%10,10);a[g]=m.map[M],0===y&&null===d&&10*o>h&&(a[g]=1),0===h&&null===u&&10*r>y&&(a[g]=1),y===10*r-1&&null===s&&10*o>h&&(a[g]=1),h===10*o-1&&null===c&&10*r>y&&(a[g]=1),0===y&&null!==d&&10*o>h&&d.dt>0&&0===a[g]&&(a[g]=d.dt+1),0===h&&null!==u&&10*r>y&&u.dt>0&&0===a[g]&&(a[g]=u.dt+1),y===10*r-1&&null!==s&&10*o>h&&s.dt>0&&0===a[g]&&(a[g]=s.dt+1),h===10*o-1&&null!==c&&10*r>y&&c.dt>0&&0===a[g]&&(a[g]=c.dt+1)}return{map:a,width:o,height:r,size:i,tiles:10*i}}function X(o){o.map=W(1*o.w,1*o.h,o,function(o,r,e,n){for(var t=0,a=0,i=0;n*n>i;i++)o[C(t,a,n)]=9,t++,t>r-1&&(t=0,a++),a>e-1&&(i=n*n);return o})}function I(o,r,e){E(o);for(var n=0;n<o.d.length;n++){var t=!1,a=o.d[n];if(a.dir===r&&(("N"===a.dir||"S"===a.dir)&&(t=e===a.x),("E"===a.dir||"W"===a.dir)&&(t=e===a.y),t)){var i=1*(a.x-o.x),l=1*(a.y-o.y);"N"===a.dir&&(i+=Math.floor(.5),Qr.y=0,Qr.x=Qr.x%160+10*i*16),"E"===a.dir&&(l+=Math.floor(.5),i+=1,Qr.x=10*o.w*16*1-Qr.w,Qr.y=Qr.y%160+10*l*16),"S"===a.dir&&(i+=Math.floor(.5),l+=1,Qr.y=10*o.h*16*1-Qr.h,Qr.x=Qr.x%160+10*i*16),"W"===a.dir&&(l+=Math.floor(.5),Qr.x=0,Qr.y=Qr.y%160+10*l*16)}}}function S(){for(var o=0;o<ke.d.length;o++){var r=ke.d[o],e=1*(r.x-ke.x),n=1*(r.y-ke.y),t=g(g(Qr.x),10),a=g(g(Qr.x+Qr.w),10),i=g(g(Qr.y),10),l=g(g(Qr.y+Qr.h),10),m=10*ke.w*16*1,d=10*ke.h*16*1;"N"===r.dir&&(e+=Math.floor(.5)),"E"===r.dir&&(n+=Math.floor(.5),e+=1),"S"===r.dir&&(e+=Math.floor(.5),n+=1),"W"===r.dir&&(n+=Math.floor(.5)),window.performance.now()-Qr.doorCooldown>400&&(Qr.x<=0&&-1===Qr.xDirection&&"W"===r.dir&&e===t&&n===i&&I(r.r2,"E",r.y),Qr.y<=0&&-1===Qr.yDirection&&"N"===r.dir&&e===t&&n===i&&I(r.r2,"S",r.x),Qr.x+Qr.w>=m&&1===Qr.xDirection&&"E"===r.dir&&e===a&&n===i&&I(r.r2,"W",r.y),Qr.y+Qr.h>=d&&0!==Qr.yDirection&&Math.abs(Qr.yAccel)>5&&"S"===r.dir&&e===t&&(n===l||n===i)&&I(r.r2,"N",r.x))}}function E(o){null===o.map&&X(o),ke=o,cr(o),ke.v=!0,oe=o.map.tiles,Me=o.map.map,te=10*o.map.height,ne=10*o.map.width,re=10*o.map.height*16,ee=10*o.map.width*16,Qr.doorCooldown=window.performance.now()}function V(){var o=Ir.canvas,r=o.width/2,e=o.height/2;Qr.x-Re+r>o.width?Re=Qr.x-(o.width-r):Qr.x-r<Re&&(Re=Qr.x-r),Qr.y-Pe+e>o.height?Pe=Qr.y-(o.height-e):Qr.y-e<Pe&&(Pe=Qr.y-e),Pe=~~(.5+Pe),Pe=~~(.5+Pe)}function B(){var o=Er.canvas,r=o.width/2,e=o.height/2,n=16*(ke.x+g(g(g(Qr.x),10),1)),t=16*(ke.y+g(g(g(Qr.y),10),1));n-Te+r>o.width?Te=n-(o.width-r):Te>n-r&&(Te=n-r),t-Ae+e>o.height?Ae=t-(o.height-e):Ae>t-e&&(Ae=t-e),Ae=~~(.5+Ae),Ae=~~(.5+Ae)}function j(o,r,e){De.f.length=0,De.f.push({x:o,y:r}),De.cr=e,De.r.push(e)}function O(o){for(var r=!0,e=N(),n=[];r;){var t=0,a=H(e);n.length=0,n.push(_(a.x-1,a.y),_(a.x+1,a.y),_(a.x,a.y-1),_(a.x,a.y+1));for(var i=0;4>i;i++)null===n[i]&&t++;t>2&&(r=!1)}j(a.x,a.y,o)}function H(o){var r=v(0,o.length-1);return o[r]}function N(){for(var o=[],r=0;r<De.rooms.length;r++)o=z(o,De.rooms[r]);return o}function z(o,r){for(var e=r.x;e<r.x+r.w;)U(e,r.y-1,1,1)&&o.push({x:e,y:r.y-1}),U(e,r.y+r.h,1,1)&&o.push({x:e,y:r.y+r.h}),e++;for(var n=r.x;n<r.y+r.h;)U(n,r.x-1,1,1)&&o.push({x:n,y:r.x-1}),U(n,r.x+r.w,1,1)&&o.push({x:n,y:r.x+r.w}),n++;return o}function U(o,r,e,n){return J(o,r,e,n)&&!K(o,r,e,n)}function J(o,r,e,n){return o>0&&r>0&&o+e<De.width&&r+n<De.height}function K(o,r,e,n){for(var t=null,a=0;a<De.rooms.length;){t=De.rooms[a];{if(!(t.x>o+e-1||t.x+t.w-1<o||t.y>r+n-1||t.y+t.h-1<r))return!0;a++}}return!1}function q(o){for(var r=0,e=null,n=!1,t=100;De.rooms.length>1&&!n;){r=0,r+=G(o),r+=Q(o),r+=Z(o),r+=$(o),1===o.r.rooms.length&&r>0&&(n=!0);for(var a=0;a<o.d.length;a++)e=o.d[a],ur(e,o).r===o.r&&(n=!0);t--,0===t&&(n=!0)}}function G(o){for(var r=null,e=null,n=null,t=[],a=o.x;a<o.x+o.w;)e=_(a,o.y-1),null!==e&&t.push({x:a,y:o.y,o:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(m=!0);Math.random()>be||M(o.d,r)>=0||m||(n=lr(r.x,r.y,"N",o,r.o),o.d.push(n),r.o.d.push(lr(r.x,r.y-1,"S",r.o,o)),i++)}return i}function Q(o){for(var r=null,e=null,n=null,t=[],a=o.x;a<o.x+o.w;)e=_(a,o.y+o.h),null!==e&&t.push({x:a,y:o.y+o.h-1,o:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(m=!0);Math.random()>be||M(o.d,r)>=0||m||(n=lr(r.x,r.y,"S",o,r.o),o.d.push(n),r.o.d.push(lr(r.x,r.y+1,"N",r.o,o)),i++)}return i}function Z(o){for(var r=null,e=null,n=null,t=[],a=o.y;a<o.y+o.h;)e=_(o.x-1,a),null!==e&&t.push({x:o.x,y:a,o:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(m=!0);Math.random()>be||M(o.d,r)>=0||m||(n=lr(r.x,r.y,"W",o,r.o),o.d.push(n),r.o.d.push(lr(r.x-1,r.y,"E",r.o,o)),i++)}return i}function $(o){for(var r=null,e=null,n=null,t=[],a=o.y;a<o.y+o.h;)e=_(o.x+o.w,a),null!==e&&t.push({x:o.x+o.w-1,y:a,o:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,d=0;d<o.d.length;d++)o.d[d].r2===r.o&&(m=!0);Math.random()>be||M(o.d,r)>=0||m||(n=lr(r.x,r.y,"E",o,r.o),o.d.push(n),r.o.d.push(lr(r.x+1,r.y,"W",r.o,o)),i++)}return i}function _(o,r){for(var e=null,n=0;n<De.rooms.length;){e=De.rooms[n];{if(!(e.x>o||e.x+e.w-1<o||e.y>r||e.y+e.h-1<r))return e;n++}}return null}function or(o,r,e,n){for(var t=null,a=0;a<o.d.length;a++)if(t=o.d[a],t.dir===n&&t.x===o.x+r&&t.y===o.y+e)return t;return null}function rr(o){for(var r=0,e=De.rooms.length;r++<10*o&&De.rooms.length<e+o;)er()}function er(){var o=H(De.f);try{nr(ar(o.x,o.y))}catch(r){console.log(De,o,r)}}function nr(o){if(null===o||!U(o.x,o.y,o.w,o.h))return!1;var r=[];r=tr(r,o),De.f=z(r,o),0===De.f.length&&console.log(r,o,z(r,o)),o.c=De.cr.color,De.rooms.push(o),De.cr.rooms.push(o),q(o)}function z(o,r){for(var e=r.x;e<r.x+r.w;)U(e,r.y-1,1,1)&&o.push({x:e,y:r.y-1}),U(e,r.y+r.h,1,1)&&o.push({x:e,y:r.y+r.h}),e++;for(var n=r.y;n<r.y+r.h;)U(r.x-1,n,1,1)&&o.push({x:r.x-1,y:n}),U(r.x+r.w,n,1,1)&&o.push({x:r.x+r.w,y:n}),n++;return o}function tr(o,r){for(var e=0;e<De.f.length;e++)De.f[e].x>=r.x-1&&De.f[e].x<=r.x+r.w&&De.f[e].y>=r.y&&De.f[e].y<=r.y+r.h-1||De.f[e].x>=r.x&&De.f[e].x<=r.x+r.w-1&&De.f[e].y>=r.y-1&&De.f[e].y<=r.y+r.h||o.push(De.f[e]);return o}function ar(o,r){for(var e=0,n=1,t=1;e++<25&&(n<De.cr.maxW||t<De.cr.maxH)&&Math.random()<.9;)switch(parseInt(4*Math.random())){case 0:t<De.cr.maxH&&U(o,r-1,n,t+1)&&(r--,t++);continue;case 1:t<De.cr.maxH&&U(o,r,n,t+1)&&t++;continue;case 2:n<De.cr.maxW&&U(o-1,r,n+1,t)&&(o--,n++);continue;case 3:n<De.cr.maxW&&U(o,r,n+1,t)&&n++;continue;default:continue}return ir(o,r,n,t,De.cr)}function ir(o,r,e,n,t){return{x:o,y:r,w:e,h:n,c:null,r:t,s:0,sx:0,sy:0,sr:!1,v:!1,d:[],map:null}}function lr(o,r,e,n,t){return{x:o,y:r,dt:0,dir:e,r1:n,r2:t}}function mr(){for(var o=null,r=null,e=0;e<De.rooms.length;e++){o=De.rooms[e],o.s=0;for(var n=0;n<o.d.length;n++)r=o.d[n],r.dt=0}}function dr(){for(var o=null,r=null,e=null,n=null,t=0;t<De.r.length;t++){r=De.r[t],H(r.rooms).s=(t+1)%Fe.length;for(var a=0;a<r.rooms.length;a++){n=r.rooms[a];for(var i=0;i<n.d.length;i++)o=n.d[i],e=ur(o,n).r,e!==r&&0===o.dt&&(o.dt=(t+1)%Fe.length)}}}function cr(o){-1===Qr.keys.indexOf(o.s)&&(Qr.keys.push(o.s),sr())}function sr(){for(var o=0;o<De.rooms.length;o++){var r=!1,e=De.rooms[o];Qr.keys.indexOf(e.s)>-1&&(e.s=0);for(var n=0;n<e.d.length;n++){var t=e.d[n];Qr.keys.indexOf(t.dt)>-1&&(t.dt=0,r=!0)}if(r&&null!==e.map)for(var a=0;a<e.map.map.length;a++)e.map.map[a]>1&&Qr.keys.indexOf(e.map.map[a]-1)&&(e.map.map[a]=0)}}function ur(o,r){return o.r1===r?o.r2:o.r1}function pr(){De={width:0,height:0,rooms:[],f:[],r:[],cr:0},crColorIndex=0,De.width=80,De.height=48,j(40,24,yr()),rr(1)}function yr(){var o=hr(Fe[crColorIndex],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1);return crColorIndex=(crColorIndex+1)%Fe.length,o}function hr(o,r,e){return{color:o,maxW:r,maxH:e,rooms:[]}}function xr(){pr()}function wr(){er()}function fr(){O(yr())}function vr(){mr(),dr()}var gr=0,Cr=0,Mr=0,Rr=0,Pr=0,Tr=0,Ar=[],Dr=[],kr=0,br=!1,Lr=0,Fr,Yr,Wr,Xr,Ir,Sr,Er,Vr,Br,jr,Or=0,Hr=1,Nr=2,zr=!0,Ur=new CustomEvent("frame"),Jr=window.performance.now(),Kr=window.performance.now(),qr={},Gr={},Qr={x:151,y:48,w:16,h:32,img:null,xDirection:0,yDirection:1,xAccel:0,yAccel:0,maxAccel:5,jumpForce:7,jumpHeight:50,jumpStart:0,jumping:0,jumpsUsed:0,heightTraveled:0,maxJumps:1,angle:0,health:5,doorCooldown:window.performance.now(),maxHealth:5,keys:[]},Zr=Jr-Kr,$r=[Qr],_r={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};u("keydown",P),u("keyup",T),u("resize",x),u("DOMContentLoaded",h),u("frame",w),window.addEventListener("resize",p),document.addEventListener("DOMContentLoaded",p),document.addEventListener("mousedown",p),document.addEventListener("mouseup",p),document.addEventListener("keydown",p),document.addEventListener("keyup",p),document.addEventListener("frame",p);for(var oe=0,re=0,ee=0,ne=oe,te=oe,ae=[],ie=[],le=[],me=0;100>me;me++)le[me]=0;var de="1111111111111111111111111111110000000000000000000000000000001111111111111111111111111111111111111111",ce="1110001111111000111111100011111110001111111000111111100011111110001111111000111111100011111110001111",se="1000000001110000001111100001110001001000000000000000000000000000000000000111100011111111111111111111",ue="1111111111111000011100000000000000000000000011000000011110000000000000000000000011000000111100000111",pe="1100000011110000001111000001111110000001111000000011110000001111100000111111000011111111111111111111",ye="1111111111100000000110000000001100000000110001100011100011101110000011111100000111110000011111100001",he="1111111111100000000100000000010000000011000110001100110001110110000111010000111111000011111000011111",xe="1100000011110000001111100000111000000111000000011100000011110000011111000011111111111111111111111111",we="1110000011110000000100000000000000000000000011000000001100000000000000000000000011000000111100000111",fe="1111111111111000000011100000001220000000122000000012200000001111100000111110000011111000001111111111",ve="1111111111000000111100000011110000002211000000221100000022110000111111000011111100001111111111111111",ge="1110000111100000000110000000011000110001100111100110000000011000000001100000000111122221111112222111",Ce="1112222111111222211110000000011000000001100000000110011110011000000001100000000110000000011100000111";ae.push({map:le,type:0}),ae.push(F(1,de)),ae.push(F(2,ce)),ae.push(F(3,se)),ae.push(F(4,ue)),ae.push(F(5,pe)),ae.push(F(6,ye)),ae.push(F(7,he)),ae.push(F(8,xe)),ae.push(F(9,we)),ae.push(F(10,fe)),ae.push(F(11,ve)),ae.push(F(12,ge)),ae.push(F(13,Ce));var Me=null,ne=0,te=0,Re=0,Pe=0,Te=0,Ae=0,De,ke,be=.2,Le=0,Fe=[{bg:"#BBBBBB",bd:"#A0A0A0",o:"#CFCFCF",l:"#FFFFFF"},{bd:"#990000",bg:"#FF3333",o:"#FF0000",l:"#FF0000"},{bd:"#006600",bg:"#00BB00",o:"#00BB00",l:"#00FF00"},{bd:"#000066",bg:"#3333FF",o:"#0000FF",l:"#0000FF"},{bg:"#9F9F9F",bd:"#555555",o:"#555555",l:"#000000"}];