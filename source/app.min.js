function o(o){this.content=[],this.scoreFunction=o}function r(){var o=window.performance.now(),r=C(ke)-1,a=C(Ae)-1,i=C(ke)+C(Hr.width)+2,l=C(Ae)+C(Hr.height)+2;0>r&&(r=0),0>a&&(a=0),i>ne&&(i=ne),l>ne&&(l=ne);for(var m=a;l>m;m++){var s,p=0,c=16*-ne*2,d=0;Ir.fillStyle=Le.mapColor.background;for(var u=r;i>u;u++)0!==Te[M(u,m,ne)]&&(p+=16,c===16*-ne*2&&(c=16*u-ke),s=0>m-1?-1:Te[M(u,m-1,ne)],0===s&&(d=1)),(0===Te[M(u,m,ne)]||u===i-1)&&e(u,m,Te,ne,c,p,d),(0===Te[M(u,m,ne)]||u===i-1)&&(p=0,c=16*-ne*2,d=0)}for(var m=a;l>m;m++)for(var u=r;i>u;u++)Te[M(u,m,ne)]>1&&(Ir.fillStyle=Se[Te[M(u,m,ne)]-1].background,e(u,m,Te,ne,16*u-ke,16,!0));n(r,a,i,l,1),n(r,a,i,l,4),t(r,a,i,l,2),t(r,a,i,l,8);var h=window.performance.now()-o;h>Rr&&(Rr=h)}function e(o,r,e,n,t,a,i){var l=t,m=16*r-Ae;1===i?Ir.fillRect(l,m-5,a,21):Ir.fillRect(l,m,a,16)}function n(o,r,e,n,t){for(var i=o;e>i;i++)for(var l=0,m=16*-ne*2,s=0,p=0,c=r;n>c;c++){var d=Te[M(i+1,c-1,ne)],u=Te[M(i,c-1,ne)],h=Te[M(i-1,c-1,ne)];if(1===t?(p=Te[M(i-1,c,ne)],0>i-1&&(p=-1)):4===t&&(p=Te[M(i+1,c,ne)],i+1>ne-1&&(p=-1)),0!==Te[M(i,c,ne)]&&1>p&&(l+=16,m===16*-ne*2&&(0===u&&(s=1),m=16*c-Ae)),0===Te[M(i,c,ne)]||c===n-1||p>0){Vr.beginPath();var y=m,f=16*i-ke,g=y+l,v=16*(i+1)-ke,w=f;4===t&&(w=v),s&&(y-=5),(4===t&&0===d||1===t&&0===h)&&p>0?a(w,y,w,g+3):a(w,y,w,g),Vr.closePath(),Vr.stroke()}(0===Te[M(i,c,ne)]||c===n-1||p>0)&&(l=0,m=16*-ne*2,s=0)}}function t(o,r,e,n,t){for(var i=r;n>i;i++)for(var l=0,m=16*-ne*2,s=0,p=0,c=o;e>c;c++){if(2===t?0>i-1?p=-1:(p=Te[M(c,i-1,ne)],s=1):8===t&&(p=Te[M(c,i+1,ne)],i+1>ne-1&&(p=-1)),0!==Te[M(c,i,ne)]&&1>p&&(l+=16,m===16*-ne*2&&(m=16*c-ke)),0===Te[M(c,i,ne)]||c===e-1||p>0){Vr.beginPath();var d=m,u=16*i-Ae,h=d+l,y=16*(i+1)-Ae;2===t?1===s?(a(d,u-5,h,u-5),a(d,u+3,h,u+3)):a(d,u,h,u):8===t&&a(d,y,h,y),Vr.closePath(),Vr.stroke()}(0===Te[M(c,i,ne)]||c===e-1||p>0)&&(l=0,m=16*-ne*2,s=0)}}function a(o,r,e,n){Vr.moveTo(o,r),Vr.lineTo(e,n)}function i(){if(O(),Yr=16*Le.mapX+16*C(C(C(_r.x),10),1)-De,Xr=16*Le.mapY+16*C(C(C(_r.y),10),1)-We,Le.mapX+C(C(C(_r.x),10),1)!==Pr||Le.mapY+C(C(C(_r.y),10),1)!==Tr||kr!==be.rooms.length){Or.width=500,Or.height=500,Br.clearRect(0,0,Or.width,Or.height),Dr.length=0,Br.lineWidth=2,Br.fillStyle="#000";for(var o=0;o<be.regions.length;o++)for(var r=0;r<be.regions[o].rooms.length;r++)room=be.regions[o].rooms[r],roomX=16*room.mapX-De,roomY=16*room.mapY-We,roomX+16*room.mapW>0&&roomY+16*room.mapH>0&&roomX<Or.width&&roomY<Or.height&&(Br.beginPath(),Br.rect(roomX,roomY,16*room.mapW,16*room.mapH),Br.fill(),Br.closePath());l("background","border",function(o,r,e){o.visited&&(Br.beginPath(),Br.rect(r,e,16*o.mapW,16*o.mapH),Br.fill(),Br.stroke(),Br.closePath())}),l(0,"background",p),l(0,0,m)}d(),Pr=Le.mapX+C(C(C(_r.x),10),1),Tr=Le.mapY+C(C(C(_r.y),10),1),kr=be.rooms.length}function l(o,r,e){for(var n=0;n<be.regions.length;n++){"string"==typeof o&&(Br.fillStyle=be.regions[n].color[o]),"string"==typeof r&&(Br.strokeStyle=be.regions[n].color[r]);for(var t=0;t<be.regions[n].rooms.length;t++)room=be.regions[n].rooms[t],roomX=16*room.mapX-De,roomY=16*room.mapY-We,roomX+16*room.mapW>0&&roomY+16*room.mapH>0&&roomX<Or.width&&roomY<Or.height&&e(room,roomX,roomY)}}function m(o){if(o.visited){for(var r=null,e=0;e<o.doors.length;e++){r=o.doors[e];var n=Se[r.doorType].lock;if(r.doorType>0)switch(r.dir){case"N":s(16*r.mapX+5,16*r.mapY,n);continue;case"S":s(16*r.mapX+5,16*r.mapY+16,n);continue;case"W":s(16*r.mapX-3,16*r.mapY+8,n);continue;case"E":s(16*r.mapX+13,16*r.mapY+8,n);continue;default:continue}}var n=Se[o.specialType].lock;o.specialType>0&&s(16*(o.mapX+o.mapW/2)-3,16*(o.mapY+o.mapH/2),"rgba(0,0,0,0)",n)}}function s(o,r,e,n){var t=3;Br.beginPath(),Br.arc(o+t-De,r-We,t,0,2*Math.PI,!1),Br.fillStyle=e,Br.fill(),n&&(Br.lineWidth=2,Br.strokeStyle=n,Br.stroke()),Br.closePath()}function p(o){if(o.visited)for(var r=null,e=0;e<o.doors.length;e++){r=o.doors[e];var n=o.mapX+"-"+o.mapY+"-"+r.room2.mapX+"-"+r.room2.mapY,t=r.room2.mapX+"-"+r.room2.mapY+"-"+o.mapX+"-"+o.mapY;if(-1===Dr.indexOf(t)&&-1===Dr.indexOf(n)){var a=16*r.mapX,i=16*r.mapY;"N"===r.dir&&c(a+4,i,a+16-4,i),"S"===r.dir&&c(a+4,16*(r.mapY+1),a+16-4,16*(r.mapY+1)),"W"===r.dir&&c(a,i+4,a,i+16-4),"E"===r.dir&&c(16*(r.mapX+1),i+4,16*(r.mapX+1),i+16-4),Dr.push(n)}}}function c(o,r,e,n){Br.beginPath(),Br.moveTo(o-De,r-We),Br.lineTo(e-De,n-We),Br.stroke(),Br.closePath()}function d(){br||(jr.width=Or.width,jr.height=Or.height,Nr.lineWidth=1,br=!0),Nr.clearRect(0,0,jr.width,jr.height),Wr+=2*(oe/1e3),Wr%=2;var o=1;Wr>1&&(o=0),Lr!==o&&(Nr.fillStyle="rgba(200,200,255,"+.6*o+")",Nr.strokeStyle="rgba(200,200,255,"+.8*o+")"),Nr.beginPath(),Nr.rect(Yr,Xr,16,16),Nr.fill(),Nr.stroke(),Nr.closePath(),Lr=o}function u(o,r){Zr[o]||(Zr[o]=[]),Zr[o].push(r)}function h(o){var r=o.type;if(Zr[r]&&Zr[r].length>0)for(var e=0;e<Zr[r].length;e++)Zr[r][e](o)}function y(o){return document.getElementById(o)}function f(){Hr=y("player"),Sr=y("border"),Fr=y("tile"),Or=y("minimap"),jr=y("minimapIcons"),Er=Hr.getContext("2d"),Vr=Sr.getContext("2d"),Ir=Fr.getContext("2d"),Br=Or.getContext("2d"),Nr=jr.getContext("2d"),g(),vr();for(var o=0;o<Se.length;o++){for(var r=x(10,20),e=0;r>e;e++)wr();o+1<Se.length&&xr()}Cr(),V(be.rooms[0]),Le.startRoom=!0,Le.startPositionX=x(0,1*Le.mapW-1),Le.startPositionY=x(0,1*Le.mapH-1),_r.x=10*Le.startPositionX*16+80,_r.y=10*Le.startPositionY*16+32,w()}function g(){Sr.width=Hr.width=Fr.width=window.innerWidth>300?300:window.innerWidth,Sr.height=Hr.height=Fr.height=window.innerHeight>300?300:window.innerHeight}function v(){for(var o=0;o<re.length;o++){var e=re[o];X(e),e.x=P(e.x),e.y=P(e.y),W(e),D(e),k(e),I(),A(e)}B(),Vr.strokeStyle=Le.mapColor.border,Vr.lineWidth=2,Er.clearRect(0,0,Hr.width,Hr.height),Vr.clearRect(0,0,Sr.width,Sr.height),Ir.fillStyle=Le.mapColor.border,Ir.fillRect(0,0,Fr.width,Fr.height),Ir.fillStyle=Le.mapColor.background,Ir.clearRect(0-ke,0-Ae,ae,te),r(),i(),Er.fillStyle="#000000";for(var o=0;o<re.length;o++){var e=re[o],n=(15-15*(_r.health/_r.maxHealth)).toString(16);Er.fillStyle="#"+n+n+"0000",Er.fillRect(e.x-ke,e.y-Ae,e.w,e.h)}}function w(){qr=window.performance.now(),oe=qr-Qr,Qr=qr,document.dispatchEvent(Kr),Jr&&requestAnimationFrame(w)}function x(o,r){return Math.floor(Math.random()*(r-o+1)+o)}function C(o,r){var e=o%(r||16);return(o-e)/(r||16)}function M(o,r,e){return r*e+o}function R(o,r){if("object"==typeof r){for(var e=0;e<o.length;e++){var n=!0;if("object"==typeof o[e]){for(var t in r)if(o[e][t]!==r[t]){n=!1;break}if(n===!0)return e}}return-1}return o.indexOf(r)}function P(o){return~~(.5+o)}function T(o){for(var r in ee)ee[r]===o.keyCode&&o.preventDefault();$r[o.keyCode]!==o.type&&o.keyCode===ee.space&&(_r.jumping=1),$r[o.keyCode]=o.type,o.keyCode===ee.d?_r.xDirection=1:o.keyCode===ee.a&&(_r.xDirection=-1)}function Y(o){for(var r in ee)ee[r]===o.keyCode&&o.preventDefault();$r[o.keyCode]!==o.type&&o.keyCode===ee.space&&(_r.jumping=0),$r[o.keyCode]=o.type,(o.keyCode===ee.d||o.keyCode===ee.a)&&($r[ee.d]&&$r[ee.a]?$r[ee.d]===o.type&&$r[ee.a]===o.type&&(_r.xDirection=0):_r.xDirection=0)}function X(o){o.xAccel=o.xAccel+o.xDirection/60*oe,o.xAccel>o.maxAccel&&(o.xAccel=o.maxAccel),o.xAccel<-o.maxAccel&&(o.xAccel=-o.maxAccel),0===o.xDirection&&(o.xAccel>0?o.xAccel=o.xAccel+-2/60*oe:o.xAccel<0&&(o.xAccel=o.xAccel+2/60*oe),(o.xAccel<1/60*oe&&o.xAccel>-1/60*oe||1===o.yDirection||-1===o.yDirection)&&(o.xAccel=0)),o.x=o.x+o.xAccel}function k(o){o.jumping&&-1!==o.yDirection&&o.jumpsUsed<o.maxJumps&&(o.maxJumps>1&&0===o.jumpsUsed&&1===o.yDirection&&o.jumpsUsed++,(0===o.jumpsUsed&&0===o.yDirection||o.jumpsUsed>0||o.maxJumps>1)&&(o.yDirection=-1,o.yAccel=-o.jumpForce,o.jumpStart=o.y,o.jumpsUsed++),o.heightTraveled=0),(0===o.yDirection||!o.jumping||o.heightTraveled>o.jumpHeight)&&(o.yDirection=1),1===o.yDirection&&(o.jumping=0,o.yAccel=o.yAccel+o.jumpForce/2/60*oe),0===o.yDirection&&(o.yAccel>0?o.yAccel=o.yAccel+-1/60*oe:o.yAccel<0&&(o.yAccel=o.yAccel+1/60*oe),o.yAccel<1/60*oe&&o.yAccel>-1/60*oe&&(o.yAccel=0)),o.yAccel>o.maxAccel&&(o.yAccel=10),o.heightTraveled-=o.yAccel,o.heightTraveled=P(o.heightTraveled),o.y=o.y+o.yAccel}function A(o){var r=o.x%16,e=M(C(o.x),C(o.y+o.h),ne),n=M(C(o.x+o.w),C(o.y+o.h),ne),t=!1;t=0===r?Te[e]:0!==Te[n]||0!==Te[e],(t||o.y+o.h>16*Xe)&&1===o.yDirection&&(o.y=16*C(o.y),o.yAccel=0,o.yDirection=0,o.jumpsUsed=0,o.jumping=0,o.heightTraveled=0)}function D(o){var r=o.x%16,e=M(C(o.x),C(o.y-o.h/2),ne),n=M(C(o.x+o.w),C(o.y-o.h/2),ne),t=!1;t=0===r?0!==Te[e]:0!==Te[e]||0!==Te[n],t&&1===o.jumping&&(o.y=16*C(o.y),o.yAccel=-1,o.yDirection=1,o.jumping=0,o.heightTraveled=0)}function W(o){var r=o.y%16,e=o.x%16,n=M(C(o.x),C(o.y-o.h/2),ne),t=M(C(o.x+o.w),C(o.y-o.h/2),ne),a=M(C(o.x),C(o.y),ne),i=M(C(o.x+o.w),C(o.y),ne),l=M(C(o.x),C(o.y+o.h/2),ne),m=M(C(o.x+o.w),C(o.y+o.h/2),ne),s=M(C(o.x),C(o.y+o.h),ne),p=M(C(o.x+o.w),C(o.y+o.h),ne),c=!1,d=!1;0===r?(c=0!==Te[l]||0!==Te[a],d=0!==Te[m]||0!==Te[i]):16*C(o.y+o.h)>o.y+o.h?(c=0!==Te[l]||0!==Te[a]||0!==Te[n],d=0!==Te[m]||0!==Te[i]||0!==Te[t]):(c=0!==Te[l]||0!==Te[a]||0!==Te[s],d=0!==Te[m]||0!==Te[i]||0!==Te[p]),0===e?(d||o.x+o.w>16*Ye||o.x<0)&&o.xAccel>0&&(o.x=16*C(o.x),o.xAccel=0):(d||o.x+o.w>16*Ye||o.x<0)&&o.xAccel>0?(o.x=16*C(o.x),o.xAccel=0):(c||o.x+o.w>16*Ye||o.x<0)&&o.xAccel<0&&(o.x=16*C(o.x+o.w),o.xAccel=0)}function b(o,r){return{map:r,type:o}}function L(o){return{map:o.map.slice(0),type:o.type}}function H(o,r,e,n){for(var t=[],a=[],i=Math.max(o,r),l=0;i*i>l;l++)t[l]=0;t=n(t,o,r,i);for(var m,s,p,c,d,u={},h=0;10*i>h;h++)for(var y=0;10*i>y;y++){var f=Math.floor(y/10),g=Math.floor(h/10);s=er(e,f,g,"N"),p=er(e,f,g,"E"),c=er(e,f,g,"S"),d=er(e,f,g,"W");var v=M(f,g,i),w=f+"-"+g;(y%10===0||h%10===0)&&(u[w]||(m=L(me[t[v]]),u[w]=m),m=u[w]);var x=M(y,h,10*i),C=M(y%10,h%10,10);a[x]=m.map[C],0===h&&null===s&&10*o>y&&(a[x]=1),0===y&&null===d&&10*r>h&&(a[x]=1),h===10*r-1&&null===c&&10*o>y&&(a[x]=1),y===10*o-1&&null===p&&10*r>h&&(a[x]=1),0===h&&null!==s&&10*o>y&&s.doorType>0&&0===a[x]&&(a[x]=s.doorType+1),0===y&&null!==d&&10*r>h&&d.doorType>0&&0===a[x]&&(a[x]=d.doorType+1),h===10*r-1&&null!==c&&10*o>y&&c.doorType>0&&0===a[x]&&(a[x]=c.doorType+1),y===10*o-1&&null!==p&&10*r>h&&p.doorType>0&&0===a[x]&&(a[x]=p.doorType+1)}return{map:a,width:o,height:r,size:i,tiles:10*i}}function F(o,r,e,n,t,a,i,l,m,s){l.length=0;for(var p=0;p<me.length;p++)i[p]=p;var c=a[M(e,n-1,t)],d=a[M(e-1,n,t)],u=a[M(e+1,n,t)],h=a[M(e,n+1,t)];if(0>n-1&&(c=-1),0>e-1&&(d=-1),n+1>s-1&&(h=-1),e+1>m-1&&(u=-1),4===c||2===c||6===c||7===c||9===c||13===c){console.warn("Room for Above");for(var y=0;y<i.length;y++)i[y]=-1;i[2]=2,i[3]=3,i[5]=5,i[8]=8,i[9]=9,-1!==d&&(1===d||3===d||4===d||5===d||6===d||9===d||10===d)&&(console.warn("Room for Above and Left"),i[2]=-1,i[5]=-1,i[3]=3,i[8]=8,i[9]=9,-1!==u&&(1===u||3===u||4===u||7===u||8===u||9===u||11===u)&&(i[8]=-1)),-1!==u&&(1===u||3===u||4===u||7===u||8===u||9===u||11===u)&&(console.warn("Room for Above and Left"),i[2]=-1,i[8]=-1,i[3]=3,i[5]=5,i[9]=9,-1!==d&&(1===d||3===d||4===d||5===d||6===d||9===d||10===d)&&(i[5]=-1))}if(0===e&&(console.warn("Left of Map"),i[7]=-1,i[8]=-1,i[1]=-1),e===m-1&&(console.warn("Right of Map"),i[5]=-1,i[6]=-1,i[1]=-1),0===n&&(console.warn("Top of Map"),i[3]=-1,i[5]=-1,i[8]=-1,i[2]=-1),n===s-1&&(console.warn("Bottom of Map"),i[4]=-1,i[6]=-1,i[7]=-1,i[2]=-1),e===o&&n===r){console.warn("Room for Start");for(var y=0;y<i.length;y++)i[y]=-1;i[10]=10,i[11]=11,i[12]=12,i[13]=13,-1===d&&(i[11]=-1),-1===c&&(i[12]=-1),-1===u&&(i[10]=-1),-1===h&&(i[13]=-1)}else i[10]=-1,i[11]=-1,i[12]=-1,i[13]=-1;i[9]=9;for(var y=0;y<i.length;y++)-1!==i[y]&&l.push(i[y]);var f=l[x(0,l.length-1)];11===f&&-1===[1,3,4,5,6,9].indexOf(d)&&F(o,r,e-1,n,t,a,i,l,m,s),12===f&&-1===[2,4,6,7,9].indexOf(c)&&F(o,r,e,n-1,t,a,i,l,m,s),a[M(e,n,t)]=f}function S(o){o.map=H(1*o.mapW,1*o.mapH,o,function(o,r,e,n){for(var t=0,a=0,i=0;n*n>i;i++)o[M(t,a,n)]=9,t++,t>r-1&&(t=0,a++),a>e-1&&(i=n*n);return o})}function E(o,r,e){V(o);for(var n=0;n<o.doors.length;n++){var t=!1,a=o.doors[n];if(a.dir===r&&(("N"===a.dir||"S"===a.dir)&&(t=e===a.mapX),("E"===a.dir||"W"===a.dir)&&(t=e===a.mapY),t)){var i=1*(a.mapX-o.mapX),l=1*(a.mapY-o.mapY);"N"===a.dir&&(i+=Math.floor(.5),_r.y=0,_r.x=_r.x%160+10*i*16),"E"===a.dir&&(l+=Math.floor(.5),i+=1,_r.x=10*o.mapW*16*1-_r.w,_r.y=_r.y%160+10*l*16),"S"===a.dir&&(i+=Math.floor(.5),l+=1,_r.y=10*o.mapH*16*1-_r.h,_r.x=_r.x%160+10*i*16),"W"===a.dir&&(l+=Math.floor(.5),_r.x=0,_r.y=_r.y%160+10*l*16)}}}function I(){for(var o=0;o<Le.doors.length;o++){var r=Le.doors[o],e=1*(r.mapX-Le.mapX),n=1*(r.mapY-Le.mapY),t=C(C(_r.x),10),a=C(C(_r.x+_r.w),10),i=C(C(_r.y),10),l=C(C(_r.y+_r.h),10),m=10*Le.mapW*16*1,s=10*Le.mapH*16*1;"N"===r.dir&&(e+=Math.floor(.5)),"E"===r.dir&&(n+=Math.floor(.5),e+=1),"S"===r.dir&&(e+=Math.floor(.5),n+=1),"W"===r.dir&&(n+=Math.floor(.5)),window.performance.now()-_r.doorCooldown>400&&(_r.x<=0&&-1===_r.xDirection&&"W"===r.dir&&e===t&&n===i&&E(r.room2,"E",r.mapY),_r.y<=0&&-1===_r.yDirection&&"N"===r.dir&&e===t&&n===i&&E(r.room2,"S",r.mapX),_r.x+_r.w>=m&&1===_r.xDirection&&"E"===r.dir&&e===a&&n===i&&E(r.room2,"W",r.mapY),_r.y+_r.h>=s&&0!==_r.yDirection&&Math.abs(_r.yAccel)>5&&"S"===r.dir&&e===t&&(n===l||n===i)&&E(r.room2,"N",r.mapX))}}function V(o){null===o.map&&S(o),Le=o,dr(o),Le.visited=!0,ne=o.map.tiles,Te=o.map.map,Xe=10*o.map.height,Ye=10*o.map.width,te=10*o.map.height*16,ae=10*o.map.width*16,_r.doorCooldown=window.performance.now()}function B(){var o=Ir.canvas,r=o.width/2,e=o.height/2;_r.x-ke+r>o.width?ke=_r.x-(o.width-r):_r.x-r<ke&&(ke=_r.x-r),_r.y-Ae+e>o.height?Ae=_r.y-(o.height-e):_r.y-e<Ae&&(Ae=_r.y-e),Ae=~~(.5+Ae),Ae=~~(.5+Ae)}function O(){var o=Br.canvas,r=o.width/2,e=o.height/2,n=16*(Le.mapX+C(C(C(_r.x),10),1)),t=16*(Le.mapY+C(C(C(_r.y),10),1));n-De+r>o.width?De=n-(o.width-r):De>n-r&&(De=n-r),t-We+e>o.height?We=t-(o.height-e):We>t-e&&(We=t-e),We=~~(.5+We),We=~~(.5+We)}function N(o,r,e){be.frontiers.length=0,be.frontiers.push({x:o,y:r}),be.currentRegion=e,be.regions.push(e)}function j(o){for(var r=!0,e=z(),n=[];r;){var t=0,a=U(e);n.length=0,n.push(rr(a.x-1,a.y),rr(a.x+1,a.y),rr(a.x,a.y-1),rr(a.x,a.y+1));for(var i=0;4>i;i++)null===n[i]&&t++;t>2&&(r=!1)}N(a.x,a.y,o)}function U(o){var r=x(0,o.length-1);return o[r]}function z(){for(var o=[],r=0;r<be.rooms.length;r++)o=G(o,be.rooms[r]);return o}function G(o,r){for(var e=r.mapX;e<r.mapX+r.mapW;)J(e,r.mapY-1,1,1)&&o.push({x:e,y:r.mapY-1}),J(e,r.mapY+r.mapH,1,1)&&o.push({x:e,y:r.mapY+r.mapH}),e++;for(var n=r.mapX;n<r.mapY+r.mapH;)J(n,r.mapX-1,1,1)&&o.push({x:n,y:r.mapX-1}),J(n,r.mapX+r.mapW,1,1)&&o.push({x:n,y:r.mapX+r.mapW}),n++;return o}function J(o,r,e,n){return K(o,r,e,n)&&!q(o,r,e,n)}function K(o,r,e,n){return o>0&&r>0&&o+e<be.width&&r+n<be.height}function q(o,r,e,n){for(var t=null,a=0;a<be.rooms.length;){t=be.rooms[a];{if(!(t.mapX>o+e-1||t.mapX+t.mapW-1<o||t.mapY>r+n-1||t.mapY+t.mapH-1<r))return!0;a++}}return!1}function Q(o){for(var r=0,e=null,n=!1,t=100;be.rooms.length>1&&!n;){r=0,r+=Z(o),r+=$(o),r+=_(o),r+=or(o),1===o.region.rooms.length&&r>0&&(n=!0);for(var a=0;a<o.doors.length;a++)e=o.doors[a],hr(e,o).region===o.region&&(n=!0);t--,0===t&&(n=!0)}}function Z(o){for(var r=null,e=null,n=null,t=[],a=o.mapX;a<o.mapX+o.mapW;)e=rr(a,o.mapY-1),null!==e&&t.push({x:a,y:o.mapY,other:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,s=0;s<o.doors.length;s++)o.doors[s].room2===r.other&&(m=!0);Math.random()>He||R(o.doors,r)>=0||m||(n=sr(r.x,r.y,"N",o,r.other),o.doors.push(n),r.other.doors.push(sr(r.x,r.y-1,"S",r.other,o)),i++)}return i}function $(o){for(var r=null,e=null,n=null,t=[],a=o.mapX;a<o.mapX+o.mapW;)e=rr(a,o.mapY+o.mapH),null!==e&&t.push({x:a,y:o.mapY+o.mapH-1,other:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,s=0;s<o.doors.length;s++)o.doors[s].room2===r.other&&(m=!0);Math.random()>He||R(o.doors,r)>=0||m||(n=sr(r.x,r.y,"S",o,r.other),o.doors.push(n),r.other.doors.push(sr(r.x,r.y+1,"N",r.other,o)),i++)}return i}function _(o){for(var r=null,e=null,n=null,t=[],a=o.mapY;a<o.mapY+o.mapH;)e=rr(o.mapX-1,a),null!==e&&t.push({x:o.mapX,y:a,other:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,s=0;s<o.doors.length;s++)o.doors[s].room2===r.other&&(m=!0);Math.random()>He||R(o.doors,r)>=0||m||(n=sr(r.x,r.y,"W",o,r.other),o.doors.push(n),r.other.doors.push(sr(r.x-1,r.y,"E",r.other,o)),i++)}return i}function or(o){for(var r=null,e=null,n=null,t=[],a=o.mapY;a<o.mapY+o.mapH;)e=rr(o.mapX+o.mapW,a),null!==e&&t.push({x:o.mapX+o.mapW-1,y:a,other:e}),a++;for(var i=0,l=0;l<t.length;l++){r=t[l];for(var m=!1,s=0;s<o.doors.length;s++)o.doors[s].room2===r.other&&(m=!0);Math.random()>He||R(o.doors,r)>=0||m||(n=sr(r.x,r.y,"E",o,r.other),o.doors.push(n),r.other.doors.push(sr(r.x+1,r.y,"W",r.other,o)),i++)}return i}function rr(o,r){for(var e=null,n=0;n<be.rooms.length;){e=be.rooms[n];{if(!(e.mapX>o||e.mapX+e.mapW-1<o||e.mapY>r||e.mapY+e.mapH-1<r))return e;n++}}return null}function er(o,r,e,n){for(var t=null,a=0;a<o.doors.length;a++)if(t=o.doors[a],t.dir===n&&t.mapX===o.mapX+r&&t.mapY===o.mapY+e)return t;return null}function nr(o){for(var r=0,e=be.rooms.length;r++<10*o&&be.rooms.length<e+o;)tr()}function tr(){var o=U(be.frontiers);try{ar(lr(o.x,o.y))}catch(r){console.log(be,o,r)}}function ar(o){if(null===o||!J(o.mapX,o.mapY,o.mapW,o.mapH))return!1;var r=[];r=ir(r,o),be.frontiers=G(r,o),0===be.frontiers.length&&console.log(r,o,G(r,o)),o.mapColor=be.currentRegion.color,be.rooms.push(o),be.currentRegion.rooms.push(o),Q(o)}function G(o,r){for(var e=r.mapX;e<r.mapX+r.mapW;)J(e,r.mapY-1,1,1)&&o.push({x:e,y:r.mapY-1}),J(e,r.mapY+r.mapH,1,1)&&o.push({x:e,y:r.mapY+r.mapH}),e++;for(var n=r.mapY;n<r.mapY+r.mapH;)J(r.mapX-1,n,1,1)&&o.push({x:r.mapX-1,y:n}),J(r.mapX+r.mapW,n,1,1)&&o.push({x:r.mapX+r.mapW,y:n}),n++;return o}function ir(o,r){for(var e=0;e<be.frontiers.length;e++)be.frontiers[e].x>=r.mapX-1&&be.frontiers[e].x<=r.mapX+r.mapW&&be.frontiers[e].y>=r.mapY&&be.frontiers[e].y<=r.mapY+r.mapH-1||be.frontiers[e].x>=r.mapX&&be.frontiers[e].x<=r.mapX+r.mapW-1&&be.frontiers[e].y>=r.mapY-1&&be.frontiers[e].y<=r.mapY+r.mapH||o.push(be.frontiers[e]);return o}function lr(o,r){for(var e=0,n=1,t=1;e++<25&&(n<be.currentRegion.maxW||t<be.currentRegion.maxH)&&Math.random()<.9;)switch(parseInt(4*Math.random())){case 0:t<be.currentRegion.maxH&&J(o,r-1,n,t+1)&&(r--,t++);continue;case 1:t<be.currentRegion.maxH&&J(o,r,n,t+1)&&t++;continue;case 2:n<be.currentRegion.maxW&&J(o-1,r,n+1,t)&&(o--,n++);continue;case 3:n<be.currentRegion.maxW&&J(o,r,n+1,t)&&n++;continue;default:continue}return mr(o,r,n,t,be.currentRegion)}function mr(o,r,e,n,t){return{mapX:o,mapY:r,mapW:e,mapH:n,mapColor:null,region:t,specialType:0,startPositionX:0,startPositionY:0,startRoom:!1,visited:!1,doors:[],map:null}}function sr(o,r,e,n,t){return{mapX:o,mapY:r,doorType:0,dir:e,room1:n,room2:t}}function pr(){for(var o=null,r=null,e=0;e<be.rooms.length;e++){o=be.rooms[e],o.specialType=0;for(var n=0;n<o.doors.length;n++)r=o.doors[n],r.doorType=0}}function cr(){for(var o=null,r=null,e=null,n=null,t=0;t<be.regions.length;t++){r=be.regions[t],U(r.rooms).specialType=(t+1)%Se.length;for(var a=0;a<r.rooms.length;a++){n=r.rooms[a];for(var i=0;i<n.doors.length;i++)o=n.doors[i],e=hr(o,n).region,e!==r&&0===o.doorType&&(o.doorType=(t+1)%Se.length)}}}function dr(o){-1===_r.keys.indexOf(o.specialType)&&(_r.keys.push(o.specialType),ur())}function ur(){for(var o=0;o<be.rooms.length;o++){var r=!1,e=be.rooms[o];_r.keys.indexOf(e.specialType)>-1&&(e.specialType=0);for(var n=0;n<e.doors.length;n++){var t=e.doors[n];_r.keys.indexOf(t.doorType)>-1&&(t.doorType=0,r=!0)}if(r&&null!==e.map)for(var a=0;a<e.map.map.length;a++)e.map.map[a]>1&&_r.keys.indexOf(e.map.map[a]-1)&&(e.map.map[a]=0)}}function hr(o,r){return o.room1===r?o.room2:o.room1}function yr(){be={width:0,height:0,rooms:[],frontiers:[],regions:[],currentRegion:0},currentRegionColorIndex=0,be.width=80,be.height=48,N(40,24,fr()),nr(1)}function fr(){var o=gr(Se[currentRegionColorIndex],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1);return currentRegionColorIndex=(currentRegionColorIndex+1)%Se.length,o}function gr(o,r,e){return{color:o,maxW:r,maxH:e,rooms:[]}}function vr(){yr()}function wr(){tr()}function xr(){j(fr())}function Cr(){pr(),cr()}var Mr={init:function(o){for(var r=0,e=o[LENGTH];e>r;r++)for(var n=0,t=o[r][LENGTH];t>n;n++){var a=o[r][n];a.f=0,a.g=0,a.h=0,a[COST]=a[SPEED],a.visited=!1,a.closed=!1,a.parent=NULL}},heap:function(){return new o(function(o){return o.f})},search:function(o,r,e){Mr.init(o),heuristic=Mr.manhattan;var n=Mr.heap();for(n[PUSH](r);n.size()>0;){var t=n.pop();if(t===e){for(var a=t,i=[];a.parent;)i[PUSH](a),a=a.parent;return i.reverse()}t.closed=!0;for(var l=Mr.neighbors(o,t),m=0,s=l[LENGTH];s>m;m++){var p=l[m];if(!p.closed&&0!==p[SPEED]){var c=t.g+p[COST],d=p.visited;(!d||c<p.g)&&(p.visited=!0,p.parent=t,p.h=p.h||heuristic(p.x,p.y,e.x,e.y),p.g=c,p.f=p.g+p.h,d?n.rescoreElement(p):n[PUSH](p))}}}return[]},manhattan:function(o,r,e,n){var t=WINDOW[MATH].abs(e-o),a=WINDOW[MATH].abs(n-r);return t+a},neighbors:function(o,r){var e=[],n=r.x,t=r.y;return o[n-1]&&o[n-1][t]&&e[PUSH](o[n-1][t]),o[n+1]&&o[n+1][t]&&e[PUSH](o[n+1][t]),o[n]&&o[n][t-1]&&e[PUSH](o[n][t-1]),o[n]&&o[n][t+1]&&e[PUSH](o[n][t+1]),e}};o.prototype={push:function(o){this.content[PUSH](o),this.sinkDown(this.content[LENGTH]-1)},pop:function(){var o=this.content[0],r=this.content.pop();return this.content[LENGTH]>0&&(this.content[0]=r,this.bubbleUp(0)),o},size:function(){return this.content[LENGTH]},rescoreElement:function(o){this.sinkDown(this.content.indexOf(o))},sinkDown:function(o){for(var r=this.content[o];o>0;){var e=(o+1>>1)-1,n=this.content[e];if(!(this.scoreFunction(r)<this.scoreFunction(n)))break;this.content[e]=r,this.content[o]=n,o=e}},bubbleUp:function(o){for(var r=this.content[LENGTH],e=this.content[o],n=this.scoreFunction(e);;){var t=o+1<<1,a=t-1,i=NULL;if(r>a){var l=this.content[a],m=this.scoreFunction(l);n>m&&(i=a)}if(r>t){var s=this.content[t],p=this.scoreFunction(s);(i===NULL?n:m)>p&&(i=t)}if(i===NULL)break;this.content[o]=this.content[i],this.content[i]=e,o=i}}};var Rr=0,Pr=0,Tr=0,Yr=0,Xr=0,kr=0,Ar=[],Dr=[],Wr=0,br=!1,Lr=0,Hr,Fr,Sr,Er,Ir,Vr,Br,Or,Nr,jr,Ur=0,zr=1,Gr=2,Jr=!0,Kr=new CustomEvent("frame"),qr=window.performance.now(),Qr=window.performance.now(),Zr={},$r={},_r={x:151,y:48,w:16,h:32,img:null,xDirection:0,yDirection:1,xAccel:0,yAccel:0,maxAccel:5,jumpForce:7,jumpHeight:50,jumpStart:0,jumping:0,jumpsUsed:0,heightTraveled:0,maxJumps:1,angle:0,health:5,doorCooldown:window.performance.now(),maxHealth:5,keys:[]},oe=qr-Qr,re=[_r],ee={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};u("keydown",T),u("keyup",Y),u("resize",g),u("DOMContentLoaded",f),u("frame",v),window.addEventListener("resize",h),document.addEventListener("DOMContentLoaded",h),document.addEventListener("mousedown",h),document.addEventListener("mouseup",h),document.addEventListener("keydown",h),document.addEventListener("keyup",h),document.addEventListener("frame",h);for(var ne=0,te=0,ae=0,ie=ne,le=ne,me=[],se=[],pe=[],ce=0;100>ce;ce++)pe[ce]=0;var de=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ue=[1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1],he=[1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ye=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],fe=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ge=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],ve=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,1,0,1,1,0,0,0,0,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1],we=[1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],xe=[1,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1],Ce=[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],Me=[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Re=[1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1],Pe=[1,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1];me.push(b(0,pe)),me.push(b(1,de)),me.push(b(2,ue)),me.push(b(3,he)),me.push(b(4,ye)),me.push(b(5,fe)),me.push(b(6,ge)),me.push(b(7,ve)),me.push(b(8,we)),me.push(b(9,xe)),me.push(b(10,Ce)),me.push(b(11,Me)),me.push(b(12,Re)),me.push(b(13,Pe));var Te=null,Ye=0,Xe=0,ke=0,Ae=0,De=0,We=0,be,Le,He=.2,Fe=0,Se=[{background:"#BBBBBB",border:"#A0A0A0",other:"#CFCFCF",lock:"#FFFFFF"},{border:"#990000",background:"#FF3333",other:"#FF0000",lock:"#FF0000"},{border:"#006600",background:"#00BB00",other:"#00BB00",lock:"#00FF00"},{border:"#000066",background:"#3333FF",other:"#0000FF",lock:"#0000FF"},{background:"#9F9F9F",border:"#555555",other:"#555555",lock:"#000000"}];