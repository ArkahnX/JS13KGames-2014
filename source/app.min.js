function o(){var o=g(Re)-1,n=g(Pe)-1,a=g(Re)+g(Yr.width)+2,i=g(Pe)+g(Yr.height)+2;0>o&&(o=0),0>n&&(n=0),a>oe&&(a=oe),i>oe&&(i=oe);for(var l=n;i>l;l++){var d,m=0,s=16*-oe*2,u=0;Sr.fillStyle=Le.c.bg;for(var c=o;a>c;c++)0!==Me[C(c,l,oe)]&&(m+=16,s===16*-oe*2&&(s=16*c-Re),d=0>l-1?-1:Me[C(c,l-1,oe)],0===d&&(u=1)),(0===Me[C(c,l,oe)]||c===a-1)&&r(c,l,Me,oe,s,m,u),(0===Me[C(c,l,oe)]||c===a-1)&&(m=0,s=16*-oe*2,u=0)}for(var l=n;i>l;l++)for(var c=o;a>c;c++)Me[C(c,l,oe)]>1&&(Sr.fillStyle=Ye[Me[C(c,l,oe)]-1].bg,r(c,l,Me,oe,16*c-Re,16,!0));e(o,n,a,i,1),e(o,n,a,i,4),t(o,n,a,i,2),t(o,n,a,i,8)}function r(o,r,e,t,n,a,i){var l=n,d=16*r-Pe;1===i?Sr.fillRect(l,d-5,a,21):Sr.fillRect(l,d,a,16)}function e(o,r,e,t,a){for(var i=o;e>i;i++)for(var l=0,d=16*-oe*2,m=0,s=0,u=r;t>u;u++){var c=Me[C(i+1,u-1,oe)],p=Me[C(i,u-1,oe)],y=Me[C(i-1,u-1,oe)];if(1===a?(s=Me[C(i-1,u,oe)],0>i-1&&(s=-1)):4===a&&(s=Me[C(i+1,u,oe)],i+1>oe-1&&(s=-1)),0!==Me[C(i,u,oe)]&&1>s&&(l+=16,d===16*-oe*2&&(0===p&&(m=1),d=16*u-Pe)),0===Me[C(i,u,oe)]||u===t-1||s>0){Er.beginPath();var h=d,x=16*i-Re,w=h+l,f=16*(i+1)-Re,v=x;4===a&&(v=f),m&&(h-=5),(4===a&&0===c||1===a&&0===y)&&s>0?n(v,h,v,w+3):n(v,h,v,w),Er.closePath(),Er.stroke()}(0===Me[C(i,u,oe)]||u===t-1||s>0)&&(l=0,d=16*-oe*2,m=0)}}function t(o,r,e,t,a){for(var i=r;t>i;i++)for(var l=0,d=16*-oe*2,m=0,s=0,u=o;e>u;u++){if(2===a?0>i-1?s=-1:(s=Me[C(u,i-1,oe)],m=1):8===a&&(s=Me[C(u,i+1,oe)],i+1>oe-1&&(s=-1)),0!==Me[C(u,i,oe)]&&1>s&&(l+=16,d===16*-oe*2&&(d=16*u-Re)),0===Me[C(u,i,oe)]||u===e-1||s>0){Er.beginPath();var c=d,p=16*i-Pe,y=c+l,h=16*(i+1)-Pe;2===a?1===m?(n(c,p-5,y,p-5),n(c,p+3,y,p+3)):n(c,p,y,p):8===a&&n(c,h,y,h),Er.closePath(),Er.stroke()}(0===Me[C(u,i,oe)]||u===e-1||s>0)&&(l=0,d=16*-oe*2,m=0)}}function n(o,r,e,t){Er.moveTo(o,r),Er.lineTo(e,t)}function a(){if(A(),Rr=16*Le.x+16*g(g(g(Qr.x),10),1)-Te,Pr=16*Le.y+16*g(g(g(Qr.y),10),1)-ke,Le.x+g(g(g(Qr.x),10),1)!==Cr||Le.y+g(g(g(Qr.y),10),1)!==Mr||Tr!==be.rooms.length){jr.width=150,jr.height=150,Vr.clearRect(0,0,jr.width,jr.height),br.length=0,Vr.lineWidth=2,Vr.fillStyle="#000";for(var o=0;o<be.r.length;o++)for(var r=0;r<be.r[o].rooms.length;r++)room=be.r[o].rooms[r],roomX=16*room.x-Te,roomY=16*room.y-ke,roomX+16*room.w>0&&roomY+16*room.h>0&&roomX<jr.width&&roomY<jr.height&&(Vr.beginPath(),Vr.rect(roomX,roomY,16*room.w,16*room.h),Vr.fill(),Vr.closePath());i("bg","bd",function(o,r,e){o.v&&(Vr.beginPath(),Vr.rect(r,e,16*o.w,16*o.h),Vr.fill(),Vr.stroke(),Vr.closePath())}),i(0,"bg",m),i(0,0,l)}u(),Cr=Le.x+g(g(g(Qr.x),10),1),Mr=Le.y+g(g(g(Qr.y),10),1),Tr=be.rooms.length}function i(o,r,e){for(var t=0;t<be.r.length;t++){"string"==typeof o&&(Vr.fillStyle=be.r[t].color[o]),"string"==typeof r&&(Vr.strokeStyle=be.r[t].color[r]);for(var n=0;n<be.r[t].rooms.length;n++)room=be.r[t].rooms[n],roomX=16*room.x-Te,roomY=16*room.y-ke,roomX+16*room.w>0&&roomY+16*room.h>0&&roomX<jr.width&&roomY<jr.height&&e(room,roomX,roomY)}}function l(o){if(o.v){for(var r=null,e=0;e<o.d.length;e++){r=o.d[e];var t=Ye[r.dt].l;if(r.dt>0)switch(r.dir){case"N":d(16*r.x+5,16*r.y,t);continue;case"S":d(16*r.x+5,16*r.y+16,t);continue;case"W":d(16*r.x-3,16*r.y+8,t);continue;case"E":d(16*r.x+13,16*r.y+8,t);continue;default:continue}}var t=Ye[o.s].l;o.s>0&&d(16*(o.x+o.w/2)-3,16*(o.y+o.h/2),"rgba(0,0,0,0)",t)}}function d(o,r,e,t){var n=3;Vr.beginPath(),Vr.arc(o+n-Te,r-ke,n,0,2*Math.PI,!1),Vr.fillStyle=e,Vr.fill(),t&&(Vr.lineWidth=2,Vr.strokeStyle=t,Vr.stroke()),Vr.closePath()}function m(o){if(o.v)for(var r=null,e=0;e<o.d.length;e++){r=o.d[e];var t=o.x+"-"+o.y+"-"+r.r2.x+"-"+r.r2.y,n=r.r2.x+"-"+r.r2.y+"-"+o.x+"-"+o.y;if(-1===br.indexOf(n)&&-1===br.indexOf(t)){var a=16*r.x,i=16*r.y;"N"===r.dir&&s(a+4,i,a+16-4,i),"S"===r.dir&&s(a+4,16*(r.y+1),a+16-4,16*(r.y+1)),"W"===r.dir&&s(a,i+4,a,i+16-4),"E"===r.dir&&s(16*(r.x+1),i+4,16*(r.x+1),i+16-4),br.push(t)}}}function s(o,r,e,t){Vr.beginPath(),Vr.moveTo(o-Te,r-ke),Vr.lineTo(e-Te,t-ke),Vr.stroke(),Vr.closePath()}function u(){Dr||(Br.width=jr.width,Br.height=jr.height,Ar.lineWidth=1,Dr=!0),Ar.clearRect(0,0,Br.width,Br.height),Lr+=2*(Zr/1e3),Lr%=2;var o=1;Lr>1&&(o=0),Fr!==o&&(Ar.fillStyle="rgba(200,200,255,"+.6*o+")",Ar.strokeStyle="rgba(200,200,255,"+.8*o+")"),Ar.beginPath(),Ar.rect(Rr,Pr,16,16),Ar.fill(),Ar.stroke(),Ar.closePath(),Fr=o}function c(o,r){Gr[o]||(Gr[o]=[]),Gr[o].push(r)}function p(o){var r=o.type;if(Gr[r]&&Gr[r].length>0)for(var e=0;e<Gr[r].length;e++)Gr[r][e](o)}function y(o){return document.getElementById(o)}function h(){Yr=y("p"),Xr=y("b"),Wr=y("t"),jr=y("m"),Br=y("i"),Ir=Yr.getContext("2d"),Er=Xr.getContext("2d"),Sr=Wr.getContext("2d"),Vr=jr.getContext("2d"),Ar=Br.getContext("2d"),x(),xr();for(var o=0;o<Ye.length;o++){for(var r=v(10,20),e=0;r>e;e++)wr();o+1<Ye.length&&fr()}vr(),V(be.rooms[0]),Le.sr=!0,Le.sx=v(0,1*Le.w-1),Le.sy=v(0,1*Le.h-1),Qr.x=10*Le.sx*16+80,Qr.y=10*Le.sy*16+32,f()}function x(){Xr.width=Yr.width=Wr.width=window.innerWidth>300?300:window.innerWidth,Xr.height=Yr.height=Wr.height=window.innerHeight>300?300:window.innerHeight}function w(){for(var r=0;r<$r.length;r++){var e=$r[r];k(e),e.x=R(e.x),e.y=R(e.y),F(e),D(e),b(e),E(),L(e)}j(),Er.strokeStyle=Le.c.bd,Er.lineWidth=2,Ir.clearRect(0,0,Yr.width,Yr.height),Er.clearRect(0,0,Xr.width,Xr.height),Sr.fillStyle=Le.c.bd,Sr.fillRect(0,0,Wr.width,Wr.height),Sr.fillStyle=Le.c.bg,Sr.clearRect(0-Re,0-Pe,ee,re),o(),a(),Ir.fillStyle="#000000";for(var r=0;r<$r.length;r++){var e=$r[r],t=(15-15*(Qr.ῼ/Qr.mῼ)).toString(16);Ir.fillStyle="#"+t+t+"0000",Ir.fillRect(e.x-Re,e.y-Pe,e.w,e.h)}}function f(){Jr=window.performance.now(),Zr=Jr-qr,qr=Jr,document.dispatchEvent(Kr),zr&&requestAnimationFrame(f)}function v(o,r){return Math.floor(Math.random()*(r-o+1)+o)}function g(o,r){var e=o%(r||16);return(o-e)/(r||16)}function C(o,r,e){return r*e+o}function M(o,r){if("object"==typeof r){for(var e=0;e<o.length;e++){var t=!0;if("object"==typeof o[e]){for(var n in r)if(o[e][n]!==r[n]){t=!1;break}if(t===!0)return e}}return-1}return o.indexOf(r)}function R(o){return~~(.5+o)}function P(o){for(var r in _r)_r[r]===o.keyCode&&o.preventDefault();Ur[o.keyCode]!==o.type&&o.keyCode===_r.space&&(Qr.j=1),Ur[o.keyCode]=o.type,o.keyCode===_r.d?Qr.xd=1:o.keyCode===_r.a&&(Qr.xd=-1)}function T(o){for(var r in _r)_r[r]===o.keyCode&&o.preventDefault();Ur[o.keyCode]!==o.type&&o.keyCode===_r.space&&(Qr.j=0),Ur[o.keyCode]=o.type,(o.keyCode===_r.d||o.keyCode===_r.a)&&(Ur[_r.d]&&Ur[_r.a]?Ur[_r.d]===o.type&&Ur[_r.a]===o.type&&(Qr.xd=0):Qr.xd=0)}function k(o){o.xa=o.xa+o.xd/60*Zr,o.xa>o.maxa&&(o.xa=o.maxa),o.xa<-o.maxa&&(o.xa=-o.maxa),0===o.xd&&(o.xa>0?o.xa=o.xa+-2/60*Zr:o.xa<0&&(o.xa=o.xa+2/60*Zr),(o.xa<1/60*Zr&&o.xa>-1/60*Zr||1===o.yd||-1===o.yd)&&(o.xa=0)),o.x=o.x+o.xa}function b(o){o.j&&-1!==o.yd&&o.ju<o.mj&&(o.mj>1&&0===o.ju&&1===o.yd&&o.ju++,(0===o.ju&&0===o.yd||o.ju>0||o.mj>1)&&(o.yd=-1,o.ya=-o.jf,o.js=o.y,o.ju++),o.ht=0),(0===o.yd||!o.j||o.ht>o.jh)&&(o.yd=1),1===o.yd&&(o.j=0,o.ya=o.ya+o.jf/2/60*Zr),0===o.yd&&(o.ya>0?o.ya=o.ya+-1/60*Zr:o.ya<0&&(o.ya=o.ya+1/60*Zr),o.ya<1/60*Zr&&o.ya>-1/60*Zr&&(o.ya=0)),o.ya>o.maxa&&(o.ya=10),o.ht-=o.ya,o.ht=R(o.ht),o.y=o.y+o.ya}function L(o){var r=o.x%16,e=C(g(o.x),g(o.y+o.h),oe),t=C(g(o.x+o.w),g(o.y+o.h),oe),n=!1;n=0===r?Me[e]:0!==Me[t]||0!==Me[e],(n||o.y+o.h>16*ne)&&1===o.yd&&(o.y=16*g(o.y),o.ya=0,o.yd=0,o.ju=0,o.j=0,o.ht=0)}function D(o){var r=o.x%16,e=C(g(o.x),g(o.y-o.h/2),oe),t=C(g(o.x+o.w),g(o.y-o.h/2),oe),n=!1;n=0===r?0!==Me[e]:0!==Me[e]||0!==Me[t],n&&1===o.j&&(o.y=16*g(o.y),o.ya=-1,o.yd=1,o.j=0,o.ht=0)}function F(o){var r=o.y%16,e=o.x%16,t=C(g(o.x),g(o.y-o.h/2),oe),n=C(g(o.x+o.w),g(o.y-o.h/2),oe),a=C(g(o.x),g(o.y),oe),i=C(g(o.x+o.w),g(o.y),oe),l=C(g(o.x),g(o.y+o.h/2),oe),d=C(g(o.x+o.w),g(o.y+o.h/2),oe),m=C(g(o.x),g(o.y+o.h),oe),s=C(g(o.x+o.w),g(o.y+o.h),oe),u=!1,c=!1;0===r?(u=0!==Me[l]||0!==Me[a],c=0!==Me[d]||0!==Me[i]):16*g(o.y+o.h)>o.y+o.h?(u=0!==Me[l]||0!==Me[a]||0!==Me[t],c=0!==Me[d]||0!==Me[i]||0!==Me[n]):(u=0!==Me[l]||0!==Me[a]||0!==Me[m],c=0!==Me[d]||0!==Me[i]||0!==Me[s]),0===e?(c||o.x+o.w>16*te||o.x<0)&&o.xa>0&&(o.x=16*g(o.x),o.xa=0):(c||o.x+o.w>16*te||o.x<0)&&o.xa>0?(o.x=16*g(o.x),o.xa=0):(u||o.x+o.w>16*te||o.x<0)&&o.xa<0&&(o.x=16*g(o.x+o.w),o.xa=0)}function Y(o,r){r=r.split("");for(var e=0;e<r.length;e++)r[e]=parseInt(r[e]);return{map:r,type:o}}function W(o){return{map:o.map.slice(0),type:o.type}}function X(o,r,e,t){for(var n=[],a=[],i=Math.max(o,r),l=0;i*i>l;l++)n[l]=0;n=t(n,o,r,i);for(var d,m,s,u,c,p={},y=0;10*i>y;y++)for(var h=0;10*i>h;h++){var x=Math.floor(h/10),w=Math.floor(y/10);m=or(e,x,w,"N"),s=or(e,x,w,"E"),u=or(e,x,w,"S"),c=or(e,x,w,"W");var f=C(x,w,i),v=x+"-"+w;(h%10===0||y%10===0)&&(p[v]||(d=W(ae[n[f]]),p[v]=d),d=p[v]);var g=C(h,y,10*i),M=C(h%10,y%10,10);a[g]=d.map[M],0===y&&null===m&&10*o>h&&(a[g]=1),0===h&&null===c&&10*r>y&&(a[g]=1),y===10*r-1&&null===u&&10*o>h&&(a[g]=1),h===10*o-1&&null===s&&10*r>y&&(a[g]=1),0===y&&null!==m&&10*o>h&&m.dt>0&&0===a[g]&&(a[g]=m.dt+1),0===h&&null!==c&&10*r>y&&c.dt>0&&0===a[g]&&(a[g]=c.dt+1),y===10*r-1&&null!==u&&10*o>h&&u.dt>0&&0===a[g]&&(a[g]=u.dt+1),h===10*o-1&&null!==s&&10*r>y&&s.dt>0&&0===a[g]&&(a[g]=s.dt+1)}return{map:a,width:o,height:r,size:i,tiles:10*i}}function I(o){o.map=X(1*o.w,1*o.h,o,function(o,r,e,t){for(var n=0,a=0,i=0;t*t>i;i++)o[C(n,a,t)]=9,n++,n>r-1&&(n=0,a++),a>e-1&&(i=t*t);return o})}function S(o,r,e){V(o);for(var t=0;t<o.d.length;t++){var n=!1,a=o.d[t];if(a.dir===r&&(("N"===a.dir||"S"===a.dir)&&(n=e===a.x),("E"===a.dir||"W"===a.dir)&&(n=e===a.y),n)){var i=1*(a.x-o.x),l=1*(a.y-o.y);"N"===a.dir&&(i+=Math.floor(.5),Qr.y=0,Qr.x=Qr.x%160+10*i*16),"E"===a.dir&&(l+=Math.floor(.5),i+=1,Qr.x=10*o.w*16*1-Qr.w,Qr.y=Qr.y%160+10*l*16),"S"===a.dir&&(i+=Math.floor(.5),l+=1,Qr.y=10*o.h*16*1-Qr.h,Qr.x=Qr.x%160+10*i*16),"W"===a.dir&&(l+=Math.floor(.5),Qr.x=0,Qr.y=Qr.y%160+10*l*16)}}}function E(){for(var o=0;o<Le.d.length;o++){var r=Le.d[o],e=1*(r.x-Le.x),t=1*(r.y-Le.y),n=g(g(Qr.x),10),a=g(g(Qr.x+Qr.w),10),i=g(g(Qr.y),10),l=g(g(Qr.y+Qr.h),10),d=10*Le.w*16*1,m=10*Le.h*16*1;"N"===r.dir&&(e+=Math.floor(.5)),"E"===r.dir&&(t+=Math.floor(.5),e+=1),"S"===r.dir&&(e+=Math.floor(.5),t+=1),"W"===r.dir&&(t+=Math.floor(.5)),window.performance.now()-Qr.dc>400&&(Qr.x<=0&&-1===Qr.xd&&"W"===r.dir&&e===n&&t===i&&S(r.r2,"E",r.y),Qr.y<=0&&-1===Qr.yd&&"N"===r.dir&&e===n&&t===i&&S(r.r2,"S",r.x),Qr.x+Qr.w>=d&&1===Qr.xd&&"E"===r.dir&&e===a&&t===i&&S(r.r2,"W",r.y),Qr.y+Qr.h>=m&&0!==Qr.yd&&Math.abs(Qr.ya)>5&&"S"===r.dir&&e===n&&(t===l||t===i)&&S(r.r2,"N",r.x))}}function V(o){null===o.map&&I(o),Le=o,sr(o),Le.v=!0,oe=o.map.tiles,Me=o.map.map,ne=10*o.map.height,te=10*o.map.width,re=10*o.map.height*16,ee=10*o.map.width*16,Qr.dc=window.performance.now(),document.title=Le.c.name,history.pushState(null,null,"#"+document.title)}function j(){var o=Sr.canvas,r=o.width/2,e=o.height/2;Qr.x-Re+r>o.width?Re=Qr.x-(o.width-r):Qr.x-r<Re&&(Re=Qr.x-r),Qr.y-Pe+e>o.height?Pe=Qr.y-(o.height-e):Qr.y-e<Pe&&(Pe=Qr.y-e),Pe=~~(.5+Pe),Pe=~~(.5+Pe)}function A(){var o=Vr.canvas,r=o.width/2,e=o.height/2,t=16*(Le.x+g(g(g(Qr.x),10),1)),n=16*(Le.y+g(g(g(Qr.y),10),1));t-Te+r>o.width?Te=t-(o.width-r):Te>t-r&&(Te=t-r),n-ke+e>o.height?ke=n-(o.height-e):ke>n-e&&(ke=n-e),ke=~~(.5+ke),ke=~~(.5+ke)}function B(o,r,e){be.f.length=0,be.f.push({x:o,y:r}),be.cr=e,be.r.push(e)}function O(o){for(var r=!0,e=H(),t=[];r;){var n=0,a=N(e);t.length=0,t.push(_(a.x-1,a.y),_(a.x+1,a.y),_(a.x,a.y-1),_(a.x,a.y+1));for(var i=0;4>i;i++)null===t[i]&&n++;n>2&&(r=!1)}B(a.x,a.y,o)}function N(o){var r=v(0,o.length-1);return o[r]}function H(){for(var o=[],r=0;r<be.rooms.length;r++)o=z(o,be.rooms[r]);return o}function z(o,r){for(var e=r.x;e<r.x+r.w;)K(e,r.y-1,1,1)&&o.push({x:e,y:r.y-1}),K(e,r.y+r.h,1,1)&&o.push({x:e,y:r.y+r.h}),e++;for(var t=r.x;t<r.y+r.h;)K(t,r.x-1,1,1)&&o.push({x:t,y:r.x-1}),K(t,r.x+r.w,1,1)&&o.push({x:t,y:r.x+r.w}),t++;return o}function K(o,r,e,t){return J(o,r,e,t)&&!q(o,r,e,t)}function J(o,r,e,t){return o>0&&r>0&&o+e<be.width&&r+t<be.height}function q(o,r,e,t){for(var n=null,a=0;a<be.rooms.length;){n=be.rooms[a];{if(!(n.x>o+e-1||n.x+n.w-1<o||n.y>r+t-1||n.y+n.h-1<r))return!0;a++}}return!1}function G(o){for(var r=0,e=null,t=!1,n=100;be.rooms.length>1&&!t;){r=0,r+=U(o),r+=Q(o),r+=Z(o),r+=$(o),1===o.r.rooms.length&&r>0&&(t=!0);for(var a=0;a<o.d.length;a++)e=o.d[a],cr(e,o).r===o.r&&(t=!0);n--,0===n&&(t=!0)}}function U(o){for(var r=null,e=null,t=null,n=[],a=o.x;a<o.x+o.w;)e=_(a,o.y-1),null!==e&&n.push({x:a,y:o.y,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var d=!1,m=0;m<o.d.length;m++)o.d[m].r2===r.o&&(d=!0);Math.random()>De||M(o.d,r)>=0||d||(t=lr(r.x,r.y,"N",o,r.o),o.d.push(t),r.o.d.push(lr(r.x,r.y-1,"S",r.o,o)),i++)}return i}function Q(o){for(var r=null,e=null,t=null,n=[],a=o.x;a<o.x+o.w;)e=_(a,o.y+o.h),null!==e&&n.push({x:a,y:o.y+o.h-1,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var d=!1,m=0;m<o.d.length;m++)o.d[m].r2===r.o&&(d=!0);Math.random()>De||M(o.d,r)>=0||d||(t=lr(r.x,r.y,"S",o,r.o),o.d.push(t),r.o.d.push(lr(r.x,r.y+1,"N",r.o,o)),i++)}return i}function Z(o){for(var r=null,e=null,t=null,n=[],a=o.y;a<o.y+o.h;)e=_(o.x-1,a),null!==e&&n.push({x:o.x,y:a,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var d=!1,m=0;m<o.d.length;m++)o.d[m].r2===r.o&&(d=!0);Math.random()>De||M(o.d,r)>=0||d||(t=lr(r.x,r.y,"W",o,r.o),o.d.push(t),r.o.d.push(lr(r.x-1,r.y,"E",r.o,o)),i++)}return i}function $(o){for(var r=null,e=null,t=null,n=[],a=o.y;a<o.y+o.h;)e=_(o.x+o.w,a),null!==e&&n.push({x:o.x+o.w-1,y:a,o:e}),a++;for(var i=0,l=0;l<n.length;l++){r=n[l];for(var d=!1,m=0;m<o.d.length;m++)o.d[m].r2===r.o&&(d=!0);Math.random()>De||M(o.d,r)>=0||d||(t=lr(r.x,r.y,"E",o,r.o),o.d.push(t),r.o.d.push(lr(r.x+1,r.y,"W",r.o,o)),i++)}return i}function _(o,r){for(var e=null,t=0;t<be.rooms.length;){e=be.rooms[t];{if(!(e.x>o||e.x+e.w-1<o||e.y>r||e.y+e.h-1<r))return e;t++}}return null}function or(o,r,e,t){for(var n=null,a=0;a<o.d.length;a++)if(n=o.d[a],n.dir===t&&n.x===o.x+r&&n.y===o.y+e)return n;return null}function rr(o){for(var r=0,e=be.rooms.length;r++<10*o&&be.rooms.length<e+o;)er()}function er(){var o=N(be.f);try{tr(ar(o.x,o.y))}catch(r){console.log(be,o,r)}}function tr(o){if(null===o||!K(o.x,o.y,o.w,o.h))return!1;var r=[];r=nr(r,o),be.f=z(r,o),0===be.f.length&&console.log(r,o,z(r,o)),o.c=be.cr.color,be.rooms.push(o),be.cr.rooms.push(o),G(o)}function z(o,r){for(var e=r.x;e<r.x+r.w;)K(e,r.y-1,1,1)&&o.push({x:e,y:r.y-1}),K(e,r.y+r.h,1,1)&&o.push({x:e,y:r.y+r.h}),e++;for(var t=r.y;t<r.y+r.h;)K(r.x-1,t,1,1)&&o.push({x:r.x-1,y:t}),K(r.x+r.w,t,1,1)&&o.push({x:r.x+r.w,y:t}),t++;return o}function nr(o,r){for(var e=0;e<be.f.length;e++)be.f[e].x>=r.x-1&&be.f[e].x<=r.x+r.w&&be.f[e].y>=r.y&&be.f[e].y<=r.y+r.h-1||be.f[e].x>=r.x&&be.f[e].x<=r.x+r.w-1&&be.f[e].y>=r.y-1&&be.f[e].y<=r.y+r.h||o.push(be.f[e]);return o}function ar(o,r){for(var e=0,t=1,n=1;e++<25&&(t<be.cr.maxW||n<be.cr.maxH)&&Math.random()<.9;)switch(parseInt(4*Math.random())){case 0:n<be.cr.maxH&&K(o,r-1,t,n+1)&&(r--,n++);continue;case 1:n<be.cr.maxH&&K(o,r,t,n+1)&&n++;continue;case 2:t<be.cr.maxW&&K(o-1,r,t+1,n)&&(o--,t++);continue;case 3:t<be.cr.maxW&&K(o,r,t+1,n)&&t++;continue;default:continue}return ir(o,r,t,n,be.cr)}function ir(o,r,e,t,n){return{x:o,y:r,w:e,h:t,c:null,r:n,s:0,sx:0,sy:0,sr:!1,v:!1,d:[],map:null}}function lr(o,r,e,t,n){return{x:o,y:r,dt:0,dir:e,r1:t,r2:n}}function dr(){for(var o=null,r=null,e=0;e<be.rooms.length;e++){o=be.rooms[e],o.s=0;for(var t=0;t<o.d.length;t++)r=o.d[t],r.dt=0}}function mr(){for(var o=null,r=null,e=null,t=null,n=0;n<be.r.length;n++){r=be.r[n],N(r.rooms).s=(n+1)%Ye.length;for(var a=0;a<r.rooms.length;a++){t=r.rooms[a];for(var i=0;i<t.d.length;i++)o=t.d[i],e=cr(o,t).r,e!==r&&0===o.dt&&(o.dt=(n+1)%Ye.length)}}}function sr(o){-1===Qr.keys.indexOf(o.s)&&(Qr.keys.push(o.s),ur())}function ur(){for(var o=0;o<be.rooms.length;o++){var r=!1,e=be.rooms[o];Qr.keys.indexOf(e.s)>-1&&(e.s=0);for(var t=0;t<e.d.length;t++){var n=e.d[t];Qr.keys.indexOf(n.dt)>-1&&(n.dt=0,r=!0)}if(r&&null!==e.map)for(var a=0;a<e.map.map.length;a++)e.map.map[a]>1&&Qr.keys.indexOf(e.map.map[a]-1)&&(e.map.map[a]=0)}}function cr(o,r){return o.r1===r?o.r2:o.r1}function pr(){be={width:0,height:0,rooms:[],f:[],r:[],cr:0},crColorIndex=0,be.width=80,be.height=48,B(40,24,yr()),rr(1)}function yr(){var o=hr(Ye[crColorIndex],parseInt(3*Math.random())+parseInt(3*Math.random())+1,parseInt(3*Math.random())+parseInt(3*Math.random())+1);return crColorIndex=(crColorIndex+1)%Ye.length,o}function hr(o,r,e){return{color:o,maxW:r,maxH:e,rooms:[]}}function xr(){pr()}function wr(){er()}function fr(){O(yr())}function vr(){dr(),mr()}var gr=0,Cr=0,Mr=0,Rr=0,Pr=0,Tr=0,kr=[],br=[],Lr=0,Dr=!1,Fr=0,Yr,Wr,Xr,Ir,Sr,Er,Vr,jr,Ar,Br,Or=0,Nr=1,Hr=2,zr=!0,Kr=new CustomEvent("frame"),Jr=window.performance.now(),qr=window.performance.now(),Gr={},Ur={},Qr={x:151,y:48,w:16,h:32,img:null,xd:0,yd:1,xa:0,ya:0,maxa:5,jf:7,jh:50,js:0,j:0,ju:0,ht:0,mj:1,a:0,"ῼ":5,dc:window.performance.now(),"mῼ":5,keys:[]},Zr=Jr-qr,$r=[Qr],_r={a:65,w:87,s:83,d:68,space:32,shift:16,ctrl:17,alt:18,tab:9,debug:192};c("keydown",P),c("keyup",T),c("resize",x),c("DOMContentLoaded",h),c("frame",w),window.addEventListener("resize",p),document.addEventListener("DOMContentLoaded",p),document.addEventListener("mousedown",p),document.addEventListener("mouseup",p),document.addEventListener("keydown",p),document.addEventListener("keyup",p),document.addEventListener("frame",p);for(var oe=0,re=0,ee=0,te=oe,ne=oe,ae=[],ie=[],le=[],de=0;100>de;de++)le[de]=0;var me="1111111111111111111111111111110000000000000000000000000000001111111111111111111111111111111111111111",se="1110001111111000111111100011111110001111111000111111100011111110001111111000111111100011111110001111",ue="1000000001110000001111100001110001001000000000000000000000000000000000000111100011111111111111111111",ce="1111111111111000011100000000000000000000000011000000011110000000000000000000000011000000111100000111",pe="1100000011110000001111000001111110000001111000000011110000001111100000111111000011111111111111111111",ye="1111111111100000000110000000001100000000110001100011100011101110000011111100000111110000011111100001",he="1111111111100000000100000000010000000011000110001100110001110110000111010000111111000011111000011111",xe="1100000011110000001111100000111000000111000000011100000011110000011111000011111111111111111111111111",we="1110000011110000000100000000000000000000000011000000001100000000000000000000000011000000111100000111",fe="1111111111111000000011100000001220000000122000000012200000001111100000111110000011111000001111111111",ve="1111111111000000111100000011110000002211000000221100000022110000111111000011111100001111111111111111",ge="1110000111100000000110000000011000110001100111100110000000011000000001100000000111122221111112222111",Ce="1112222111111222211110000000011000000001100000000110011110011000000001100000000110000000011100000111";ae.push({map:le,type:0}),ae.push(Y(1,me)),ae.push(Y(2,se)),ae.push(Y(3,ue)),ae.push(Y(4,ce)),ae.push(Y(5,pe)),ae.push(Y(6,ye)),ae.push(Y(7,he)),ae.push(Y(8,xe)),ae.push(Y(9,we)),ae.push(Y(10,fe)),ae.push(Y(11,ve)),ae.push(Y(12,ge)),ae.push(Y(13,Ce));var Me=null,te=0,ne=0,Re=0,Pe=0,Te=0,ke=0,be,Le,De=.2,Fe=0,Ye=[{bg:"#BBBBBB",bd:"#A0A0A0",o:"#CFCFCF",l:"#FFFFFF",name:"Dungeon"},{bd:"#990000",bg:"#FF3333",o:"#FF0000",l:"#FF0000",name:"Fire"},{bd:"#006600",bg:"#00BB00",o:"#00BB00",l:"#00FF00",name:"Air"},{bd:"#000066",bg:"#3333FF",o:"#0000FF",l:"#0000FF",name:"Water"},{bg:"#9F9F9F",bd:"#555555",o:"#555555",l:"#000000",name:"Earth"}];